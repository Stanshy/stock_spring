# M11-量化策略模組功能需求

> **文件編號**: FUNC-M11
> **模組名稱**: 量化策略模組
> **版本**: v1.0
> **最後更新**: 2026-01-14
> **狀態**: Draft

---

## 1. 模組概述

### 1.1 模組定位

M11 量化策略模組負責提供策略框架、策略庫管理、因子組合與策略執行功能。本模組整合 M07（技術分析）、M08（基本面分析）、M09（籌碼分析）的計算結果，透過策略引擎執行量化策略邏輯，產生策略信號供下游 M13（信號判斷引擎）消費。

**在系統架構中的位置**:
```
Layer 3: 進階分析層
├── M10 技術型態辨識模組（型態辨識）
├── M11 量化策略模組（策略執行）← 本模組
└── M12 總經與產業分析模組（總經產業）
```

**上下游關係**:
```
┌─────────────────────────────────────────────────────────────────┐
│                         上游依賴                                  │
│  ┌─────────┐  ┌─────────┐  ┌─────────┐  ┌─────────┐            │
│  │   M06   │  │   M07   │  │   M08   │  │   M09   │            │
│  │資料管理  │  │技術分析  │  │基本面    │  │籌碼分析  │            │
│  └────┬────┘  └────┬────┘  └────┬────┘  └────┬────┘            │
│       │            │            │            │                  │
│       └────────────┴────────────┴────────────┘                  │
│                            │                                    │
│                            ▼                                    │
│                    ┌─────────────┐                              │
│                    │    M11      │                              │
│                    │  量化策略    │ ← 本模組                     │
│                    └──────┬──────┘                              │
│                           │                                     │
│                           ▼                                     │
│                    ┌─────────────┐                              │
│                    │    M13      │                              │
│                    │  信號引擎    │ ← 下游消費                    │
│                    └─────────────┘                              │
│                           │                                     │
│                    ┌──────┴──────┐                              │
│                    ▼             ▼                              │
│              ┌─────────┐  ┌─────────┐                           │
│              │   M14   │  │   M16   │                           │
│              │選股引擎  │  │回測系統  │                           │
│              └─────────┘  └─────────┘                           │
└─────────────────────────────────────────────────────────────────┘
```

### 1.2 核心價值

| 價值項目 | 說明 |
|---------|------|
| 策略框架標準化 | 提供統一的策略定義、執行、評估框架 |
| 多因子組合 | 支援技術面、基本面、籌碼面因子自由組合 |
| 策略版本管理 | 策略版本控制、歷史追溯、A/B 測試支援 |
| 執行結果追蹤 | 策略執行記錄、績效追蹤、診斷分析 |
| 參數優化支援 | 策略參數網格搜索、最佳化建議 |

### 1.3 模組依賴

| 依賴模組 | 依賴類型 | 說明 |
|---------|---------|------|
| M06 資料管理模組 | 資料依賴 | 取得股票基本資料、價格資料、交易日曆 |
| M07 技術分析模組 | 資料依賴 | 取得技術指標計算結果（RSI、MACD、MA 等） |
| M08 基本面分析模組 | 資料依賴 | 取得財務指標計算結果（PE、ROE、EPS 等） |
| M09 籌碼分析模組 | 資料依賴 | 取得籌碼指標計算結果（法人買賣超、融資融券等） |
| M00 共用模組 | 技術依賴 | 使用共用 DTO、Exception、Utils |

### 1.4 M11 與 M13 邊界定義

**M11 量化策略模組職責**:
- 策略定義與管理（CRUD）
- 因子條件組合與邏輯運算
- 策略執行與結果產出
- 產生「策略信號」（strategy_signals）

**M13 信號判斷引擎職責**:
- 接收來自 M07-M12 的各類信號
- 信號去重、合併、衝突處理
- 信號評分與排序
- 產生「統一信號」供下游使用

**邊界原則**:
- M11 專注於「策略層面」的邏輯運算
- M13 專注於「信號層面」的整合處理
- M11 產出的 strategy_signals 是 M13 的輸入之一

---

## 2. 功能清單

### 2.1 功能總覽

| 功能編號 | 功能名稱 | 優先級 | 說明 |
|---------|---------|-------|------|
| F-M11-001 | 策略定義管理 | P0 | 策略 CRUD、版本控制、啟用/停用 |
| F-M11-002 | 因子庫管理 | P0 | 支援的因子清單、因子元數據查詢 |
| F-M11-003 | 策略執行引擎 | P0 | 執行策略邏輯、產生策略信號 |
| F-M11-004 | 預設策略庫 | P0 | 內建經典量化策略（動能、價值、混合） |
| F-M11-005 | 策略執行歷史 | P1 | 執行記錄查詢、績效統計 |
| F-M11-006 | 策略參數優化 | P1 | 參數網格搜索、最佳參數建議 |
| F-M11-007 | 策略回測觸發 | P1 | 觸發 M16 回測、取得回測結果 |
| F-M11-008 | 策略診斷分析 | P2 | 策略執行診斷、因子貢獻度分析 |

---

### 2.2 P0 核心功能詳細需求

#### F-M11-001: 策略定義管理

**功能描述**: 提供策略的建立、修改、刪除、版本控制功能

**策略資料模型**:

| 欄位 | 類型 | 說明 |
|-----|------|------|
| strategy_id | VARCHAR(20) | 策略唯一識別碼 |
| strategy_name | VARCHAR(100) | 策略名稱 |
| strategy_type | ENUM | 策略類型（MOMENTUM, VALUE, HYBRID, CUSTOM） |
| description | TEXT | 策略描述 |
| version | INTEGER | 版本號 |
| status | ENUM | 狀態（DRAFT, ACTIVE, INACTIVE, ARCHIVED） |
| conditions | JSONB | 策略條件定義（因子組合） |
| parameters | JSONB | 策略參數（可調整） |
| created_by | VARCHAR(50) | 建立者 |
| created_at | TIMESTAMP | 建立時間 |

**策略條件定義格式（conditions JSONB）**:

```json
{
  "logic": "AND",
  "conditions": [
    {
      "factor_id": "M07_RSI_14",
      "operator": "LESS_THAN",
      "value": 30,
      "description": "RSI(14) < 30，超賣訊號"
    },
    {
      "factor_id": "M08_PE_RATIO",
      "operator": "LESS_THAN",
      "value": 15,
      "description": "本益比 < 15，價值低估"
    },
    {
      "logic": "OR",
      "conditions": [
        {
          "factor_id": "M09_FOREIGN_NET_5D",
          "operator": "GREATER_THAN",
          "value": 0,
          "description": "外資 5 日累計買超"
        },
        {
          "factor_id": "M09_TRUST_CONTINUOUS_DAYS",
          "operator": "GREATER_THAN_EQUAL",
          "value": 3,
          "description": "投信連續買超 >= 3 天"
        }
      ]
    }
  ],
  "output": {
    "signal_type": "BUY",
    "confidence_formula": "(1 - RSI/100) * 0.3 + (1 - PE/30) * 0.3 + chip_score * 0.4"
  }
}
```

**支援的運算子**:

| 運算子 | 說明 | 範例 |
|-------|------|------|
| EQUAL | 等於 | PE = 15 |
| NOT_EQUAL | 不等於 | SECTOR != '金融' |
| GREATER_THAN | 大於 | RSI > 70 |
| GREATER_THAN_EQUAL | 大於等於 | VOLUME >= 1000 |
| LESS_THAN | 小於 | RSI < 30 |
| LESS_THAN_EQUAL | 小於等於 | PE <= 20 |
| BETWEEN | 介於 | RSI BETWEEN 40 AND 60 |
| IN | 包含於 | SECTOR IN ['半導體', '電子'] |
| CROSS_ABOVE | 向上穿越 | MA5 CROSS_ABOVE MA20 |
| CROSS_BELOW | 向下穿越 | MA5 CROSS_BELOW MA20 |

---

#### F-M11-002: 因子庫管理

**功能描述**: 管理可用於策略組合的因子清單

**因子分類**:

| 類別 | Category | 來源模組 | 因子數量 | 說明 |
|-----|----------|---------|---------|------|
| 技術面因子 | TECHNICAL | M07 | 71 | RSI、MACD、MA、布林通道等 |
| 基本面因子 | FUNDAMENTAL | M08 | 75 | PE、PB、ROE、EPS成長率等 |
| 籌碼面因子 | CHIP | M09 | 28 | 法人買賣超、融資融券、籌碼集中度等 |
| 價量因子 | PRICE_VOLUME | M06 | 15 | 成交量、股價變化、振幅等 |
| 衍生因子 | DERIVED | M11 | 20 | 自定義組合因子 |

**因子元數據格式**:

```json
{
  "factor_id": "M07_RSI_14",
  "factor_name": "RSI(14)",
  "display_name": "相對強弱指標 14 日",
  "category": "TECHNICAL",
  "source_module": "M07",
  "data_type": "NUMERIC",
  "value_range": {
    "min": 0,
    "max": 100
  },
  "default_operator": "LESS_THAN",
  "typical_thresholds": [30, 70],
  "description": "衡量價格變動速度與幅度的動量指標",
  "calculation_dependency": ["close_price"],
  "update_frequency": "DAILY"
}
```

**核心因子清單（P0 優先實作）**:

| 因子 ID | 因子名稱 | 類別 | 說明 |
|--------|---------|------|------|
| M07_RSI_14 | RSI(14) | TECHNICAL | 14 日 RSI |
| M07_MACD_HISTOGRAM | MACD 柱狀圖 | TECHNICAL | MACD 差離值 |
| M07_MA_CROSS | 均線交叉 | TECHNICAL | MA5/MA20 交叉狀態 |
| M07_BOLLINGER_POSITION | 布林位置 | TECHNICAL | 價格在布林通道位置 |
| M08_PE_RATIO | 本益比 | FUNDAMENTAL | 股價/每股盈餘 |
| M08_PB_RATIO | 股價淨值比 | FUNDAMENTAL | 股價/每股淨值 |
| M08_ROE | 股東權益報酬率 | FUNDAMENTAL | 淨利/股東權益 |
| M08_REVENUE_GROWTH_YOY | 營收年增率 | FUNDAMENTAL | 年度營收成長率 |
| M09_FOREIGN_NET | 外資買賣超 | CHIP | 當日外資淨買賣 |
| M09_FOREIGN_CONTINUOUS_DAYS | 外資連續天數 | CHIP | 外資連續買超/賣超天數 |
| M09_TRUST_NET | 投信買賣超 | CHIP | 當日投信淨買賣 |
| M09_MARGIN_CHANGE | 融資增減 | CHIP | 融資餘額變化 |
| M06_VOLUME_RATIO | 量比 | PRICE_VOLUME | 成交量/20日均量 |
| M06_PRICE_CHANGE_PCT | 漲跌幅 | PRICE_VOLUME | 當日漲跌百分比 |

---

#### F-M11-003: 策略執行引擎

**功能描述**: 執行策略邏輯，評估股票是否符合策略條件，產生策略信號

**執行流程**:

```
┌─────────────────────┐
│  1. 載入策略定義     │
└─────────────────────┘
          │
          ▼
┌─────────────────────┐
│  2. 取得股票清單     │ ← 可指定特定股票或全市場
└─────────────────────┘
          │
          ▼
┌─────────────────────┐
│  3. 載入因子數據     │ ← 從 M07/M08/M09 取得
└─────────────────────┘
          │
          ▼
┌─────────────────────┐
│  4. 逐一評估條件     │ ← StrategyEngine 核心
└─────────────────────┘
          │
          ▼
┌─────────────────────┐
│  5. 計算信心度分數   │ ← 依公式計算
└─────────────────────┘
          │
          ▼
┌─────────────────────┐
│  6. 產生策略信號     │ ← strategy_signals
└─────────────────────┘
          │
          ▼
┌─────────────────────┐
│  7. 儲存執行結果     │
└─────────────────────┘
```

**策略信號輸出格式**:

```json
{
  "signal_id": "STG_SIG_20241224_001",
  "strategy_id": "STG_MOMENTUM_001",
  "strategy_name": "動能反轉策略",
  "stock_id": "2330",
  "trade_date": "2024-12-24",
  "signal_type": "BUY",
  "confidence_score": 85.5,
  "matched_conditions": [
    {
      "factor_id": "M07_RSI_14",
      "factor_value": 25.3,
      "condition": "RSI < 30",
      "matched": true
    },
    {
      "factor_id": "M08_PE_RATIO",
      "factor_value": 12.5,
      "condition": "PE < 15",
      "matched": true
    },
    {
      "factor_id": "M09_FOREIGN_NET_5D",
      "factor_value": 5000000,
      "condition": "外資5日累計 > 0",
      "matched": true
    }
  ],
  "factor_values": {
    "M07_RSI_14": 25.3,
    "M08_PE_RATIO": 12.5,
    "M09_FOREIGN_NET": 2000000,
    "M09_FOREIGN_NET_5D": 5000000
  },
  "execution_time_ms": 15,
  "created_at": "2024-12-24T16:30:00+08:00"
}
```

---

#### F-M11-004: 預設策略庫

**功能描述**: 提供內建的經典量化策略，可直接使用或作為自訂策略的模板

**預設策略清單**:

| 策略 ID | 策略名稱 | 類型 | 說明 |
|--------|---------|------|------|
| STG_MOMENTUM_001 | 動能反轉策略 | MOMENTUM | RSI 超賣 + 法人買超 |
| STG_MOMENTUM_002 | 均線突破策略 | MOMENTUM | MA 黃金交叉 + 量能放大 |
| STG_MOMENTUM_003 | MACD 背離策略 | MOMENTUM | MACD 底背離 + 價量配合 |
| STG_VALUE_001 | 價值低估策略 | VALUE | 低 PE + 高 ROE + 低 PB |
| STG_VALUE_002 | 高股息策略 | VALUE | 高殖利率 + 穩定配息 |
| STG_VALUE_003 | 營收成長策略 | VALUE | 營收持續成長 + 獲利穩定 |
| STG_CHIP_001 | 法人認養策略 | HYBRID | 三大法人同買 + 技術面轉強 |
| STG_CHIP_002 | 籌碼集中策略 | HYBRID | 籌碼集中 + 融資減少 + 基本面佳 |
| STG_HYBRID_001 | 多因子綜合策略 | HYBRID | 技術+基本+籌碼綜合評分 |
| STG_HYBRID_002 | 風險調整策略 | HYBRID | 考慮波動度的綜合策略 |

**動能反轉策略範例（STG_MOMENTUM_001）**:

```json
{
  "strategy_id": "STG_MOMENTUM_001",
  "strategy_name": "動能反轉策略",
  "strategy_type": "MOMENTUM",
  "description": "尋找超賣且有法人進場的股票，捕捉反彈機會",
  "version": 1,
  "status": "ACTIVE",
  "conditions": {
    "logic": "AND",
    "conditions": [
      {
        "factor_id": "M07_RSI_14",
        "operator": "LESS_THAN",
        "value": 30
      },
      {
        "factor_id": "M07_KD_K",
        "operator": "LESS_THAN",
        "value": 20
      },
      {
        "logic": "OR",
        "conditions": [
          {
            "factor_id": "M09_FOREIGN_NET",
            "operator": "GREATER_THAN",
            "value": 0
          },
          {
            "factor_id": "M09_TRUST_NET",
            "operator": "GREATER_THAN",
            "value": 0
          }
        ]
      },
      {
        "factor_id": "M06_VOLUME_RATIO",
        "operator": "GREATER_THAN",
        "value": 1.0
      }
    ]
  },
  "parameters": {
    "rsi_threshold": 30,
    "kd_threshold": 20,
    "volume_ratio_min": 1.0,
    "lookback_days": 60
  },
  "output": {
    "signal_type": "BUY",
    "confidence_formula": "(30 - RSI) / 30 * 0.4 + (20 - KD_K) / 20 * 0.3 + volume_score * 0.3"
  }
}
```

---

### 2.3 P1 進階功能詳細需求

#### F-M11-005: 策略執行歷史

**功能描述**: 查詢策略執行記錄與績效統計

**查詢維度**:

| 維度 | 說明 |
|-----|------|
| 依策略 | 查詢特定策略的所有執行記錄 |
| 依股票 | 查詢特定股票的所有策略信號 |
| 依日期 | 查詢特定日期範圍的執行記錄 |
| 依信號類型 | 只查詢 BUY/SELL/HOLD 信號 |

**績效統計指標**:

| 指標 | 說明 |
|-----|------|
| total_signals | 總信號數 |
| buy_signals | 買進信號數 |
| sell_signals | 賣出信號數 |
| avg_confidence | 平均信心度 |
| hit_rate | 命中率（需回測驗證） |
| avg_return | 平均報酬率（需回測驗證） |

---

#### F-M11-006: 策略參數優化

**功能描述**: 對策略參數進行網格搜索，找出最佳參數組合

**優化方法**:

| 方法 | 說明 | 適用場景 |
|-----|------|---------|
| Grid Search | 網格搜索 | 參數空間小 |
| Random Search | 隨機搜索 | 參數空間大 |
| Bayesian | 貝葉斯優化 | 計算成本高（P2） |

**參數定義格式**:

```json
{
  "optimization_config": {
    "method": "GRID_SEARCH",
    "objective": "SHARPE_RATIO",
    "parameters": [
      {
        "param_name": "rsi_threshold",
        "param_type": "INTEGER",
        "min_value": 20,
        "max_value": 40,
        "step": 5
      },
      {
        "param_name": "volume_ratio_min",
        "param_type": "DECIMAL",
        "min_value": 0.5,
        "max_value": 2.0,
        "step": 0.25
      }
    ],
    "backtest_period": {
      "start_date": "2023-01-01",
      "end_date": "2024-12-31"
    }
  }
}
```

---

#### F-M11-007: 策略回測觸發

**功能描述**: 觸發 M16 回測系統執行策略回測

**與 M16 的介面**:

```json
{
  "backtest_request": {
    "strategy_id": "STG_MOMENTUM_001",
    "strategy_version": 1,
    "backtest_config": {
      "start_date": "2023-01-01",
      "end_date": "2024-12-31",
      "initial_capital": 1000000,
      "position_size": 0.1,
      "commission_rate": 0.001425,
      "tax_rate": 0.003,
      "slippage": 0.001
    },
    "stock_universe": {
      "market_type": "TWSE",
      "min_volume": 1000,
      "exclude_etf": true
    }
  }
}
```

---

## 3. 策略執行引擎架構

### 3.1 引擎設計（參考 M07/M08/M09 模式）

```
┌─────────────────────────────────────────────────────────────────┐
│                   StrategyEngine（引擎介面）                       │
│  ┌────────────────────────────────────────────────────────┐    │
│  │              DefaultStrategyEngine                       │    │
│  │  ┌──────────────────────────────────────────────────┐  │    │
│  │  │          StrategyEvaluatorRegistry                │  │    │
│  │  │  ┌────────────────────────────────────────────┐  │  │    │
│  │  │  │         StrategyEvaluator 介面              │  │  │    │
│  │  │  │  ┌────────────┐ ┌────────────┐            │  │  │    │
│  │  │  │  │ Condition  │ │  Signal    │            │  │  │    │
│  │  │  │  │ Evaluator  │ │ Generator  │            │  │  │    │
│  │  │  │  └────────────┘ └────────────┘            │  │  │    │
│  │  │  │  ┌────────────┐ ┌────────────┐            │  │  │    │
│  │  │  │  │ Confidence │ │ Diagnostics│            │  │  │    │
│  │  │  │  │ Calculator │ │  Collector │            │  │  │    │
│  │  │  │  └────────────┘ └────────────┘            │  │  │    │
│  │  │  └────────────────────────────────────────────┘  │  │    │
│  │  └──────────────────────────────────────────────────┘  │    │
│  │                                                         │    │
│  │  ┌──────────────────────────────────────────────────┐  │    │
│  │  │            FactorDataLoader                       │  │    │
│  │  │  ┌────────────┐ ┌────────────┐ ┌────────────┐   │  │    │
│  │  │  │ M07 Loader │ │ M08 Loader │ │ M09 Loader │   │  │    │
│  │  │  │(技術指標)   │ │(財務指標)   │ │(籌碼指標)   │   │  │    │
│  │  │  └────────────┘ └────────────┘ └────────────┘   │  │    │
│  │  └──────────────────────────────────────────────────┘  │    │
│  └────────────────────────────────────────────────────────┘    │
└─────────────────────────────────────────────────────────────────┘
```

### 3.2 核心元件說明

| 元件 | 職責 |
|-----|------|
| StrategyEngine | 策略執行引擎介面，定義執行契約 |
| DefaultStrategyEngine | 預設實作，協調各評估器執行 |
| StrategyEvaluatorRegistry | 評估器註冊表，管理所有評估器 |
| ConditionEvaluator | 評估單一條件是否成立 |
| SignalGenerator | 根據條件評估結果產生信號 |
| ConfidenceCalculator | 計算信號信心度分數 |
| DiagnosticsCollector | 收集執行診斷資訊 |
| FactorDataLoader | 從 M07/M08/M09 載入因子數據 |

### 3.3 執行計劃（StrategyExecutionPlan）

```java
StrategyExecutionPlan plan = StrategyExecutionPlan.builder()
    .strategyId("STG_MOMENTUM_001")
    .executionDate(LocalDate.now())
    .stockUniverse(StockUniverse.TWSE_ALL)      // 股票範圍
    .includeFactorValues(true)                   // 是否包含因子值
    .includeDiagnostics(true)                    // 是否包含診斷
    .parallelExecution(true)                     // 是否平行執行
    .batchSize(100)                              // 批次大小
    .build();
```

---

## 4. 非功能性需求

### 4.1 效能需求

| 項目 | 目標值 | 說明 |
|-----|-------|------|
| 單一股票策略評估 | < 20ms | 評估一檔股票是否符合策略 |
| 全市場策略執行 | < 2 分鐘 | 1800 檔股票完整評估 |
| 策略查詢 | < 50ms | 策略定義查詢 |
| 信號查詢 | < 100ms | 策略信號歷史查詢 |
| 因子載入 | < 500ms | 單一股票所有因子載入 |

### 4.2 資料需求

| 項目 | 需求 | 說明 |
|-----|------|------|
| 因子數據新鮮度 | 當日 16:30 前 | M07/M08/M09 計算完成後 |
| 歷史因子數據 | 60 個交易日 | 策略評估回溯期 |
| 策略執行記錄 | 保留 1 年 | strategy_executions 資料 |
| 策略信號記錄 | 保留 90 天 | strategy_signals 熱資料 |

### 4.3 快取策略

| 快取類型 | TTL | 說明 |
|---------|-----|------|
| 策略定義 | 24 小時 | 策略變更頻率低 |
| 因子元數據 | 24 小時 | 元數據不常變動 |
| 因子數據 | 6 小時 | 當日計算結果 |
| 策略執行結果 | 1 小時 | 執行結果快取 |

---

## 5. 錯誤碼定義

| 錯誤碼 | 說明 | HTTP Status |
|-------|------|-------------|
| M11_STG_001 | 策略不存在 | 404 |
| M11_STG_002 | 策略定義格式錯誤 | 400 |
| M11_STG_003 | 策略條件無效 | 400 |
| M11_STG_004 | 策略版本衝突 | 409 |
| M11_STG_005 | 策略已停用 | 400 |
| M11_FACTOR_001 | 因子不存在 | 404 |
| M11_FACTOR_002 | 因子數據不足 | 400 |
| M11_FACTOR_003 | 因子類型不符 | 400 |
| M11_EXEC_001 | 策略執行失敗 | 500 |
| M11_EXEC_002 | 執行逾時 | 504 |
| M11_PARAM_001 | 參數格式錯誤 | 400 |
| M11_PARAM_002 | 日期範圍無效 | 400 |

---

## 6. 為何採用 MyBatis

### 6.1 持久層選擇理由

| 考量因素 | MyBatis 優勢 |
|---------|-------------|
| 多表 JOIN | 策略執行需跨 M07/M08/M09 多表 JOIN 讀取因子數據 |
| 動態 SQL | 策略條件可彈性配置，需要動態組合 SQL |
| 讀取導向 | 策略執行主要是讀取分析結果，寫入量少 |
| 效能優化 | 複雜查詢可精細調校 SQL |
| 無 ORM 聚合 | 不需要 JPA 的實體關聯管理 |

### 6.2 典型查詢場景

```sql
-- 策略執行時載入多模組因子數據
SELECT
    s.stock_id,
    s.stock_name,
    -- M07 技術指標
    t.rsi_14,
    t.macd_histogram,
    t.ma5,
    t.ma20,
    -- M08 財務指標
    f.pe_ratio,
    f.pb_ratio,
    f.roe,
    -- M09 籌碼指標
    c.foreign_net,
    c.foreign_continuous_days,
    c.trust_net
FROM stocks s
LEFT JOIN technical_indicators t ON s.stock_id = t.stock_id AND t.trade_date = #{tradeDate}
LEFT JOIN fundamental_indicators f ON s.stock_id = f.stock_id AND f.report_date = #{latestReportDate}
LEFT JOIN chip_analysis_results c ON s.stock_id = c.stock_id AND c.trade_date = #{tradeDate}
WHERE s.is_active = true
  AND s.market_type = #{marketType}
```

---

## 📚 相關文檔

- [M11 API規格](../api/M11-API規格.md)
- [M11 資料庫設計](../../design/M11-資料庫設計.md)
- [M11 業務流程](../../design/M11-業務流程.md)
- [M07 技術分析功能需求](./M07-技術分析功能需求.md)
- [M08 基本面分析功能需求](./M08-基本面分析功能需求.md)
- [M09 籌碼分析功能需求](./M09-籌碼分析功能需求.md)
- [M13 信號判斷引擎功能需求](./M13-信號判斷引擎功能需求.md)

---

**文件維護者**: 產品經理
**最後更新**: 2026-01-14
**下次審核**: 2026-04-14
