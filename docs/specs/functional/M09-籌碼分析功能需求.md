# M09-ç±Œç¢¼åˆ†ææ¨¡çµ„åŠŸèƒ½éœ€æ±‚

> **æ–‡ä»¶ç·¨è™Ÿ**: FUNC-M09
> **æ¨¡çµ„åç¨±**: ç±Œç¢¼åˆ†ææ¨¡çµ„
> **ç‰ˆæœ¬**: v1.1
> **æœ€å¾Œæ›´æ–°**: 2026-01-15
> **ç‹€æ…‹**: Active

---

## 1. æ¨¡çµ„æ¦‚è¿°

### 1.1 æ¨¡çµ„å®šä½

M09 ç±Œç¢¼åˆ†ææ¨¡çµ„è² è²¬åˆ†æä¸‰å¤§æ³•äººè²·è³£è¶…ã€èè³‡èåˆ¸ç­‰ç±Œç¢¼æ•¸æ“šï¼Œæä¾›ç±Œç¢¼é¢æŒ‡æ¨™è¨ˆç®—èˆ‡ç•°å¸¸è¨Šè™Ÿåµæ¸¬åŠŸèƒ½ã€‚

**åœ¨ç³»çµ±æ¶æ§‹ä¸­çš„ä½ç½®**:
```
Layer 2: åˆ†æå±¤
â”œâ”€â”€ M07 æŠ€è¡“åˆ†ææ¨¡çµ„ï¼ˆæŠ€è¡“é¢ï¼‰
â”œâ”€â”€ M08 åŸºæœ¬é¢åˆ†ææ¨¡çµ„ï¼ˆåŸºæœ¬é¢ï¼‰
â””â”€â”€ M09 ç±Œç¢¼åˆ†ææ¨¡çµ„ï¼ˆç±Œç¢¼é¢ï¼‰â† æœ¬æ¨¡çµ„
```

### 1.2 æ ¸å¿ƒåƒ¹å€¼

| åƒ¹å€¼é …ç›® | èªªæ˜ |
|---------|------|
| æ³•äººå‹•å‘è¿½è¹¤ | è¿½è¹¤å¤–è³‡ã€æŠ•ä¿¡ã€è‡ªç‡Ÿå•†çš„è²·è³£è¶…è¶¨å‹¢ |
| æ•£æˆ¶ç±Œç¢¼åˆ†æ | é€éèè³‡èåˆ¸åˆ¤æ–·æ•£æˆ¶å‹•å‘ |
| ç±Œç¢¼é›†ä¸­åº¦ | åˆ†æç±Œç¢¼é›†ä¸­æˆ–ç™¼æ•£ç¨‹åº¦ |
| ç•°å¸¸è¨Šè™Ÿåµæ¸¬ | åµæ¸¬å¤§å–®ã€é€£çºŒè²·è¶…/è³£è¶…ã€èè³‡æ–·é ­ç­‰ç•°å¸¸æƒ…æ³ |

### 1.3 æ¨¡çµ„ä¾è³´

| ä¾è³´æ¨¡çµ„ | ä¾è³´é¡å‹ | èªªæ˜ |
|---------|---------|------|
| M06 è³‡æ–™ç®¡ç†æ¨¡çµ„ | è³‡æ–™ä¾è³´ | å–å¾— institutional_tradingã€margin_trading åŸå§‹è³‡æ–™ |
| M00 å…±ç”¨æ¨¡çµ„ | æŠ€è¡“ä¾è³´ | ä½¿ç”¨å…±ç”¨ DTOã€Exceptionã€Utils |

### 1.4 å¯¦ä½œé€²åº¦

> **æœ€å¾Œæ›´æ–°**: 2026-01-15

| å„ªå…ˆç´š | æŒ‡æ¨™çµ„ | è¨ˆç•«æ•¸é‡ | å·²å®Œæˆ | é€²åº¦ | ç‹€æ…‹ |
|-------|-------|---------|-------|------|------|
| P0 | åŸºç¤çµ„ | 3 | 3 | 100% | âœ… å·²å®Œæˆ |
| P1 | é€²éšçµ„ | 4 | 4 | 100% | âœ… å·²å®Œæˆ |
| P2 | å°ˆæ¥­çµ„ | 2 | 0 | 0% | â³ å¾…é–‹ç™¼ |

**P0 å·²å®Œæˆ**:
- ä¸‰å¤§æ³•äººæŒ‡æ¨™è¨ˆç®—å™¨ï¼šForeignNetCalculator, TrustNetCalculator, DealerNetCalculator, ContinuousDaysCalculator
- èè³‡èåˆ¸æŒ‡æ¨™è¨ˆç®—å™¨ï¼šMarginBalanceCalculator, ShortBalanceCalculator, MarginShortRatioCalculator
- ç±Œç¢¼ç•°å¸¸è¨Šè™Ÿåµæ¸¬ï¼šInstitutionalSignalDetector, MarginSignalDetector

**P1 å·²å®Œæˆ**:
- è³‡æ–™å­˜å–å±¤ï¼šChipSeriesProvider, ChipAnalysisResult, ChipSignalEntity, Repositories, Mapper
- DTO èˆ‡è½‰æ›å™¨ï¼šChipAnalysisResultDTO, ChipSignalDTO, ChipRankingDTO, Request/Response DTOs, Converters
- æœå‹™å±¤ï¼šChipCalculationService, ChipQueryService
- æ§åˆ¶å™¨å±¤ï¼šChipQueryController, ChipJobController (6 å€‹ API ç«¯é»)

**P2 å¾…é–‹ç™¼**:
- F-M09-003 ç±Œç¢¼é›†ä¸­åº¦åˆ†æ
- F-M09-004 ä¸»åŠ›æˆæœ¬ä¼°ç®—

> è©³ç´°é–‹ç™¼è¨˜éŒ„è«‹åƒé–± [é–‹ç™¼è¨˜éŒ„](../../design/M09-é–‹ç™¼è¨˜éŒ„.md)

---

## 2. åŠŸèƒ½æ¸…å–®

### 2.1 åŠŸèƒ½ç¸½è¦½

| åŠŸèƒ½ç·¨è™Ÿ | åŠŸèƒ½åç¨± | å„ªå…ˆç´š | èªªæ˜ |
|---------|---------|-------|------|
| F-M09-001 | ä¸‰å¤§æ³•äººæŒ‡æ¨™è¨ˆç®— | P0 | è¨ˆç®—å¤–è³‡ã€æŠ•ä¿¡ã€è‡ªç‡Ÿå•†ç›¸é—œæŒ‡æ¨™ |
| F-M09-002 | èè³‡èåˆ¸æŒ‡æ¨™è¨ˆç®— | P0 | è¨ˆç®—èè³‡ã€èåˆ¸é¤˜é¡åŠä½¿ç”¨ç‡ç›¸é—œæŒ‡æ¨™ |
| F-M09-003 | ç±Œç¢¼é›†ä¸­åº¦åˆ†æ | P1 | è¨ˆç®—ç±Œç¢¼é›†ä¸­åº¦ã€åˆ†æ•£åº¦æŒ‡æ¨™ |
| F-M09-004 | ä¸»åŠ›æˆæœ¬ä¼°ç®— | P1 | ä¼°ç®—æ³•äººæŒè‚¡æˆæœ¬åŠæç›Š |
| F-M09-005 | ç±Œç¢¼ç•°å¸¸åµæ¸¬ | P0 | åµæ¸¬ç•°å¸¸ç±Œç¢¼è®ŠåŒ–ï¼ˆå¤§å–®ã€é€£çºŒè²·è³£è¶…ç­‰ï¼‰ |
| F-M09-006 | ç±Œç¢¼åˆ†æå ±å‘Š | P2 | ç”Ÿæˆç±Œç¢¼åˆ†æå ±å‘Šæ‘˜è¦ |
| F-M09-007 | ç±Œç¢¼æ’è¡Œæ¦œ | P1 | å¤–è³‡è²·è¶…ã€æŠ•ä¿¡è²·è¶…ã€èè³‡å¢æ¸›æ’è¡Œ |
| F-M09-008 | æ­·å²ç±Œç¢¼æŸ¥è©¢ | P1 | æŸ¥è©¢æ­·å²ç±Œç¢¼åˆ†æçµæœ |

---

### 2.2 P0 æ ¸å¿ƒåŠŸèƒ½è©³ç´°éœ€æ±‚

#### F-M09-001: ä¸‰å¤§æ³•äººæŒ‡æ¨™è¨ˆç®—

**åŠŸèƒ½æè¿°**: è¨ˆç®—ä¸‰å¤§æ³•äººï¼ˆå¤–è³‡ã€æŠ•ä¿¡ã€è‡ªç‡Ÿå•†ï¼‰è²·è³£è¶…ç›¸é—œæŒ‡æ¨™

**è¨ˆç®—æŒ‡æ¨™æ¸…å–®**:

| æŒ‡æ¨™ç·¨è™Ÿ | æŒ‡æ¨™åç¨± | ä¸­æ–‡åç¨± | è¨ˆç®—å…¬å¼ | å„ªå…ˆç´š |
|---------|---------|---------|---------|-------|
| INST001 | foreign_net | å¤–è³‡è²·è³£è¶… | foreign_buy - foreign_sell | P0 |
| INST002 | trust_net | æŠ•ä¿¡è²·è³£è¶… | trust_buy - trust_sell | P0 |
| INST003 | dealer_net | è‡ªç‡Ÿå•†è²·è³£è¶… | dealer_buy - dealer_sell | P0 |
| INST004 | total_net | ä¸‰å¤§æ³•äººåˆè¨ˆ | foreign_net + trust_net + dealer_net | P0 |
| INST005 | foreign_net_ma5 | å¤–è³‡è²·è³£è¶…5æ—¥å‡ | SMA(foreign_net, 5) | P0 |
| INST006 | foreign_net_ma20 | å¤–è³‡è²·è³£è¶…20æ—¥å‡ | SMA(foreign_net, 20) | P0 |
| INST007 | trust_net_ma5 | æŠ•ä¿¡è²·è³£è¶…5æ—¥å‡ | SMA(trust_net, 5) | P0 |
| INST008 | trust_net_ma20 | æŠ•ä¿¡è²·è³£è¶…20æ—¥å‡ | SMA(trust_net, 20) | P0 |
| INST009 | foreign_continuous_days | å¤–è³‡é€£çºŒè²·è¶…å¤©æ•¸ | é€£çºŒ foreign_net > 0 çš„å¤©æ•¸ï¼ˆè² æ•¸è¡¨ç¤ºé€£çºŒè³£è¶…ï¼‰ | P0 |
| INST010 | trust_continuous_days | æŠ•ä¿¡é€£çºŒè²·è¶…å¤©æ•¸ | é€£çºŒ trust_net > 0 çš„å¤©æ•¸ | P0 |
| INST011 | foreign_accumulated_n | å¤–è³‡Næ—¥ç´¯è¨ˆ | SUM(foreign_net, N) | P0 |
| INST012 | trust_accumulated_n | æŠ•ä¿¡Næ—¥ç´¯è¨ˆ | SUM(trust_net, N) | P1 |
| INST013 | foreign_buy_ratio | å¤–è³‡è²·è¶…ä½”æˆäº¤æ¯” | foreign_net / volume * 100 | P1 |
| INST014 | trust_buy_ratio | æŠ•ä¿¡è²·è¶…ä½”æˆäº¤æ¯” | trust_net / volume * 100 | P1 |
| INST015 | institutional_agreement | æ³•äººè²·è¶…ä¸€è‡´æ€§ | ä¸‰å¤§æ³•äººåŒå‘è²·è¶…/è³£è¶…çš„æ¯”ä¾‹ | P1 |

**è¼¸å…¥åƒæ•¸**:
```json
{
  "stock_id": "2330",
  "start_date": "2024-01-01",
  "end_date": "2024-12-31",
  "indicators": ["INST001", "INST005", "INST009"]
}
```

**è¼¸å‡ºæ ¼å¼**:
```json
{
  "stock_id": "2330",
  "calculation_date": "2024-12-24",
  "institutional_indicators": {
    "foreign_net": 5000000,
    "foreign_net_ma5": 3500000,
    "foreign_net_ma20": 2800000,
    "foreign_continuous_days": 5,
    "trust_net": 800000,
    "trust_net_ma5": 600000,
    "dealer_net": -200000,
    "total_net": 5600000
  },
  "diagnostics": {
    "calculation_time_ms": 15,
    "warnings": []
  }
}
```

---

#### F-M09-002: èè³‡èåˆ¸æŒ‡æ¨™è¨ˆç®—

**åŠŸèƒ½æè¿°**: è¨ˆç®—èè³‡èåˆ¸é¤˜é¡ã€ä½¿ç”¨ç‡åŠè®ŠåŒ–ç›¸é—œæŒ‡æ¨™

**è¨ˆç®—æŒ‡æ¨™æ¸…å–®**:

| æŒ‡æ¨™ç·¨è™Ÿ | æŒ‡æ¨™åç¨± | ä¸­æ–‡åç¨± | è¨ˆç®—å…¬å¼ | å„ªå…ˆç´š |
|---------|---------|---------|---------|-------|
| MRGN001 | margin_balance | èè³‡é¤˜é¡ | ç•¶æ—¥èè³‡é¤˜é¡ | P0 |
| MRGN002 | margin_change | èè³‡å¢æ¸› | ç•¶æ—¥èè³‡é¤˜é¡ - å‰æ—¥èè³‡é¤˜é¡ | P0 |
| MRGN003 | margin_usage_rate | èè³‡ä½¿ç”¨ç‡ | margin_balance / margin_quota * 100 | P0 |
| MRGN004 | short_balance | èåˆ¸é¤˜é¡ | ç•¶æ—¥èåˆ¸é¤˜é¡ | P0 |
| MRGN005 | short_change | èåˆ¸å¢æ¸› | ç•¶æ—¥èåˆ¸é¤˜é¡ - å‰æ—¥èåˆ¸é¤˜é¡ | P0 |
| MRGN006 | short_usage_rate | èåˆ¸ä½¿ç”¨ç‡ | short_balance / short_quota * 100 | P0 |
| MRGN007 | margin_short_ratio | åˆ¸è³‡æ¯” | short_balance / margin_balance * 100 | P0 |
| MRGN008 | margin_change_ma5 | èè³‡å¢æ¸›5æ—¥å‡ | SMA(margin_change, 5) | P1 |
| MRGN009 | margin_usage_ma20 | èè³‡ä½¿ç”¨ç‡20æ—¥å‡ | SMA(margin_usage_rate, 20) | P1 |
| MRGN010 | margin_continuous_days | èè³‡é€£çºŒå¢åŠ å¤©æ•¸ | é€£çºŒ margin_change > 0 çš„å¤©æ•¸ | P1 |
| MRGN011 | short_continuous_days | èåˆ¸é€£çºŒå¢åŠ å¤©æ•¸ | é€£çºŒ short_change > 0 çš„å¤©æ•¸ | P1 |
| MRGN012 | margin_accumulated_n | èè³‡Næ—¥ç´¯è¨ˆå¢æ¸› | SUM(margin_change, N) | P1 |
| MRGN013 | margin_pressure | èè³‡å£“åŠ›æŒ‡æ¨™ | (margin_usage_rate - avg_20) / std_20 | P2 |

**è¼¸å‡ºæ ¼å¼**:
```json
{
  "stock_id": "2330",
  "calculation_date": "2024-12-24",
  "margin_indicators": {
    "margin_balance": 125000,
    "margin_change": 5000,
    "margin_usage_rate": 45.2,
    "short_balance": 8000,
    "short_change": -500,
    "short_usage_rate": 12.5,
    "margin_short_ratio": 6.4,
    "margin_continuous_days": 3
  }
}
```

---

#### F-M09-005: ç±Œç¢¼ç•°å¸¸åµæ¸¬

**åŠŸèƒ½æè¿°**: åµæ¸¬ç•°å¸¸ç±Œç¢¼è®ŠåŒ–ï¼Œç”¢ç”Ÿç•°å¸¸è¨Šè™Ÿ

**ç•°å¸¸è¨Šè™Ÿé¡å‹**:

| è¨Šè™Ÿç·¨è™Ÿ | è¨Šè™Ÿåç¨± | åµæ¸¬æ¢ä»¶ | åš´é‡åº¦ |
|---------|---------|---------|-------|
| CHIP_SIG_001 | å¤–è³‡å¤§è²· | foreign_net > avg_20 + 2*std_20 | HIGH |
| CHIP_SIG_002 | å¤–è³‡å¤§è³£ | foreign_net < avg_20 - 2*std_20 | HIGH |
| CHIP_SIG_003 | å¤–è³‡é€£çºŒè²·è¶… | foreign_continuous_days >= 5 | MEDIUM |
| CHIP_SIG_004 | å¤–è³‡é€£çºŒè³£è¶… | foreign_continuous_days <= -5 | MEDIUM |
| CHIP_SIG_005 | æŠ•ä¿¡å¤§è²· | trust_net > avg_20 + 2*std_20 | HIGH |
| CHIP_SIG_006 | æŠ•ä¿¡é€£çºŒè²·è¶… | trust_continuous_days >= 3 | MEDIUM |
| CHIP_SIG_007 | ä¸‰å¤§æ³•äººåŒè²· | å¤–è³‡ã€æŠ•ä¿¡ã€è‡ªç‡Ÿçš†è²·è¶… | MEDIUM |
| CHIP_SIG_008 | ä¸‰å¤§æ³•äººåŒè³£ | å¤–è³‡ã€æŠ•ä¿¡ã€è‡ªç‡Ÿçš†è³£è¶… | HIGH |
| CHIP_SIG_009 | èè³‡æš´å¢ | margin_change > avg_20 + 3*std_20 | HIGH |
| CHIP_SIG_010 | èè³‡æ–·é ­ | margin_change < -10% of margin_balance | CRITICAL |
| CHIP_SIG_011 | èåˆ¸å¤§å¢ | short_change > avg_20 + 2*std_20 | MEDIUM |
| CHIP_SIG_012 | åˆ¸è³‡æ¯”éé«˜ | margin_short_ratio > 30 | HIGH |
| CHIP_SIG_013 | èè³‡ä½¿ç”¨ç‡éé«˜ | margin_usage_rate > 80 | HIGH |
| CHIP_SIG_014 | ç±Œç¢¼åˆ†æ­§ | æ³•äººè²·è³£æ–¹å‘èˆ‡èè³‡æ–¹å‘ç›¸å | MEDIUM |

**è¨Šè™Ÿè¼¸å‡ºæ ¼å¼**:
```json
{
  "stock_id": "2330",
  "trade_date": "2024-12-24",
  "signals": [
    {
      "signal_id": "CHIP_SIG_001",
      "signal_name": "å¤–è³‡å¤§è²·",
      "severity": "HIGH",
      "value": 15000000,
      "threshold": 8000000,
      "description": "å¤–è³‡è²·è¶… 15,000,000 è‚¡ï¼Œè¶…é 20 æ—¥å¹³å‡ 2 å€‹æ¨™æº–å·®"
    },
    {
      "signal_id": "CHIP_SIG_007",
      "signal_name": "ä¸‰å¤§æ³•äººåŒè²·",
      "severity": "MEDIUM",
      "description": "å¤–è³‡ã€æŠ•ä¿¡ã€è‡ªç‡Ÿå•†çš†ç‚ºè²·è¶…"
    }
  ]
}
```

---

### 2.3 P1 é€²éšåŠŸèƒ½è©³ç´°éœ€æ±‚

#### F-M09-003: ç±Œç¢¼é›†ä¸­åº¦åˆ†æ

**åŠŸèƒ½æè¿°**: åˆ†æç±Œç¢¼é›†ä¸­æ–¼æ³•äººæˆ–æ•£æˆ¶çš„ç¨‹åº¦

**è¨ˆç®—æŒ‡æ¨™**:

| æŒ‡æ¨™ç·¨è™Ÿ | æŒ‡æ¨™åç¨± | è¨ˆç®—å…¬å¼ | èªªæ˜ |
|---------|---------|---------|------|
| CONC001 | institutional_ratio | (ç´¯è¨ˆæ³•äººè²·è¶… / æµé€šè‚¡æ•¸) * 100 | æ³•äººæŒè‚¡æ¯”ä¾‹ä¼°ç®— |
| CONC002 | retail_ratio | 100 - institutional_ratio | æ•£æˆ¶æŒè‚¡æ¯”ä¾‹ä¼°ç®— |
| CONC003 | concentration_trend | è¿‘Næ—¥ institutional_ratio è®ŠåŒ– | ç±Œç¢¼é›†ä¸­è¶¨å‹¢ |
| CONC004 | margin_to_capital | margin_balance / issued_shares * 100 | èè³‡ä½”è‚¡æœ¬æ¯” |

---

#### F-M09-004: ä¸»åŠ›æˆæœ¬ä¼°ç®—

**åŠŸèƒ½æè¿°**: ä¼°ç®—æ³•äººæŒè‚¡å¹³å‡æˆæœ¬

**è¨ˆç®—æ–¹æ³•**:
```
ä¸»åŠ›æˆæœ¬ = Î£(è²·é€²å¼µæ•¸ Ã— è²·é€²å‡åƒ¹) / Î£(è²·é€²å¼µæ•¸)

å…¶ä¸­è²·é€²å‡åƒ¹å¯ç”¨ç•¶æ—¥å‡åƒ¹ä¼°ç®—:
ç•¶æ—¥å‡åƒ¹ = (æœ€é«˜åƒ¹ + æœ€ä½åƒ¹ + æ”¶ç›¤åƒ¹) / 3
```

**è¼¸å‡ºæŒ‡æ¨™**:

| æŒ‡æ¨™ç·¨è™Ÿ | æŒ‡æ¨™åç¨± | èªªæ˜ |
|---------|---------|------|
| COST001 | foreign_avg_cost | å¤–è³‡ä¼°è¨ˆæŒè‚¡æˆæœ¬ |
| COST002 | trust_avg_cost | æŠ•ä¿¡ä¼°è¨ˆæŒè‚¡æˆæœ¬ |
| COST003 | foreign_profit_rate | å¤–è³‡ä¼°è¨ˆå ±é…¬ç‡ |
| COST004 | trust_profit_rate | æŠ•ä¿¡ä¼°è¨ˆå ±é…¬ç‡ |

---

#### F-M09-007: ç±Œç¢¼æ’è¡Œæ¦œ

**åŠŸèƒ½æè¿°**: æä¾›å„é¡ç±Œç¢¼æ’è¡Œæ¦œæŸ¥è©¢

**æ’è¡Œæ¦œé¡å‹**:

| æ’è¡Œæ¦œç·¨è™Ÿ | æ’è¡Œæ¦œåç¨± | æ’åºä¾æ“š |
|-----------|-----------|---------|
| RANK001 | å¤–è³‡è²·è¶…æ’è¡Œ | foreign_net DESC |
| RANK002 | å¤–è³‡è³£è¶…æ’è¡Œ | foreign_net ASC |
| RANK003 | æŠ•ä¿¡è²·è¶…æ’è¡Œ | trust_net DESC |
| RANK004 | æŠ•ä¿¡è³£è¶…æ’è¡Œ | trust_net ASC |
| RANK005 | å¤–è³‡é€£çºŒè²·è¶…æ’è¡Œ | foreign_continuous_days DESC |
| RANK006 | èè³‡å¢åŠ æ’è¡Œ | margin_change DESC |
| RANK007 | èè³‡æ¸›å°‘æ’è¡Œ | margin_change ASC |
| RANK008 | åˆ¸è³‡æ¯”æ’è¡Œ | margin_short_ratio DESC |
| RANK009 | ä¸‰å¤§æ³•äººåˆè¨ˆè²·è¶… | total_net DESC |
| RANK010 | Næ—¥æ³•äººç´¯è¨ˆè²·è¶… | foreign_accumulated_n DESC |

**æŸ¥è©¢åƒæ•¸**:
```json
{
  "rank_type": "RANK001",
  "trade_date": "2024-12-24",
  "market_type": "TWSE",
  "limit": 50,
  "min_volume": 1000
}
```

---

## 3. ç±Œç¢¼è¨ˆç®—å¼•æ“æ¶æ§‹

### 3.1 å¼•æ“è¨­è¨ˆï¼ˆåƒè€ƒ M07/M08 æ¨¡å¼ï¼‰

```
ChipEngine (ä»‹é¢)
    â†“
DefaultChipEngine (é è¨­å¯¦ä½œ)
    â†“
ChipCalculatorRegistry (è¨ˆç®—å™¨è¨»å†Šè¡¨)
    â†“
ChipCalculator (è¨ˆç®—å™¨ä»‹é¢)
    â”œâ”€â”€ InstitutionalCalculator (ä¸‰å¤§æ³•äººè¨ˆç®—å™¨)
    â”‚   â”œâ”€â”€ ForeignNetCalculator
    â”‚   â”œâ”€â”€ TrustNetCalculator
    â”‚   â”œâ”€â”€ DealerNetCalculator
    â”‚   â””â”€â”€ ContinuousDaysCalculator
    â”œâ”€â”€ MarginCalculator (èè³‡èåˆ¸è¨ˆç®—å™¨)
    â”‚   â”œâ”€â”€ MarginBalanceCalculator
    â”‚   â”œâ”€â”€ MarginUsageCalculator
    â”‚   â””â”€â”€ MarginShortRatioCalculator
    â”œâ”€â”€ ConcentrationCalculator (ç±Œç¢¼é›†ä¸­åº¦è¨ˆç®—å™¨)
    â””â”€â”€ SignalDetector (è¨Šè™Ÿåµæ¸¬å™¨)
        â”œâ”€â”€ InstitutionalSignalDetector
        â””â”€â”€ MarginSignalDetector
```

### 3.2 è¨ˆç®—å™¨åˆ†é¡

| é¡åˆ¥ | Category å¸¸æ•¸ | åŒ…å«è¨ˆç®—å™¨ |
|-----|--------------|-----------|
| ä¸‰å¤§æ³•äºº | INSTITUTIONAL | ForeignNetCalculator, TrustNetCalculator, ... |
| èè³‡èåˆ¸ | MARGIN | MarginBalanceCalculator, MarginUsageCalculator, ... |
| ç±Œç¢¼é›†ä¸­åº¦ | CONCENTRATION | ConcentrationCalculator |
| æˆæœ¬ä¼°ç®— | COST | CostEstimationCalculator |
| è¨Šè™Ÿåµæ¸¬ | SIGNAL | InstitutionalSignalDetector, MarginSignalDetector |

### 3.3 è¨ˆç®—è¨ˆåŠƒï¼ˆCalculationPlanï¼‰

```java
ChipCalculationPlan plan = ChipCalculationPlan.builder()
    .includeInstitutional(true)     // è¨ˆç®—ä¸‰å¤§æ³•äººæŒ‡æ¨™
    .includeMargin(true)            // è¨ˆç®—èè³‡èåˆ¸æŒ‡æ¨™
    .includeConcentration(true)     // è¨ˆç®—ç±Œç¢¼é›†ä¸­åº¦
    .includeCost(false)             // ä¸è¨ˆç®—æˆæœ¬ä¼°ç®—
    .includeSignals(true)           // åµæ¸¬ç±Œç¢¼ç•°å¸¸è¨Šè™Ÿ
    .lookbackPeriod(60)             // å›æº¯ 60 å€‹äº¤æ˜“æ—¥
    .build();
```

---

## 4. éåŠŸèƒ½æ€§éœ€æ±‚

### 4.1 æ•ˆèƒ½éœ€æ±‚

| é …ç›® | ç›®æ¨™å€¼ | èªªæ˜ |
|-----|-------|------|
| å–®ä¸€è‚¡ç¥¨æŒ‡æ¨™è¨ˆç®— | < 50ms | è¨ˆç®—æ‰€æœ‰ P0 æŒ‡æ¨™ |
| æ‰¹æ¬¡è¨ˆç®—ï¼ˆ100è‚¡ï¼‰ | < 2s | åŒ…å«æ‰€æœ‰æŒ‡æ¨™ |
| æ’è¡Œæ¦œæŸ¥è©¢ | < 100ms | å« 50 ç­†çµæœ |
| ç•°å¸¸è¨Šè™Ÿæƒæ | < 5s | å…¨å¸‚å ´ 1800 æª”è‚¡ç¥¨ |

### 4.2 è³‡æ–™éœ€æ±‚

| é …ç›® | éœ€æ±‚ | èªªæ˜ |
|-----|------|------|
| æœ€å°‘è³‡æ–™å¤©æ•¸ | 20 å€‹äº¤æ˜“æ—¥ | è¨ˆç®— MA20 éœ€è¦ |
| å»ºè­°è³‡æ–™å¤©æ•¸ | 60 å€‹äº¤æ˜“æ—¥ | å®Œæ•´è¨ˆç®—æ‰€æœ‰æŒ‡æ¨™ |
| è³‡æ–™æ–°é®®åº¦ | ç•¶æ—¥ 16:00 å‰æ›´æ–° | M06 åŒæ­¥å¾Œè§¸ç™¼ |

### 4.3 å¿«å–ç­–ç•¥

| å¿«å–é¡å‹ | TTL | èªªæ˜ |
|---------|-----|------|
| å³æ™‚ç±Œç¢¼æ•¸æ“š | 1 å°æ™‚ | ç›¤å¾Œæ›´æ–°ä¸€æ¬¡ |
| è¨ˆç®—çµæœ | 6 å°æ™‚ | ç•¶æ—¥è¨ˆç®—çµæœ |
| æ’è¡Œæ¦œçµæœ | 30 åˆ†é˜ | ç†±é–€æŸ¥è©¢ |
| æ­·å²æ•¸æ“š | 24 å°æ™‚ | æ­·å²ä¸æœƒè®Šå‹• |

---

## 5. éŒ¯èª¤ç¢¼å®šç¾©

| éŒ¯èª¤ç¢¼ | èªªæ˜ | HTTP Status |
|-------|------|-------------|
| M09_CHIP_001 | è‚¡ç¥¨ä»£ç¢¼ä¸å­˜åœ¨ | 404 |
| M09_CHIP_002 | ç±Œç¢¼è³‡æ–™ä¸è¶³ï¼Œç„¡æ³•è¨ˆç®— | 400 |
| M09_CHIP_003 | è¨ˆç®—æ—¥æœŸè¶…å‡ºç¯„åœ | 400 |
| M09_CHIP_004 | ä¸æ”¯æ´çš„æŒ‡æ¨™é¡å‹ | 400 |
| M09_CHIP_005 | è¨ˆç®—å¼•æ“ç•°å¸¸ | 500 |
| M09_PARAM_001 | åƒæ•¸æ ¼å¼éŒ¯èª¤ | 400 |
| M09_PARAM_002 | æ—¥æœŸç¯„åœç„¡æ•ˆ | 400 |

---

## ğŸ“š ç›¸é—œæ–‡æª”

- [M09 APIè¦æ ¼](../api/M09-APIè¦æ ¼.md)
- [M09 è³‡æ–™åº«è¨­è¨ˆ](../../design/M09-è³‡æ–™åº«è¨­è¨ˆ.md)
- [M09 æ¥­å‹™æµç¨‹](../../design/M09-æ¥­å‹™æµç¨‹.md)
- [M06 è³‡æ–™ç®¡ç†åŠŸèƒ½éœ€æ±‚](./M06-è³‡æ–™ç®¡ç†åŠŸèƒ½éœ€æ±‚.md)
- [M07 æŠ€è¡“åˆ†æåŠŸèƒ½éœ€æ±‚](./M07-æŠ€è¡“åˆ†æåŠŸèƒ½éœ€æ±‚.md)

---

**æ–‡ä»¶ç¶­è­·è€…**: ç”¢å“ç¶“ç†
**æœ€å¾Œæ›´æ–°**: 2026-01-15
**ä¸‹æ¬¡å¯©æ ¸**: 2026-03-31
