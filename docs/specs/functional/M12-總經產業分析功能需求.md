# M12-總經與產業分析模組功能需求

> **文件編號**: FUNC-M12
> **模組名稱**: 總經與產業分析模組 (Macro & Industry Analysis Module)
> **版本**: v1.0
> **最後更新**: 2026-01-14
> **狀態**: Draft

---

## 1. 模組定位

### 1.1 模組概述

M12 總經與產業分析模組負責追蹤總體經濟指標、管理產業分類、分析產業輪動趨勢，為投資決策提供宏觀經濟與產業層面的分析視角。

### 1.2 核心價值

- **總經環境判斷**: 追蹤關鍵總經指標，判斷經濟週期階段
- **產業分類管理**: 維護股票的產業分類，支援多層次分類體系
- **產業輪動分析**: 識別強勢產業，追蹤資金流向
- **產業動能評估**: 計算產業績效與動能指標

### 1.3 系統定位

```
┌─────────────────────────────────────────────────────────────────┐
│                       Layer 3: 進階分析層                         │
├─────────────────────────────────────────────────────────────────┤
│                                                                 │
│   ┌─────────────┐    ┌─────────────┐    ┌─────────────┐        │
│   │    M10      │    │    M11      │    │    M12      │        │
│   │  技術型態    │    │  量化策略    │    │ 總經產業    │ ← 本模組 │
│   └─────────────┘    └─────────────┘    └─────────────┘        │
│          │                 │                  │                 │
│          └─────────────────┴──────────────────┘                 │
│                            │                                    │
│                            ▼                                    │
│                     ┌─────────────┐                             │
│                     │    M13      │                             │
│                     │  信號引擎    │                             │
│                     └─────────────┘                             │
│                                                                 │
└─────────────────────────────────────────────────────────────────┘
```

### 1.4 模組依賴

| 依賴方向 | 模組 | 依賴內容 |
|---------|------|---------|
| 上游 | M06 資料管理 | 股票基本資料、交易日曆 |
| 上游 | M08 基本面分析 | 財務指標（用於產業估值比較） |
| 下游 | M13 信號引擎 | 輸出產業輪動信號、總經環境信號 |

---

## 2. 功能清單

| 功能編號 | 功能名稱 | 優先級 | 說明 |
|---------|---------|-------|------|
| F-M12-001 | 總經指標管理 | P0 | 管理與追蹤總體經濟指標 |
| F-M12-002 | 經濟週期判斷 | P1 | 判斷當前經濟所處週期階段 |
| F-M12-003 | 產業分類管理 | P0 | 管理股票的多層次產業分類 |
| F-M12-004 | 產業績效計算 | P0 | 計算各產業的報酬率與動能 |
| F-M12-005 | 產業輪動分析 | P0 | 識別產業輪動趨勢與資金流向 |
| F-M12-006 | 產業估值比較 | P1 | 比較各產業的估值水位 |
| F-M12-007 | 產業排行榜 | P0 | 提供各類產業排名查詢 |
| F-M12-008 | 產業信號生成 | P0 | 產生產業輪動相關信號供 M13 消費 |

---

## 3. 功能詳細設計

### F-M12-001: 總經指標管理

**功能描述**: 管理與追蹤台灣及全球主要總體經濟指標

**總經指標清單**:

#### 台灣總經指標

| 指標代碼 | 指標名稱 | 資料來源 | 更新頻率 | 說明 |
|---------|---------|---------|---------|------|
| TW_GDP_YOY | GDP 年增率 | 主計總處 | 每季 | 經濟成長率 |
| TW_CPI_YOY | CPI 年增率 | 主計總處 | 每月 | 消費者物價指數 |
| TW_PMI | 製造業 PMI | 中經院 | 每月 | 採購經理人指數 |
| TW_NMI | 非製造業 NMI | 中經院 | 每月 | 非製造業指數 |
| TW_EXPORT_YOY | 出口年增率 | 財政部 | 每月 | 出口成長率 |
| TW_IMPORT_YOY | 進口年增率 | 財政部 | 每月 | 進口成長率 |
| TW_M1B_YOY | M1B 年增率 | 央行 | 每月 | 狹義貨幣供給 |
| TW_M2_YOY | M2 年增率 | 央行 | 每月 | 廣義貨幣供給 |
| TW_POLICY_RATE | 央行重貼現率 | 央行 | 不定期 | 政策利率 |
| TW_LEADING_INDEX | 景氣領先指標 | 國發會 | 每月 | 景氣領先指數 |
| TW_COINCIDENT_INDEX | 景氣同時指標 | 國發會 | 每月 | 景氣同時指數 |
| TW_LAGGING_INDEX | 景氣落後指標 | 國發會 | 每月 | 景氣落後指數 |
| TW_MONITOR_SCORE | 景氣燈號分數 | 國發會 | 每月 | 景氣對策信號 |

#### 全球總經指標

| 指標代碼 | 指標名稱 | 資料來源 | 更新頻率 | 說明 |
|---------|---------|---------|---------|------|
| US_FED_RATE | 美國聯邦基金利率 | Fed | 不定期 | 美國基準利率 |
| US_CPI_YOY | 美國 CPI 年增率 | BLS | 每月 | 美國通膨率 |
| US_10Y_YIELD | 美國 10 年期公債殖利率 | Treasury | 每日 | 長期利率指標 |
| US_2Y_YIELD | 美國 2 年期公債殖利率 | Treasury | 每日 | 短期利率指標 |
| US_YIELD_SPREAD | 美債殖利率曲線 | 計算 | 每日 | 10Y - 2Y |
| VIX | VIX 恐慌指數 | CBOE | 每日 | 市場恐慌指標 |
| DXY | 美元指數 | ICE | 每日 | 美元強弱指標 |
| GOLD_PRICE | 黃金價格 | 多來源 | 每日 | 避險資產價格 |
| OIL_WTI | WTI 原油價格 | NYMEX | 每日 | 能源成本指標 |

**驗收條件**:
- [ ] 支援新增、修改、刪除總經指標定義
- [ ] 支援手動或自動更新總經指標數值
- [ ] 支援查詢指標歷史趨勢
- [ ] 提供指標異常警示（超出歷史區間）

---

### F-M12-002: 經濟週期判斷

**功能描述**: 基於多項總經指標綜合判斷當前經濟所處週期階段

**經濟週期定義**:

```
         ┌─────────────────────────────────────────────────────┐
         │                    經濟週期模型                       │
         └─────────────────────────────────────────────────────┘

GDP/經濟活動
    │
    │           ╭─────╮
    │          ╱       ╲ 擴張期 (EXPANSION)
    │   復甦期╱         ╲
    │ (RECOVERY)         ╲ 過熱期
    │        ╱             ╲ (OVERHEATING)
    │       ╱               ╲
────┼──────╱─────────────────╲─────────────── 時間軸
    │     ╱                   ╲
    │    ╱                     ╲ 衰退期
    │   ╱ 蕭條期                ╲ (RECESSION)
    │  ╱  (DEPRESSION)          ╲
    │ ╱                          ╲
    │╱                            ╰────
    │

週期階段: DEPRESSION → RECOVERY → EXPANSION → OVERHEATING → RECESSION → ...
```

**週期判斷規則**:

| 週期階段 | 判斷條件 | 投資建議 |
|---------|---------|---------|
| RECOVERY (復甦) | 領先指標上升 + 同時指標谷底 | 加碼週期股、金融股 |
| EXPANSION (擴張) | 領先、同時指標皆上升 | 持有股票、適度獲利了結 |
| OVERHEATING (過熱) | 領先指標下降 + 同時指標高檔 | 減碼、轉向防禦股 |
| RECESSION (衰退) | 領先、同時指標皆下降 | 減碼、持有現金或債券 |
| DEPRESSION (蕭條) | 領先指標止跌 + 同時指標低檔 | 開始佈局、逢低買入 |

**週期判斷演算法**:
```python
def determine_cycle_stage(indicators):
    leading = indicators['TW_LEADING_INDEX']
    coincident = indicators['TW_COINCIDENT_INDEX']
    monitor = indicators['TW_MONITOR_SCORE']

    leading_trend = calculate_trend(leading, period=3)  # 3 個月趨勢
    coincident_level = calculate_level(coincident)      # 相對歷史位置

    if leading_trend == 'UP' and coincident_level == 'LOW':
        return 'RECOVERY'
    elif leading_trend == 'UP' and coincident_level in ['MID', 'HIGH']:
        return 'EXPANSION'
    elif leading_trend == 'DOWN' and coincident_level == 'HIGH':
        return 'OVERHEATING'
    elif leading_trend == 'DOWN' and coincident_level in ['MID', 'LOW']:
        return 'RECESSION'
    elif leading_trend == 'FLAT' and coincident_level == 'LOW':
        return 'DEPRESSION'
    else:
        return 'UNCERTAIN'
```

**驗收條件**:
- [ ] 系統可自動判斷當前經濟週期階段
- [ ] 支援查詢週期判斷的依據與計算過程
- [ ] 週期變化時產生通知
- [ ] 提供週期歷史紀錄查詢

---

### F-M12-003: 產業分類管理

**功能描述**: 管理股票的多層次產業分類，支援證交所分類與自訂分類

**產業分類體系**:

#### 證交所產業分類 (TWSE Standard)

```
Level 1 (大類)     Level 2 (中類)           範例股票
────────────────────────────────────────────────────
電子工業           半導體                   2330 台積電
                   電腦週邊                 2382 廣達
                   光電                     2409 友達
                   通信網路                 2412 中華電
                   電子零組件               2317 鴻海

金融保險           銀行                     2881 富邦金
                   保險                     2882 國泰金
                   證券                     6005 群益證

傳統產業           水泥                     1101 台泥
                   食品                     1216 統一
                   塑膠                     1301 台塑
                   鋼鐵                     2002 中鋼
```

#### 自訂主題分類 (Custom Theme)

| 主題代碼 | 主題名稱 | 說明 | 範例股票 |
|---------|---------|------|---------|
| AI_CONCEPT | AI 概念股 | 人工智慧相關 | 2330, 2454, 3443 |
| EV_CONCEPT | 電動車概念 | 電動車供應鏈 | 2317, 3008, 2308 |
| 5G_CONCEPT | 5G 概念股 | 5G 基建相關 | 2454, 3533, 4904 |
| ESG_LEADER | ESG 領袖 | ESG 評分優良 | 2330, 2881, 1216 |
| DIVIDEND_KING | 高股息 | 穩定配息 | 2412, 2002, 5880 |
| GROWTH_STOCK | 成長股 | 營收高成長 | 3661, 6669, 3037 |

**資料模型**:
```json
{
  "stock_id": "2330",
  "classifications": {
    "twse": {
      "sector_code": "24",
      "sector_name": "半導體業",
      "industry_code": "2401",
      "industry_name": "IC 設計"
    },
    "custom_themes": ["AI_CONCEPT", "ESG_LEADER"],
    "market_cap_tier": "LARGE",
    "style": "GROWTH"
  }
}
```

**驗收條件**:
- [ ] 支援維護證交所標準產業分類
- [ ] 支援建立與管理自訂主題分類
- [ ] 支援股票的多重主題標籤
- [ ] 提供產業成分股清單查詢

---

### F-M12-004: 產業績效計算

**功能描述**: 計算各產業的報酬率、動能與相關績效指標

**產業績效指標**:

| 指標代碼 | 指標名稱 | 計算方式 | 說明 |
|---------|---------|---------|------|
| RETURN_1D | 單日報酬率 | Σ(成分股報酬 × 權重) | 市值加權 |
| RETURN_5D | 5 日報酬率 | 累積報酬 | 週報酬 |
| RETURN_20D | 20 日報酬率 | 累積報酬 | 月報酬 |
| RETURN_60D | 60 日報酬率 | 累積報酬 | 季報酬 |
| RETURN_YTD | 年初至今 | 累積報酬 | YTD |
| MOMENTUM_20D | 20 日動能 | 報酬 / 波動率 | 風險調整報酬 |
| RELATIVE_STRENGTH | 相對強度 | vs 大盤報酬 | 超額報酬 |
| VOLATILITY_20D | 20 日波動率 | 日報酬標準差 × √20 | 年化波動 |
| SHARPE_RATIO | 夏普比率 | (報酬 - 無風險) / 波動 | 風險調整指標 |
| BREADTH | 漲跌家數比 | 上漲家數 / 總家數 | 市場廣度 |

**計算範例**:
```sql
-- 計算半導體產業 20 日報酬率（市值加權）
WITH sector_stocks AS (
    SELECT s.stock_id, s.market_cap,
           (p.close - LAG(p.close, 20) OVER (PARTITION BY p.stock_id ORDER BY p.trade_date))
           / LAG(p.close, 20) OVER (PARTITION BY p.stock_id ORDER BY p.trade_date) AS return_20d
    FROM stock_classifications sc
    JOIN stocks s ON sc.stock_id = s.stock_id
    JOIN stock_prices p ON s.stock_id = p.stock_id
    WHERE sc.sector_code = '24'  -- 半導體
      AND p.trade_date = '2024-12-24'
)
SELECT
    SUM(return_20d * market_cap) / SUM(market_cap) AS weighted_return_20d
FROM sector_stocks;
```

**驗收條件**:
- [ ] 每日計算所有產業的績效指標
- [ ] 支援不同權重方式（市值加權、等權）
- [ ] 提供產業績效歷史查詢
- [ ] 支援與大盤、其他產業比較

---

### F-M12-005: 產業輪動分析

**功能描述**: 識別產業輪動趨勢，追蹤資金在不同產業間的流動

**產業輪動模型**:

```
┌─────────────────────────────────────────────────────────────────┐
│                      產業輪動週期模型                             │
└─────────────────────────────────────────────────────────────────┘

經濟復甦期                    經濟擴張期
┌─────────────┐              ┌─────────────┐
│ 領漲產業:    │              │ 領漲產業:    │
│ - 金融      │     →        │ - 科技      │
│ - 工業週期   │              │ - 非必需消費 │
│ - 原物料    │              │ - 原物料    │
└─────────────┘              └─────────────┘
       ↑                            │
       │                            ↓
┌─────────────┐              ┌─────────────┐
│ 領漲產業:    │              │ 領漲產業:    │
│ - 公用事業   │     ←        │ - 能源      │
│ - 必需消費   │              │ - 工業      │
│ - 醫療保健   │              │ - 金融      │
└─────────────┘              └─────────────┘
經濟衰退期                    經濟過熱期
```

**輪動強度指標**:

| 指標 | 計算方式 | 說明 |
|-----|---------|------|
| 資金流入強度 | 成交量增幅 × 股價漲幅 | 正值表示資金流入 |
| 相對動能排名 | 報酬率在所有產業的百分位 | 0-100 |
| 輪動加速度 | 本週排名 - 上週排名 | 正值表示轉強 |
| 持續性指標 | 連續 N 週維持前 1/3 排名 | 趨勢持續性 |

**產業輪動信號**:

| 信號代碼 | 信號名稱 | 條件 | 說明 |
|---------|---------|------|------|
| IND_SIG_001 | 產業轉強 | 排名上升 > 5 且進入前 1/3 | 資金流入 |
| IND_SIG_002 | 產業轉弱 | 排名下降 > 5 且跌出前 1/3 | 資金流出 |
| IND_SIG_003 | 新興領漲 | 連續 3 週排名上升且進入前 20% | 輪動轉換 |
| IND_SIG_004 | 持續領漲 | 連續 5 週維持前 20% | 強勢產業 |
| IND_SIG_005 | 產業見頂 | 漲幅過大 + 動能減弱 | 獲利了結 |

**驗收條件**:
- [ ] 每週計算產業輪動排名
- [ ] 識別輪動轉換信號
- [ ] 提供產業輪動熱力圖
- [ ] 記錄輪動歷史供回測

---

### F-M12-006: 產業估值比較

**功能描述**: 比較各產業的估值水位，識別相對便宜或昂貴的產業

**產業估值指標**:

| 指標 | 計算方式 | 說明 |
|-----|---------|------|
| 產業本益比 | 產業市值 / 產業淨利 | 整體估值 |
| 產業股價淨值比 | 產業市值 / 產業淨值 | 資產估值 |
| 產業股利率 | 產業股利 / 產業市值 | 現金回報 |
| 產業 EV/EBITDA | 企業價值 / EBITDA | 經營估值 |
| 估值百分位 | 目前估值在歷史的位置 | 相對高低 |

**估值分析輸出**:
```json
{
  "sector_code": "24",
  "sector_name": "半導體業",
  "valuation": {
    "pe_ratio": 18.5,
    "pe_percentile": 45,  // 歷史百分位
    "pb_ratio": 3.2,
    "pb_percentile": 62,
    "dividend_yield": 2.1,
    "dy_percentile": 38
  },
  "comparison": {
    "vs_market_pe": -15.2,  // 較大盤便宜 15%
    "vs_history_pe": -10.5  // 較歷史均值便宜 10%
  },
  "valuation_signal": "UNDERVALUED"  // UNDERVALUED / FAIR / OVERVALUED
}
```

**驗收條件**:
- [ ] 每日計算產業估值指標
- [ ] 計算估值的歷史百分位
- [ ] 提供跨產業估值比較
- [ ] 識別估值異常（過高/過低）

---

### F-M12-007: 產業排行榜

**功能描述**: 提供各類產業排名查詢

**排行榜類型**:

| 排行榜代碼 | 排行榜名稱 | 排序依據 | 說明 |
|-----------|-----------|---------|------|
| RETURN_1D | 單日漲跌幅 | 單日報酬率 | 當日強弱 |
| RETURN_5D | 週漲跌幅 | 5 日報酬率 | 週強弱 |
| RETURN_20D | 月漲跌幅 | 20 日報酬率 | 月強弱 |
| MOMENTUM | 動能排行 | 20 日動能指標 | 風險調整 |
| RELATIVE_STRENGTH | 相對強度 | vs 大盤超額報酬 | 領先落後 |
| MONEY_FLOW | 資金流向 | 資金流入強度 | 法人動向 |
| BREADTH | 市場廣度 | 漲跌家數比 | 產業健康度 |
| VALUATION | 估值排行 | PE 百分位 | 便宜到貴 |

**驗收條件**:
- [ ] 支援 8 種排行榜查詢
- [ ] 支援指定排名數量（Top N）
- [ ] 支援歷史排行查詢
- [ ] 提供排名變化追蹤

---

### F-M12-008: 產業信號生成

**功能描述**: 產生產業輪動相關信號供 M13 信號引擎消費

**信號類型**:

| 信號代碼 | 信號名稱 | 信號類型 | 條件 |
|---------|---------|---------|------|
| IND_SIG_001 | 產業轉強 | INDUSTRY_MOMENTUM | 輪動排名大幅上升 |
| IND_SIG_002 | 產業轉弱 | INDUSTRY_MOMENTUM | 輪動排名大幅下降 |
| IND_SIG_003 | 新興領漲產業 | INDUSTRY_ROTATION | 連續上升進入領先群 |
| IND_SIG_004 | 持續領漲產業 | INDUSTRY_ROTATION | 連續維持領先 |
| IND_SIG_005 | 產業估值偏低 | INDUSTRY_VALUATION | PE 百分位 < 20 |
| IND_SIG_006 | 產業估值偏高 | INDUSTRY_VALUATION | PE 百分位 > 80 |
| MACRO_SIG_001 | 經濟週期轉換 | MACRO_CYCLE | 週期階段變化 |
| MACRO_SIG_002 | 利率環境變化 | MACRO_RATE | 央行利率調整 |
| MACRO_SIG_003 | 景氣燈號變化 | MACRO_MONITOR | 燈號顏色改變 |

**信號資料格式**:
```json
{
  "signal_id": "IND_SIG_2024122401",
  "signal_type": "INDUSTRY_ROTATION",
  "signal_code": "IND_SIG_003",
  "signal_name": "新興領漲產業",
  "target_type": "SECTOR",
  "target_id": "24",
  "target_name": "半導體業",
  "signal_date": "2024-12-24",
  "signal_value": {
    "current_rank": 2,
    "previous_rank": 8,
    "rank_change": 6,
    "momentum_score": 85.5
  },
  "confidence_score": 0.82,
  "is_consumed": false,
  "created_at": "2024-12-24T17:00:00+08:00"
}
```

**驗收條件**:
- [ ] 每日產生產業輪動信號
- [ ] 經濟週期變化時產生總經信號
- [ ] 信號儲存供 M13 消費
- [ ] 支援信號歷史查詢

---

## 4. 系統架構

### 4.1 MacroIndustryEngine 架構

```
┌─────────────────────────────────────────────────────────────────┐
│                    M12 MacroIndustryEngine                       │
└─────────────────────────────────────────────────────────────────┘
                              │
        ┌─────────────────────┼─────────────────────┐
        ▼                     ▼                     ▼
┌───────────────┐    ┌───────────────┐    ┌───────────────┐
│ MacroAnalyzer │    │ IndustryAnalyzer │  │ RotationAnalyzer │
│               │    │               │    │               │
│ - 總經指標追蹤 │    │ - 產業分類管理 │    │ - 輪動分析    │
│ - 經濟週期判斷 │    │ - 績效計算    │    │ - 資金流向    │
│ - 總經信號生成 │    │ - 估值比較    │    │ - 信號生成    │
└───────────────┘    └───────────────┘    └───────────────┘
        │                     │                     │
        └─────────────────────┼─────────────────────┘
                              │
                    ┌─────────▼─────────┐
                    │  SignalPublisher  │
                    │  (發布到 M13)     │
                    └───────────────────┘
```

### 4.2 技術選型

| 層級 | 技術選擇 | 說明 |
|-----|---------|------|
| 持久層 | JPA (主) | 實體操作為主，查詢相對簡單 |
| 快取 | Redis | 產業績效、排行榜快取 |
| 排程 | Quartz | 定時更新總經資料、計算產業績效 |
| API | REST | 提供查詢接口 |

---

## 5. 非功能性需求

| 需求類型 | 需求內容 | 目標值 |
|---------|---------|-------|
| 效能 | 產業績效查詢回應時間 | P95 < 100ms |
| 效能 | 每日產業計算完成時間 | < 5 分鐘 |
| 可用性 | 服務可用率 | 99.5% |
| 資料品質 | 總經資料更新延遲 | < 24 小時 |
| 擴展性 | 支援產業數量 | > 50 個 |

---

## 6. 驗收標準

### 6.1 功能驗收

- [ ] 所有 8 項功能通過單元測試
- [ ] 總經指標能正確追蹤與更新
- [ ] 經濟週期判斷結果合理
- [ ] 產業績效計算正確
- [ ] 產業輪動信號能正確產生
- [ ] M13 能正常消費產業信號

### 6.2 整合驗收

- [ ] 與 M06 資料整合正常
- [ ] 與 M08 財務資料整合正常
- [ ] 與 M13 信號消費整合正常
- [ ] API 回應時間符合 SLA

---

## 📚 相關文檔

- [M12 API 規格](../api/M12-API規格.md)
- [M12 資料庫設計](../../design/M12-資料庫設計.md)
- [M12 業務流程](../../design/M12-業務流程.md)
- [M06 資料管理模組](./M06-資料管理功能需求.md)
- [M08 基本面分析模組](./M08-基本面分析功能需求.md)
- [M13 信號引擎](./M13-信號引擎功能需求.md)

---

**文件維護者**: 產品經理
**最後更新**: 2026-01-14
**下次審核**: 2026-04-14
