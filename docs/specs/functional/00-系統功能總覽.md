# 📊 系統功能總覽

> **文件編號**: DOC-SPEC-FUNC-00  
> **文件名稱**: 系統功能總覽  
> **版本**: v2.0  
> **最後更新**: 2025-12-31  
> **狀態**: Draft

---

## 📑 目錄

1. [系統定位](#1-系統定位)
2. [系統目標](#2-系統目標)
3. [核心功能模組](#3-核心功能模組)
4. [目標用戶](#4-目標用戶)
5. [系統邊界](#5-系統邊界)
6. [開發階段](#6-開發階段)

---

## 1. 系統定位

**股票進出場監控系統（Stock Monitor & Alert System）**

基於 Java Spring Boot 3.x 的**企業級股票監控系統**，整合以下多維度分析能力：

### 1.1 核心能力

| 分析維度 | 說明 | 涵蓋內容 |
|---------|------|---------|
| 📈 **技術分析** | 基於價格與成交量的數學指標 | 71個技術指標（趨勢、動能、波動、成交量） |
| 💰 **基本面分析** | 基於財報的財務指標 | 75個財務指標（估值、獲利、財務結構、現金流） |
| 🎯 **籌碼分析** | 市場參與者的買賣籌碼 | 三大法人、融資融券、董監持股、籌碼集中度 |
| 📊 **技術型態辨識** | 圖表與K線型態識別 | K線型態、圖表型態、趨勢型態識別 |
| 🤖 **量化策略** | 可回測的交易策略 | 策略框架、預設策略庫、自訂策略、參數優化 |
| 🌐 **總經產業分析** | 宏觀經濟與產業趨勢 | 總體經濟指標、產業分類、產業輪動分析 |

### 1.2 完整功能

系統提供從**資料獲取**到**投資決策**的完整功能鏈：

```
資料獲取 → 多維分析 → 信號生成 → 智能選股 → 警報通知 → 策略回測 → 風險管理
```

---

## 2. 系統目標

### 2.1 業務目標

| 目標 | 說明 |
|-----|------|
| ✅ **多維度分析能力** | 提供技術面 + 基本面 + 籌碼面 + 型態 + 總經產業的綜合分析 |
| ✅ **自動化監控** | 全天候自動監控市場變化，即時產生警報通知 |
| ✅ **策略回測** | 使用歷史資料驗證策略有效性，進行參數優化 |
| ✅ **風險控制** | 投資組合管理與風險指標計算，協助用戶控制風險 |
| ✅ **企業級架構** | 高可用、高效能、易擴展的系統設計 |

### 2.2 技術目標

| 指標 | 目標值 | 說明 |
|-----|--------|------|
| ⚡ **效能** | < 100ms | 單次指標計算時間 |
| ⚡ **API 回應** | < 200ms | API 平均回應時間 |
| 🔄 **可用性** | > 99.9% | 系統可用性，支援故障自動恢復 |
| 📈 **擴展性** | 支援水平擴展 | 可應對用戶增長與資料量增加 |
| 🔒 **安全性** | 完善的權限控制 | 身份驗證、權限控制、資料加密 |
| 🧪 **可測試性** | > 80% | 測試覆蓋率目標 |

---

## 3. 核心功能模組

系統由 **13 個核心模組**組成，分為 **4 個層級**：

### 3.1 資料層（Data Layer）

| 模組編號 | 模組名稱 | 核心功能 | 開發優先級 |
|---------|---------|---------|-----------|
| **M06** | 資料管理模組 | 股價/財報/籌碼資料獲取、清洗、儲存、更新 | 🔴 P0 |

**說明**: 資料層是整個系統的基礎，所有其他模組都依賴它提供乾淨、準確的資料。

---

### 3.2 分析層（Analysis Layer）

| 模組編號 | 模組名稱 | 核心功能 | 開發優先級 |
|---------|---------|---------|-----------|
| **M07** | 技術分析模組 | 71個技術指標計算（趨勢、動能、波動、成交量） | 🔴 P0 (部分) → 🟡 P1 (完整) |
| **M08** | 基本面分析模組 | 75個財務指標計算（估值、獲利、財務結構、現金流） | 🟡 P1 |
| **M09** | 籌碼分析模組 | 三大法人、融資融券、董監持股、籌碼集中度 | 🟡 P1 |
| **M10** | 技術型態辨識模組 | K線型態、圖表型態、趨勢型態識別 | 🟢 P2 |
| **M11** | 量化策略模組 | 策略框架、預設策略庫、自訂策略、參數優化 | 🟢 P2 |
| **M12** | 總經與產業分析模組 | 總體經濟指標、產業分類、產業輪動分析 | 🔵 P3 |

**說明**: 分析層負責從原始資料中提取有價值的洞察，是系統的核心智能。

---

### 3.3 應用層（Application Layer）

| 模組編號 | 模組名稱 | 核心功能 | 開發優先級 |
|---------|---------|---------|-----------|
| **M13** | 信號判斷引擎 | 統一信號生成、去重合併、版本化、可追溯 | 🔴 P0 (簡化版) → 🟡 P1 (完整版) |
| **M14** | 選股引擎 | 多條件篩選、預設策略、自訂策略、排序排名 | 🟡 P1 |
| **M15** | 警報通知系統 | 警報條件設定、多通道通知、頻率控制、失敗重試 | 🔴 P0 (基礎功能) |
| **M16** | 回測系統 | 策略回測、績效評估、參數優化、報告生成 | 🟢 P2 |

**說明**: 應用層將分析結果轉化為實際可用的功能，直接服務於用戶需求。

---

### 3.4 管理層（Management Layer）

| 模組編號 | 模組名稱 | 核心功能 | 開發優先級 |
|---------|---------|---------|-----------|
| **M17** | 風險管理模組 | 停損停利、部位管理、風險指標、壓力測試 | 🟢 P2 |
| **M18** | 投資組合管理 | 持股記錄、損益計算、績效分析、配置分析 | 🟢 P2 |

**說明**: 管理層協助用戶管理投資組合，控制風險，追蹤績效。

---

### 3.5 模組依賴關係圖

```
┌─────────────────────────────────────────┐
│           M06 資料管理模組               │ ← 基礎層
│     (股價、財報、籌碼資料的統一入口)      │
└────────────┬────────────────────────────┘
             ↓
┌────────────┴──────────────┬─────────────┐
│   M07 技術分析            │  M08 基本面  │
│   (71個技術指標)          │  (75個財務指標) │
│                           │              │
│   M09 籌碼分析            │  M10 型態    │ ← 分析層
│   (法人、融資融券)        │  (K線、圖表)  │
│                           │              │
│   M11 量化策略            │  M12 總經    │
│   (策略框架、回測)        │  (產業輪動)  │
└────────────┬──────────────┴─────────────┘
             ↓
┌────────────┴──────────────┬─────────────┐
│   M13 信號引擎            │  M14 選股    │
│   (統一信號生成、去重)    │  (多條件篩選) │ ← 應用層
│                           │              │
│   M15 警報通知            │  M16 回測    │
│   (多通道通知)            │  (績效評估)  │
└────────────┬──────────────┴─────────────┘
             ↓
┌────────────┴──────────────┬─────────────┐
│   M17 風險管理            │  M18 投組    │ ← 管理層
│   (停損停利、部位管理)    │  (持股追蹤)  │
└───────────────────────────┴─────────────┘
```

---

## 4. 目標用戶

### 4.1 用戶分類

| 用戶類型 | 人數規模 | 資金規模 | 主要需求 | 使用場景 |
|---------|---------|---------|---------|---------|
| **個人投資者** | 中小散戶 | 小額資金 | 簡單易用、警報通知 | 手機 App、每日推薦 |
| **專業交易員** | 全職交易 | 中等資金 | 多維度分析、快速決策 | Web Dashboard、自訂策略 |
| **量化交易團隊** | 團隊作戰 | 大額資金 | API 接入、策略回測 | API、自動化交易 |
| **金融科技公司** | B2B 服務 | 企業級 | 系統整合、客製化 | 私有化部署、白標服務 |

### 4.2 使用場景

#### 場景 1: 個人投資者
**小明的一天**:
```
07:00 起床，收到 LINE 通知：「台積電出現黃金交叉信號」
09:00 開盤，打開手機 App 查看今日推薦股票清單
14:00 收到警報：「你的自選股 2330 突破壓力線」
晚上  查看今日投資組合績效，追蹤持股損益
```

#### 場景 2: 專業交易員
**老張的工作日**:
```
08:30 開啟 3 個螢幕的 Web Dashboard
      - 螢幕 1: 技術指標即時監控
      - 螢幕 2: 籌碼分析與法人動向
      - 螢幕 3: 自選股清單與警報
      
10:00 執行自訂選股策略：「高 ROE + 低本益比 + 外資買超」
14:00 回測新策略，調整參數優化
15:00 檢視今日交易信號，準備明日操作計畫
```

#### 場景 3: 量化交易團隊
**量化團隊的開發流程**:
```
1. 透過 API 取得歷史資料
2. 開發交易策略程式
3. 使用回測系統驗證策略
4. 將策略部署到生產環境
5. 透過 API 接收即時信號
6. 自動化執行交易（串接券商 API）
```

#### 場景 4: 金融科技公司
**B2B 整合案例**:
```
某券商 App 整合案例：
1. 將本系統的選股引擎嵌入券商 App
2. 提供「智能選股」功能給券商客戶
3. 客戶在券商 App 內直接下單
4. 券商賺取手續費，我們賺取授權費
```

---

## 5. 系統邊界

### 5.1 包含範圍 ✅

#### 資料範圍
- ✅ **台股股票資料**（上市、上櫃公司，約 2,000 檔）
- ✅ **股價歷史資料**（日線、週線、月線，至少 10 年）
- ✅ **財務報表資料**（季報、年報，近 5 年）
- ✅ **籌碼資料**（三大法人、融資融券、董監持股）
- ✅ **產業分類資料**（依證交所分類）

#### 功能範圍
- ✅ **技術分析**（71個指標計算）
- ✅ **基本面分析**（75個財務指標）
- ✅ **籌碼分析**（法人動向、籌碼集中度）
- ✅ **型態辨識**（K線型態、圖表型態）
- ✅ **信號產生**（進場/出場信號）
- ✅ **選股篩選**（多條件組合篩選）
- ✅ **警報通知**（LINE、Email、Telegram、WebSocket）
- ✅ **策略回測**（歷史資料驗證）
- ✅ **投資組合管理**（持股追蹤、損益計算）
- ✅ **風險管理**（停損停利、部位管理）

---

### 5.2 不包含範圍 ❌

為確保系統聚焦核心功能，以下項目**明確排除在系統範圍外**：

#### 交易執行
```
❌ 實際下單交易（僅提供信號，不執行交易）
❌ 券商 API 串接（用戶需自行對接券商系統）
❌ 資金流轉管理（不處理實際金流）

說明: 系統專注於「分析」與「信號」，不涉及實際交易執行
```

#### 商品範圍
```
❌ 期貨商品（僅支援股票現貨）
❌ 選擇權商品
❌ 外匯商品
❌ 加密貨幣
❌ 海外股市（目前僅支援台股）

說明: 第一版僅支援台股現貨，未來可能擴展
```

#### 即時功能
```
❌ 即時報價串流（使用15分鐘延遲報價）
❌ 逐筆撮合資料
❌ Level 2 市場深度資料

說明: 使用延遲報價可降低成本，符合大多數用戶需求
```

#### 擴充功能（未來版本考慮）
```
⏳ 新聞爬蟲與情緒分析
⏳ 社群輿情監控（PTT、Dcard、Twitter）
⏳ AI 預測模型（深度學習）
⏳ 多國語言支援（目前僅中文）
⏳ 語音助理整合
⏳ AR/VR 視覺化

說明: 這些功能列入產品路線圖，但不在 v1.0 範圍內
```

---

### 5.3 系統整合說明

雖然系統本身不提供交易執行功能，但設計上**允許用戶整合**：

#### 整合架構
```
┌──────────────┐      ┌──────────────┐      ┌──────────────┐
│ 股票監控系統  │ ───→ │   用戶系統    │ ───→ │   券商 API    │
│  (本系統)    │ 信號 │  (用戶負責)   │ 下單 │  (券商提供)   │
└──────────────┘      └──────────────┘      └──────────────┘
```

#### API 串接方式
```java
// 範例：用戶系統接收本系統信號後自動下單
@Service
public class AutoTradingService {
    
    @Autowired
    private StockMonitorApiClient monitorApi;  // 本系統的 API Client
    
    @Autowired
    private BrokerApiClient brokerApi;         // 券商 API Client
    
    @Scheduled(cron = "0 0/5 * * * ?")         // 每 5 分鐘檢查一次
    public void checkSignalsAndTrade() {
        // 1. 從本系統取得最新信號
        List<Signal> signals = monitorApi.getActiveSignals();
        
        // 2. 過濾符合條件的信號
        List<Signal> buySignals = signals.stream()
            .filter(s -> s.getSignalType() == SignalType.BUY)
            .filter(s -> s.getConfidenceScore() > 80)
            .collect(Collectors.toList());
        
        // 3. 執行下單（用戶自行實作）
        for (Signal signal : buySignals) {
            brokerApi.placeOrder(
                signal.getStockId(),
                OrderType.BUY,
                calculateQuantity(signal)
            );
        }
    }
}
```

---

## 6. 開發階段

### 6.1 MVP 階段（P0 - 立即開始）

**目標**: 建立可運行的最小可行產品，驗證核心功能

| 模組 | 功能範圍 | 預計時間 |
|-----|---------|---------|
| **M06** | 台積電股價同步 | 2 週 |
| **M07** | 5-10 個常用指標（MA、EMA、MACD、RSI、KD） | 2 週 |
| **M13** | 基本信號生成與儲存 | 1 週 |
| **M15** | LINE Notify 通知 | 1 週 |

**驗收標準**:
```
✅ 能從 Yahoo Finance 抓取台積電股價
✅ 能計算 MA5、MA20，偵測黃金交叉
✅ 黃金交叉時產生 BUY 信號並存入資料庫
✅ 信號產生時發送 LINE 通知
✅ 提供 REST API 查詢信號
```

---

### 6.2 核心功能階段（P1）

**目標**: 完善核心分析能力，支援多維度分析

| 模組 | 功能範圍 | 預計時間 |
|-----|---------|---------|
| **M07** | 完整 71 個技術指標 | 4 週 |
| **M08** | 基本面分析（75 個財務指標） | 4 週 |
| **M09** | 籌碼分析 | 3 週 |
| **M14** | 選股引擎 | 3 週 |

**驗收標準**:
```
✅ 支援完整的技術指標庫
✅ 能分析財報資料並計算財務指標
✅ 能追蹤三大法人買賣超
✅ 能執行多條件選股（如：高 ROE + 低本益比 + 外資買超）
```

---

### 6.3 進階功能階段（P2）

**目標**: 提供進階分析與策略工具

| 模組 | 功能範圍 | 預計時間 |
|-----|---------|---------|
| **M10** | 技術型態辨識 | 3 週 |
| **M11** | 量化策略模組 | 4 週 |
| **M16** | 回測系統 | 4 週 |
| **M17** | 風險管理 | 2 週 |
| **M18** | 投資組合管理 | 2 週 |

---

### 6.4 擴展功能階段（P3）

**目標**: 總經分析與前端整合

| 模組 | 功能範圍 | 預計時間 |
|-----|---------|---------|
| **M12** | 總經與產業分析 | 3 週 |
| **前端** | Web Dashboard | 6 週 |
| **優化** | 效能優化與監控 | 持續進行 |

---

## 📚 相關文檔

### 功能規格
- [M06 - 資料管理功能需求](M06-資料管理功能需求.md)
- [M07 - 技術分析功能需求](M07-技術分析功能需求.md)
- [M08 - 基本面分析功能需求](M08-基本面分析功能需求.md)

### 技術規格
- [技術架構總覽](../technical/00-技術架構.md)
- [全系統契約](../technical/00-全系統契約.md)
- [開發準則](../technical/00-開發準則.md)

### API 規格
- [M06 API 規格](../api/M06-API規格.md)
- [M07 API 規格](../api/M07-API規格.md)
- [M08 API 規格](../api/M08-API規格.md)

---

**文件維護者**: 產品經理  
**最後更新**: 2025-12-31  
**下次審核**: 2026-01-31
