# M14-選股引擎功能需求

> **文件編號**: FUNC-M14
> **模組名稱**: 選股引擎 (Stock Screening Engine)
> **版本**: v1.0
> **最後更新**: 2026-01-14
> **狀態**: Draft

---

## 1. 模組定位

### 1.1 模組概述

M14 選股引擎是系統的核心決策支援模組，負責根據用戶定義的篩選條件，從全市場股票中篩選出符合條件的投資標的。整合 M13 統一信號與多維度分析數據，提供智能化的選股功能。

### 1.2 核心價值

- **多維度篩選**: 整合技術、基本面、籌碼、信號等多維度條件
- **條件組合**: 支援 AND/OR 邏輯組合複雜篩選條件
- **即時篩選**: 支援即時執行篩選取得結果
- **策略儲存**: 用戶可儲存常用篩選策略重複使用
- **結果追蹤**: 追蹤選股結果的後續表現

### 1.3 系統定位

```
┌─────────────────────────────────────────────────────────────────────────────┐
│                           Layer 5: 決策層                                    │
├─────────────────────────────────────────────────────────────────────────────┤
│                                                                             │
│  ┌─────────────────────────────────────────────────────────────────────┐   │
│  │                                                                     │   │
│  │    ┌─────────────────────────────────────────────────────────┐    │   │
│  │    │                        M13                               │    │   │
│  │    │                   信號判斷引擎                            │    │   │
│  │    │    統一信號 + 評分 + 評級 + 推薦清單                      │    │   │
│  │    └─────────────────────────────────────────────────────────┘    │   │
│  │                              │                                     │   │
│  │    ┌─────────────────────────┴─────────────────────────┐          │   │
│  │    │                                                   │          │   │
│  │    ▼                                                   ▼          │   │
│  │  ┌─────────────────────┐                    ┌─────────────────┐   │   │
│  │  │        M14          │                    │      M15        │   │   │
│  │  │     選股引擎        │ ← 本模組           │    警報通知     │   │   │
│  │  │                     │                    │                 │   │   │
│  │  │  ┌───────────────┐  │                    └─────────────────┘   │   │
│  │  │  │ 篩選條件定義  │  │                                          │   │
│  │  │  │ 條件組合引擎  │  │                                          │   │
│  │  │  │ 選股執行器    │  │                                          │   │
│  │  │  │ 結果排序器    │  │                                          │   │
│  │  │  └───────────────┘  │                                          │   │
│  │  └─────────────────────┘                                          │   │
│  │            │                                                       │   │
│  │            ▼                                                       │   │
│  │  ┌─────────────────────────────────────────────────────────┐      │   │
│  │  │              選股結果輸出                                 │      │   │
│  │  │    → 用戶介面展示                                        │      │   │
│  │  │    → M15 警報觸發                                        │      │   │
│  │  │    → M18 投組建議                                        │      │   │
│  │  └─────────────────────────────────────────────────────────┘      │   │
│  │                                                                     │   │
│  └─────────────────────────────────────────────────────────────────────┘   │
│                                                                             │
└─────────────────────────────────────────────────────────────────────────────┘
```

### 1.4 模組依賴

| 依賴方向 | 模組 | 依賴內容 |
|---------|------|---------|
| 上游 | M06 資料管理 | 股票基本資料、產業分類 |
| 上游 | M07 技術分析 | 技術指標數據（RSI、MACD、均線等） |
| 上游 | M08 基本面分析 | 財務指標數據（PE、ROE、EPS 等） |
| 上游 | M09 籌碼分析 | 籌碼數據（法人買賣、融資券等） |
| 上游 | M13 信號引擎 | 統一信號、評分、評級 |
| 下游 | M15 警報通知 | 選股結果觸發警報 |
| 下游 | M18 投組管理 | 選股結果作為投組建議 |

---

## 2. 功能清單

| 功能編號 | 功能名稱 | 優先級 | 說明 |
|---------|---------|-------|------|
| F-M14-001 | 快速選股 | P0 | 使用預設條件快速篩選股票 |
| F-M14-002 | 自訂條件選股 | P0 | 使用自訂多維度條件篩選 |
| F-M14-003 | 條件組合器 | P0 | AND/OR 邏輯組合多條件 |
| F-M14-004 | 選股策略管理 | P0 | 儲存、載入、編輯選股策略 |
| F-M14-005 | 選股執行 | P0 | 執行選股並取得結果 |
| F-M14-006 | 結果排序 | P0 | 多維度排序選股結果 |
| F-M14-007 | 信號選股 | P0 | 基於 M13 信號的選股 |
| F-M14-008 | 選股歷史 | P1 | 記錄選股執行歷史 |
| F-M14-009 | 績效追蹤 | P1 | 追蹤選股結果後續表現 |
| F-M14-010 | 選股分享 | P2 | 分享選股策略給其他用戶 |

---

## 3. 功能詳細設計

### F-M14-001: 快速選股

**功能描述**: 提供預設選股模板，用戶可一鍵執行常見選股需求。

**預設選股模板**:

| 模板代碼 | 模板名稱 | 篩選條件 | 說明 |
|---------|---------|---------|------|
| QUICK_01 | 強勢股 | 信號評級 >= A, 方向 = BUY | M13 高評級買入信號 |
| QUICK_02 | 外資連買 | 外資連續買超 >= 3 日 | 籌碼面強勢 |
| QUICK_03 | 低估價值股 | PE < 15, ROE > 15%, 股利率 > 3% | 價值投資 |
| QUICK_04 | 技術突破 | 突破 20 日均線, 成交量放大 > 50% | 技術面轉強 |
| QUICK_05 | 動能選股 | RSI > 50, MACD 黃金交叉 | 動能轉強 |
| QUICK_06 | 績優成長 | 營收 YoY > 10%, EPS 成長 > 15% | 成長股 |
| QUICK_07 | 籌碼集中 | 主力連買 >= 5 日, 散戶減少 | 籌碼集中 |
| QUICK_08 | 多頭排列 | MA5 > MA10 > MA20 > MA60 | 均線多頭 |

**API 使用方式**:
```json
POST /api/m14/screening/quick
{
  "template_code": "QUICK_01",
  "market": "TWSE",
  "limit": 50
}
```

**驗收條件**:
- [ ] 8 種預設模板可正常執行
- [ ] 支援限制回傳筆數
- [ ] 執行時間 < 3 秒

---

### F-M14-002: 自訂條件選股

**功能描述**: 用戶可自訂多維度篩選條件進行選股。

**篩選維度與條件**:

#### 1. 基本面條件

| 條件代碼 | 條件名稱 | 資料來源 | 運算符 |
|---------|---------|---------|-------|
| F_PE | 本益比 | M08 | <, <=, =, >=, >, BETWEEN |
| F_PB | 股價淨值比 | M08 | <, <=, =, >=, >, BETWEEN |
| F_ROE | 股東權益報酬率 | M08 | <, <=, =, >=, >, BETWEEN |
| F_ROA | 資產報酬率 | M08 | <, <=, =, >=, >, BETWEEN |
| F_EPS | 每股盈餘 | M08 | <, <=, =, >=, >, BETWEEN |
| F_EPS_GROWTH | EPS 成長率 | M08 | <, <=, =, >=, >, BETWEEN |
| F_REVENUE_GROWTH | 營收成長率 | M08 | <, <=, =, >=, >, BETWEEN |
| F_GROSS_MARGIN | 毛利率 | M08 | <, <=, =, >=, >, BETWEEN |
| F_OPERATING_MARGIN | 營業利益率 | M08 | <, <=, =, >=, >, BETWEEN |
| F_NET_MARGIN | 淨利率 | M08 | <, <=, =, >=, >, BETWEEN |
| F_DIVIDEND_YIELD | 股利率 | M08 | <, <=, =, >=, >, BETWEEN |
| F_DEBT_RATIO | 負債比率 | M08 | <, <=, =, >=, >, BETWEEN |
| F_CURRENT_RATIO | 流動比率 | M08 | <, <=, =, >=, >, BETWEEN |

#### 2. 技術面條件

| 條件代碼 | 條件名稱 | 資料來源 | 運算符 |
|---------|---------|---------|-------|
| T_RSI | RSI 指標 | M07 | <, <=, =, >=, >, BETWEEN |
| T_KD_K | KD 指標 K 值 | M07 | <, <=, =, >=, >, BETWEEN |
| T_KD_D | KD 指標 D 值 | M07 | <, <=, =, >=, >, BETWEEN |
| T_MACD | MACD | M07 | <, <=, =, >=, >, BETWEEN |
| T_MACD_SIGNAL | MACD 訊號線狀態 | M07 | =（GOLDEN_CROSS, DEATH_CROSS） |
| T_MA5 | 5 日均線 | M07 | ABOVE, BELOW, CROSS_ABOVE, CROSS_BELOW |
| T_MA10 | 10 日均線 | M07 | ABOVE, BELOW, CROSS_ABOVE, CROSS_BELOW |
| T_MA20 | 20 日均線 | M07 | ABOVE, BELOW, CROSS_ABOVE, CROSS_BELOW |
| T_MA60 | 60 日均線 | M07 | ABOVE, BELOW, CROSS_ABOVE, CROSS_BELOW |
| T_BOLLINGER | 布林通道位置 | M07 | =（UPPER, MIDDLE, LOWER） |
| T_VOLUME_RATIO | 量比 | M07 | <, <=, =, >=, >, BETWEEN |
| T_MA_ALIGNMENT | 均線排列 | M07 | =（BULLISH, BEARISH, MIXED） |

#### 3. 籌碼面條件

| 條件代碼 | 條件名稱 | 資料來源 | 運算符 |
|---------|---------|---------|-------|
| C_FOREIGN_NET | 外資買賣超 | M09 | <, <=, =, >=, >, BETWEEN |
| C_FOREIGN_CONT | 外資連續買賣 | M09 | <, <=, =, >=, > |
| C_TRUST_NET | 投信買賣超 | M09 | <, <=, =, >=, >, BETWEEN |
| C_TRUST_CONT | 投信連續買賣 | M09 | <, <=, =, >=, > |
| C_DEALER_NET | 自營商買賣超 | M09 | <, <=, =, >=, >, BETWEEN |
| C_INST_TOTAL | 三大法人合計 | M09 | <, <=, =, >=, >, BETWEEN |
| C_MARGIN_RATIO | 融資使用率 | M09 | <, <=, =, >=, >, BETWEEN |
| C_SHORT_RATIO | 融券使用率 | M09 | <, <=, =, >=, >, BETWEEN |
| C_MARGIN_BALANCE | 融資餘額變化 | M09 | <, <=, =, >=, >, BETWEEN |
| C_CONCENTRATION | 籌碼集中度 | M09 | <, <=, =, >=, >, BETWEEN |

#### 4. 信號面條件

| 條件代碼 | 條件名稱 | 資料來源 | 運算符 |
|---------|---------|---------|-------|
| S_DIRECTION | 信號方向 | M13 | =（BUY, SELL, HOLD） |
| S_GRADE | 信號評級 | M13 | =, >=（A+, A, B+, B, C, D） |
| S_SCORE | 信號評分 | M13 | <, <=, =, >=, >, BETWEEN |
| S_STRENGTH | 方向強度 | M13 | =（STRONG, MODERATE, WEAK） |
| S_COVERAGE | 維度覆蓋 | M13 | <, <=, =, >=, > |
| S_HAS_SIGNAL | 是否有信號 | M13 | =（TRUE, FALSE） |

#### 5. 股票屬性條件

| 條件代碼 | 條件名稱 | 資料來源 | 運算符 |
|---------|---------|---------|-------|
| A_MARKET | 市場 | M06 | =（TWSE, OTC） |
| A_SECTOR | 產業別 | M06 | =, IN |
| A_MARKET_CAP | 市值 | M06 | <, <=, =, >=, >, BETWEEN |
| A_PRICE | 股價 | M06 | <, <=, =, >=, >, BETWEEN |
| A_VOLUME | 成交量 | M06 | <, <=, =, >=, >, BETWEEN |
| A_TURNOVER | 周轉率 | M06 | <, <=, =, >=, >, BETWEEN |

**條件定義格式**:
```json
{
  "condition_code": "F_PE",
  "operator": "BETWEEN",
  "values": [5, 15],
  "description": "本益比介於 5-15 倍"
}
```

**驗收條件**:
- [ ] 支援 5 大維度超過 40 種條件
- [ ] 條件參數驗證正確
- [ ] 無效條件有明確錯誤訊息

---

### F-M14-003: 條件組合器

**功能描述**: 使用 AND/OR 邏輯組合多個篩選條件。

**組合邏輯結構**:

```json
{
  "logic": "AND",
  "conditions": [
    {
      "condition_code": "F_PE",
      "operator": "<=",
      "values": [15]
    },
    {
      "logic": "OR",
      "conditions": [
        {
          "condition_code": "C_FOREIGN_CONT",
          "operator": ">=",
          "values": [3]
        },
        {
          "condition_code": "C_TRUST_CONT",
          "operator": ">=",
          "values": [3]
        }
      ]
    },
    {
      "condition_code": "S_GRADE",
      "operator": ">=",
      "values": ["B+"]
    }
  ]
}
```

**解析邏輯**:
```
篩選條件 = (PE <= 15) AND (外資連買 >= 3 OR 投信連買 >= 3) AND (評級 >= B+)
```

**組合限制**:

| 限制項目 | 限制值 | 說明 |
|---------|-------|------|
| 最大條件數 | 20 | 單一策略最多 20 個條件 |
| 最大巢狀層級 | 3 | 最多支援 3 層巢狀 |
| 最大 OR 分支 | 5 | 單一 OR 最多 5 個子條件 |

**驗收條件**:
- [ ] AND/OR 邏輯正確執行
- [ ] 巢狀組合正確解析
- [ ] 超出限制有明確錯誤

---

### F-M14-004: 選股策略管理

**功能描述**: 用戶可儲存、載入、編輯選股策略。

**策略資料結構**:
```json
{
  "strategy_id": "STR_001",
  "strategy_name": "價值成長股",
  "description": "低估值且有成長動能的股票",
  "owner_id": "user_001",
  "is_public": false,
  "conditions": { ... },
  "sort_by": ["S_SCORE", "F_ROE"],
  "sort_direction": ["DESC", "DESC"],
  "created_at": "2024-12-24T10:00:00+08:00",
  "updated_at": "2024-12-24T10:00:00+08:00",
  "execution_count": 15,
  "last_executed_at": "2024-12-24T16:00:00+08:00"
}
```

**策略操作**:

| 操作 | 說明 |
|-----|------|
| 建立 | 新增選股策略 |
| 讀取 | 載入策略詳情 |
| 更新 | 修改策略條件 |
| 刪除 | 刪除策略 |
| 複製 | 複製策略為新版本 |
| 執行 | 執行策略並取得結果 |

**驗收條件**:
- [ ] CRUD 操作正常
- [ ] 策略版本管理
- [ ] 用戶只能編輯自己的策略

---

### F-M14-005: 選股執行

**功能描述**: 執行選股策略並回傳符合條件的股票。

**執行流程**:

```
┌─────────────────────────────────────────────────────────────────────────────┐
│                          選股執行流程                                        │
└─────────────────────────────────────────────────────────────────────────────┘

                    ┌─────────────────────┐
                    │   接收篩選請求      │
                    │  (條件 / 策略ID)    │
                    └─────────────────────┘
                              │
                              ▼
                    ┌─────────────────────┐
                    │   解析篩選條件      │
                    │   驗證條件合法性    │
                    └─────────────────────┘
                              │
                              ▼
                    ┌─────────────────────┐
                    │   載入候選股票池    │
                    │  (市場/產業篩選)    │
                    └─────────────────────┘
                              │
                              ▼
          ┌───────────────────┼───────────────────┐
          │                   │                   │
          ▼                   ▼                   ▼
    ┌───────────┐      ┌───────────┐      ┌───────────┐
    │ 技術條件  │      │ 基本面    │      │ 籌碼條件  │
    │  篩選     │      │ 條件篩選  │      │  篩選     │
    └───────────┘      └───────────┘      └───────────┘
          │                   │                   │
          └───────────────────┼───────────────────┘
                              │
                              ▼
                    ┌─────────────────────┐
                    │   信號條件篩選      │
                    │   (若有設定)        │
                    └─────────────────────┘
                              │
                              ▼
                    ┌─────────────────────┐
                    │   條件組合運算      │
                    │   (AND/OR 邏輯)     │
                    └─────────────────────┘
                              │
                              ▼
                    ┌─────────────────────┐
                    │   結果排序          │
                    └─────────────────────┘
                              │
                              ▼
                    ┌─────────────────────┐
                    │   回傳選股結果      │
                    │   記錄執行歷史      │
                    └─────────────────────┘
```

**執行結果格式**:
```json
{
  "execution_id": "EXEC_20241224_001",
  "strategy_id": "STR_001",
  "executed_at": "2024-12-24T16:30:00+08:00",
  "execution_time_ms": 1250,
  "total_candidates": 1800,
  "matched_count": 35,
  "results": [
    {
      "rank": 1,
      "stock_id": "2330",
      "stock_name": "台積電",
      "sector": "半導體",
      "price": 580.00,
      "matched_conditions": ["F_ROE >= 20", "S_GRADE >= A", "C_FOREIGN_CONT >= 5"],
      "key_metrics": {
        "pe": 12.5,
        "roe": 25.3,
        "signal_score": 92.5,
        "foreign_cont_days": 8
      }
    }
  ]
}
```

**驗收條件**:
- [ ] 執行時間 < 5 秒（1000+ 股票）
- [ ] 結果正確符合所有條件
- [ ] 執行記錄完整

---

### F-M14-006: 結果排序

**功能描述**: 支援多維度排序選股結果。

**排序欄位**:

| 排序代碼 | 排序欄位 | 預設方向 |
|---------|---------|---------|
| S_SCORE | 信號評分 | DESC |
| F_ROE | ROE | DESC |
| F_PE | 本益比 | ASC |
| F_DIVIDEND_YIELD | 股利率 | DESC |
| C_FOREIGN_NET | 外資買賣超 | DESC |
| C_INST_TOTAL | 法人合計 | DESC |
| T_RSI | RSI | DESC |
| A_MARKET_CAP | 市值 | DESC |
| A_VOLUME | 成交量 | DESC |

**多欄位排序**:
```json
{
  "sort_by": ["S_SCORE", "F_ROE", "C_FOREIGN_NET"],
  "sort_direction": ["DESC", "DESC", "DESC"]
}
```

**驗收條件**:
- [ ] 支援最多 3 欄位排序
- [ ] 排序結果正確
- [ ] 空值處理正確

---

### F-M14-007: 信號選股

**功能描述**: 專門基於 M13 統一信號的選股功能。

**信號選股模式**:

| 模式 | 說明 | 預設條件 |
|-----|------|---------|
| SIGNAL_TOP | 信號評分前 N 名 | 評分排序 |
| SIGNAL_GRADE | 指定評級 | grade IN ('A+', 'A') |
| SIGNAL_BUY | 強烈買入信號 | direction=BUY, strength=STRONG |
| SIGNAL_SELL | 強烈賣出信號 | direction=SELL, strength=STRONG |
| SIGNAL_NEW | 今日新信號 | trade_date = today |
| SIGNAL_MULTI | 多維度覆蓋 | coverage >= 4 |

**API 使用**:
```json
POST /api/m14/screening/signal
{
  "mode": "SIGNAL_BUY",
  "trade_date": "2024-12-24",
  "min_grade": "B+",
  "min_coverage": 3,
  "limit": 20
}
```

**驗收條件**:
- [ ] 6 種信號模式正常執行
- [ ] 與 M13 數據同步
- [ ] 結果按評分排序

---

### F-M14-008: 選股歷史

**功能描述**: 記錄選股執行歷史，支援查詢與重新執行。

**歷史記錄內容**:
- 執行 ID
- 策略/條件快照
- 執行時間
- 結果股票清單
- 執行效能統計

**查詢功能**:
- 按日期範圍查詢
- 按策略查詢
- 按結果股票查詢

**驗收條件**:
- [ ] 歷史記錄完整保存
- [ ] 支援重新執行
- [ ] 保留 90 天歷史

---

### F-M14-009: 績效追蹤

**功能描述**: 追蹤選股結果的後續價格表現。

**追蹤指標**:

| 指標 | 計算方式 | 說明 |
|-----|---------|------|
| 1日報酬 | (P1 - P0) / P0 | 次日收盤價變化 |
| 5日報酬 | (P5 - P0) / P0 | 5 日後價格變化 |
| 10日報酬 | (P10 - P0) / P0 | 10 日後價格變化 |
| 20日報酬 | (P20 - P0) / P0 | 20 日後價格變化 |
| 最大漲幅 | max(Pn) / P0 - 1 | 期間最高價漲幅 |
| 最大跌幅 | min(Pn) / P0 - 1 | 期間最低價跌幅 |
| 勝率 | 正報酬數 / 總數 | 選股準確率 |

**績效統計格式**:
```json
{
  "execution_id": "EXEC_20241224_001",
  "trade_date": "2024-12-24",
  "total_stocks": 35,
  "performance_stats": {
    "return_1d": { "avg": 0.012, "max": 0.05, "min": -0.02, "win_rate": 0.68 },
    "return_5d": { "avg": 0.025, "max": 0.12, "min": -0.05, "win_rate": 0.62 },
    "return_10d": { "avg": 0.038, "max": 0.18, "min": -0.08, "win_rate": 0.58 }
  }
}
```

**驗收條件**:
- [ ] 每日自動更新績效
- [ ] 統計指標正確計算
- [ ] 支援策略績效比較

---

### F-M14-010: 選股分享

**功能描述**: 用戶可分享選股策略給其他用戶。

**分享方式**:
- 設定策略為公開
- 產生分享連結
- 其他用戶可複製使用

**權限控制**:
- 公開策略: 所有人可查看、複製
- 私有策略: 僅擁有者可操作

**驗收條件**:
- [ ] 分享連結有效
- [ ] 複製策略正確
- [ ] 權限控制正常

---

## 4. 系統架構

### 4.1 選股引擎架構

```
┌─────────────────────────────────────────────────────────────────────────────┐
│                          M14 Screening Engine                                │
├─────────────────────────────────────────────────────────────────────────────┤
│                                                                             │
│  ┌─────────────────────────────────────────────────────────────────────┐   │
│  │                      ScreeningService                                │   │
│  │                        (選股服務)                                    │   │
│  │  - executeQuickScreening()                                          │   │
│  │  - executeCustomScreening()                                         │   │
│  │  - executeSignalScreening()                                         │   │
│  │  - executeStrategy()                                                │   │
│  └─────────────────────────────────────────────────────────────────────┘   │
│                                    │                                        │
│                                    ▼                                        │
│  ┌─────────────────────────────────────────────────────────────────────┐   │
│  │                      ConditionParser                                 │   │
│  │                      (條件解析器)                                    │   │
│  │  - parseConditions()                                                │   │
│  │  - validateConditions()                                             │   │
│  │  - buildConditionTree()                                             │   │
│  └─────────────────────────────────────────────────────────────────────┘   │
│                                    │                                        │
│                                    ▼                                        │
│  ┌─────────────────────────────────────────────────────────────────────┐   │
│  │                      ScreeningExecutor                               │   │
│  │                        (選股執行器)                                  │   │
│  │  ┌─────────────┐ ┌─────────────┐ ┌─────────────┐ ┌─────────────┐   │   │
│  │  │ Technical   │ │Fundamental  │ │   Chip      │ │   Signal    │   │   │
│  │  │ Screener    │ │ Screener    │ │ Screener    │ │ Screener    │   │   │
│  │  │ (技術篩選)  │ │(基本面篩選) │ │ (籌碼篩選)  │ │ (信號篩選)  │   │   │
│  │  └─────────────┘ └─────────────┘ └─────────────┘ └─────────────┘   │   │
│  └─────────────────────────────────────────────────────────────────────┘   │
│                                    │                                        │
│                                    ▼                                        │
│  ┌─────────────────────────────────────────────────────────────────────┐   │
│  │                      ResultAggregator                                │   │
│  │                      (結果彙整器)                                    │   │
│  │  - combineResults()                                                 │   │
│  │  - applyLogicOperators()                                            │   │
│  │  - sortResults()                                                    │   │
│  │  - buildResponse()                                                  │   │
│  └─────────────────────────────────────────────────────────────────────┘   │
│                                                                             │
└─────────────────────────────────────────────────────────────────────────────┘
```

### 4.2 技術選型

| 層級 | 技術選擇 | 說明 |
|-----|---------|------|
| 持久層 | MyBatis | 複雜動態查詢、跨表聯結 |
| 快取 | Redis | 策略快取、結果快取 |
| 排程 | Quartz | 績效追蹤排程 |
| API | REST | 提供選股接口 |

---

## 5. 非功能性需求

| 需求類型 | 需求內容 | 目標值 |
|---------|---------|-------|
| 效能 | 選股執行時間（1000 股） | < 3 秒 |
| 效能 | 複雜條件執行時間 | < 5 秒 |
| 效能 | API 回應時間 | P95 < 500ms |
| 並發 | 同時執行數 | 50 |
| 可用性 | 服務可用率 | 99.5% |
| 資料新鮮度 | 與上游同步延遲 | < 5 分鐘 |

---

## 6. 錯誤碼定義

| 錯誤碼 | HTTP Status | 說明 |
|-------|-------------|------|
| M14_001 | 400 | 無效的篩選條件 |
| M14_002 | 400 | 條件參數錯誤 |
| M14_003 | 400 | 超過條件數量限制 |
| M14_004 | 400 | 無效的策略 ID |
| M14_005 | 404 | 策略不存在 |
| M14_006 | 403 | 無權限操作此策略 |
| M14_007 | 500 | 選股執行失敗 |
| M14_008 | 504 | 選股執行超時 |
| M14_009 | 400 | 無效的排序欄位 |
| M14_010 | 400 | 無效的快速選股模板 |

---

## 7. 驗收標準

### 7.1 功能驗收

- [ ] 10 項功能通過單元測試
- [ ] 8 種快速選股模板可執行
- [ ] 自訂條件組合正確
- [ ] 策略 CRUD 正常
- [ ] 績效追蹤準確

### 7.2 整合驗收

- [ ] 與 M07/M08/M09 數據整合正常
- [ ] 與 M13 信號整合正常
- [ ] API 回應時間符合 SLA

---

## 📚 相關文檔

- [M14 API 規格](../api/M14-API規格.md)
- [M14 資料庫設計](../../design/M14-資料庫設計.md)
- [M14 業務流程](../../design/M14-業務流程.md)
- [M13 信號引擎](./M13-信號引擎功能需求.md)

---

**文件維護者**: 產品經理
**最後更新**: 2026-01-14
**下次審核**: 2026-04-14
