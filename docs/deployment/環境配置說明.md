# ç’°å¢ƒé…ç½®èªªæ˜

> **æ–‡ä»¶ç·¨è™Ÿ**: DEPLOY-ENV-00  
> **æ–‡ä»¶åç¨±**: ç’°å¢ƒé…ç½®èªªæ˜  
> **ç‰ˆæœ¬**: v2.0  
> **æœ€å¾Œæ›´æ–°**: 2025-12-31  
> **ç‹€æ…‹**: Draft

---

## ğŸ“‘ ç›®éŒ„

1. [ç’°å¢ƒç¸½è¦½](#1-ç’°å¢ƒç¸½è¦½)
2. [é–‹ç™¼ç’°å¢ƒé…ç½®](#2-é–‹ç™¼ç’°å¢ƒé…ç½®)
3. [æ¸¬è©¦ç’°å¢ƒé…ç½®](#3-æ¸¬è©¦ç’°å¢ƒé…ç½®)
4. [ç”Ÿç”¢ç’°å¢ƒé…ç½®](#4-ç”Ÿç”¢ç’°å¢ƒé…ç½®)
5. [é…ç½®æª”ç®¡ç†](#5-é…ç½®æª”ç®¡ç†)
6. [ç’°å¢ƒè®Šæ•¸](#6-ç’°å¢ƒè®Šæ•¸)
7. [è³‡æ–™åº«é…ç½®](#7-è³‡æ–™åº«é…ç½®)
8. [å¿«å–é…ç½®](#8-å¿«å–é…ç½®)
9. [è¨Šæ¯ä½‡åˆ—é…ç½®](#9-è¨Šæ¯ä½‡åˆ—é…ç½®)
10. [ç›£æ§èˆ‡æ—¥èªŒ](#10-ç›£æ§èˆ‡æ—¥èªŒ)

---

## 1. ç’°å¢ƒç¸½è¦½

### 1.1 ç’°å¢ƒè¦åŠƒ

| ç’°å¢ƒ | ç”¨é€” | åŸŸå | è³‡æºé…ç½® | è³‡æ–™ä¿ç•™ |
|-----|------|------|---------|---------|
| **DEV** | é–‹ç™¼æ¸¬è©¦ | dev.stock-api.internal | æœ€å° | 30å¤© |
| **TEST** | æ•´åˆæ¸¬è©¦ | test.stock-api.internal | ä¸­ç­‰ | 90å¤© |
| **STAGING** | é ç™¼å¸ƒ | staging.stock-api.com | èˆ‡ç”Ÿç”¢ä¸€è‡´ | 30å¤© |
| **PROD** | ç”Ÿç”¢ç’°å¢ƒ | api.stock-analysis.com | é«˜å¯ç”¨ | ä¾è³‡æ–™é¡å‹ |

### 1.2 ç’°å¢ƒéš”é›¢

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                  ç”Ÿç”¢ç’°å¢ƒ (PROD)                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  Kubernetes Cluster (Production)          â”‚  â”‚
â”‚  â”‚  - 3 Master Nodes                         â”‚  â”‚
â”‚  â”‚  - 6 Worker Nodes                         â”‚  â”‚
â”‚  â”‚  - LoadBalancer                           â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                 é ç™¼ç’°å¢ƒ (STAGING)                â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  Kubernetes Cluster (Staging)             â”‚  â”‚
â”‚  â”‚  - 1 Master Node                          â”‚  â”‚
â”‚  â”‚  - 3 Worker Nodes                         â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚             æ¸¬è©¦ç’°å¢ƒ (TEST) + é–‹ç™¼ç’°å¢ƒ (DEV)       â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  Docker Compose                           â”‚  â”‚
â”‚  â”‚  - å–®æ©Ÿéƒ¨ç½²                                 â”‚  â”‚
â”‚  â”‚  - æ‰€æœ‰æœå‹™å®¹å™¨åŒ–                           â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 2. é–‹ç™¼ç’°å¢ƒé…ç½®

### 2.1 é–‹ç™¼ç’°å¢ƒè¦æ±‚

| é …ç›® | éœ€æ±‚ |
|-----|------|
| **ä½œæ¥­ç³»çµ±** | Windows 10+ / macOS 12+ / Ubuntu 20.04+ |
| **JDK** | OpenJDK 17+ |
| **Python** | Python 3.11+ |
| **Docker** | Docker 20.10+ / Docker Desktop |
| **IDE** | IntelliJ IDEA / VS Code |
| **Git** | Git 2.30+ |

### 2.2 é–‹ç™¼ç’°å¢ƒå•Ÿå‹•

#### Docker Compose é…ç½®

```yaml
# docker-compose.dev.yml
version: '3.8'

services:
  postgres:
    image: postgres:15
    container_name: stock-postgres-dev
    environment:
      POSTGRES_DB: stock_analysis_dev
      POSTGRES_USER: postgres
      POSTGRES_PASSWORD: dev_password
      POSTGRES_INITDB_ARGS: "--encoding=UTF8 --locale=C"
    ports:
      - "5432:5432"
    volumes:
      - postgres_data_dev:/var/lib/postgresql/data
      - ./init-scripts:/docker-entrypoint-initdb.d
    networks:
      - stock-network

  redis:
    image: redis:7.0-alpine
    container_name: stock-redis-dev
    ports:
      - "6379:6379"
    volumes:
      - redis_data_dev:/data
    networks:
      - stock-network

  rabbitmq:
    image: rabbitmq:3.12-management
    container_name: stock-rabbitmq-dev
    environment:
      RABBITMQ_DEFAULT_USER: admin
      RABBITMQ_DEFAULT_PASS: dev_password
    ports:
      - "5672:5672"   # AMQP
      - "15672:15672" # Management UI
    volumes:
      - rabbitmq_data_dev:/var/lib/rabbitmq
    networks:
      - stock-network

volumes:
  postgres_data_dev:
  redis_data_dev:
  rabbitmq_data_dev:

networks:
  stock-network:
    driver: bridge
```

#### å•Ÿå‹•å‘½ä»¤

```bash
# å•Ÿå‹•æ‰€æœ‰æœå‹™
docker-compose -f docker-compose.dev.yml up -d

# æŸ¥çœ‹æœå‹™ç‹€æ…‹
docker-compose -f docker-compose.dev.yml ps

# æŸ¥çœ‹æ—¥èªŒ
docker-compose -f docker-compose.dev.yml logs -f

# åœæ­¢æ‰€æœ‰æœå‹™
docker-compose -f docker-compose.dev.yml down
```

### 2.3 é–‹ç™¼ç’°å¢ƒé…ç½®æª”

**application-dev.yml**

```yaml
spring:
  profiles:
    active: dev
  
  datasource:
    url: jdbc:postgresql://localhost:5432/stock_analysis_dev
    username: postgres
    password: dev_password
    driver-class-name: org.postgresql.Driver
    hikari:
      maximum-pool-size: 5
      minimum-idle: 2
      connection-timeout: 30000
  
  jpa:
    hibernate:
      ddl-auto: update  # é–‹ç™¼ç’°å¢ƒè‡ªå‹•æ›´æ–° Schema
    show-sql: true      # é¡¯ç¤º SQL
    properties:
      hibernate:
        format_sql: true
        dialect: org.hibernate.dialect.PostgreSQLDialect
  
  data:
    redis:
      host: localhost
      port: 6379
      database: 0
      timeout: 3000ms
  
  rabbitmq:
    host: localhost
    port: 5672
    username: admin
    password: dev_password

logging:
  level:
    root: INFO
    com.stockanalysis: DEBUG
    org.hibernate.SQL: DEBUG
    org.hibernate.type.descriptor.sql: TRACE

server:
  port: 8080
```

---

## 3. æ¸¬è©¦ç’°å¢ƒé…ç½®

### 3.1 æ¸¬è©¦ç’°å¢ƒç‰¹æ€§

| ç‰¹æ€§ | é…ç½® |
|-----|------|
| **è³‡æ–™åº«** | ç¨ç«‹ PostgreSQL å¯¦ä¾‹ |
| **è³‡æ–™é‡** | ç”Ÿç”¢è³‡æ–™çš„ 20% |
| **è‡ªå‹•åŒ–æ¸¬è©¦** | å•Ÿç”¨ CI/CD |
| **ç›£æ§** | Prometheus + Grafana |
| **æ—¥èªŒ** | ELK Stack |

### 3.2 æ¸¬è©¦ç’°å¢ƒé…ç½®æª”

**application-test.yml**

```yaml
spring:
  profiles:
    active: test
  
  datasource:
    url: jdbc:postgresql://test-db.internal:5432/stock_analysis_test
    username: stock_test_user
    password: ${DB_PASSWORD}  # å¾ç’°å¢ƒè®Šæ•¸è®€å–
    hikari:
      maximum-pool-size: 10
      minimum-idle: 3
  
  jpa:
    hibernate:
      ddl-auto: validate  # æ¸¬è©¦ç’°å¢ƒä¸è‡ªå‹•æ›´æ–° Schema
    show-sql: false
  
  data:
    redis:
      host: test-redis.internal
      port: 6379
      password: ${REDIS_PASSWORD}
  
  rabbitmq:
    host: test-rabbitmq.internal
    port: 5672
    username: ${RABBITMQ_USER}
    password: ${RABBITMQ_PASSWORD}

logging:
  level:
    root: INFO
    com.stockanalysis: INFO

server:
  port: 8080
```

---

## 4. ç”Ÿç”¢ç’°å¢ƒé…ç½®

### 4.1 ç”Ÿç”¢ç’°å¢ƒæ¶æ§‹

```
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚  Load Balancer  â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                             â”‚
                 â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                 â”‚                       â”‚
         â”Œâ”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”        â”Œâ”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”
         â”‚  API Gateway â”‚        â”‚  API Gateway â”‚
         â”‚   (Pod x3)   â”‚        â”‚   (Pod x3)   â”‚
         â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜        â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
                 â”‚                      â”‚
         â”Œâ”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”
         â”‚                                      â”‚
    â”Œâ”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
    â”‚ M06 Svc  â”‚  â”‚ M07 Svc â”‚  â”‚ M08 Svc  â”‚   â”‚
    â”‚ (Pod x2) â”‚  â”‚ (Pod x2)â”‚  â”‚ (Pod x2) â”‚   â”‚
    â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜   â”‚
         â”‚             â”‚            â”‚          â”‚
         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                       â”‚
              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
              â”‚                  â”‚
      â”Œâ”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”
      â”‚  PostgreSQL    â”‚  â”‚   Redis    â”‚
      â”‚  Cluster       â”‚  â”‚  Cluster   â”‚
      â”‚  (3 Nodes)     â”‚  â”‚ (6 Nodes)  â”‚
      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 4.2 ç”Ÿç”¢ç’°å¢ƒé…ç½®æª”

**application-prod.yml**

```yaml
spring:
  profiles:
    active: prod
  
  datasource:
    url: jdbc:postgresql://prod-db-cluster.internal:5432/stock_analysis_prod
    username: ${DB_USERNAME}
    password: ${DB_PASSWORD}
    hikari:
      maximum-pool-size: 20
      minimum-idle: 5
      connection-timeout: 30000
      idle-timeout: 600000
      max-lifetime: 1800000
      leak-detection-threshold: 60000
  
  jpa:
    hibernate:
      ddl-auto: none  # ç”Ÿç”¢ç’°å¢ƒç¦æ­¢è‡ªå‹•æ›´æ–°
    show-sql: false
    properties:
      hibernate:
        jdbc:
          batch_size: 50
        order_inserts: true
        order_updates: true
  
  data:
    redis:
      cluster:
        nodes:
          - prod-redis-1.internal:6379
          - prod-redis-2.internal:6379
          - prod-redis-3.internal:6379
        max-redirects: 3
      password: ${REDIS_PASSWORD}
      lettuce:
        pool:
          max-active: 20
          max-idle: 10
          min-idle: 5
  
  rabbitmq:
    addresses: prod-rabbitmq-1.internal:5672,prod-rabbitmq-2.internal:5672
    username: ${RABBITMQ_USER}
    password: ${RABBITMQ_PASSWORD}
    listener:
      simple:
        retry:
          enabled: true
          max-attempts: 3

logging:
  level:
    root: WARN
    com.stockanalysis: INFO
  file:
    name: /var/log/stock-analysis/application.log
    max-size: 100MB
    max-history: 30

server:
  port: 8080
  shutdown: graceful
  tomcat:
    threads:
      max: 200
      min-spare: 10
    max-connections: 10000
    accept-count: 100

management:
  endpoints:
    web:
      exposure:
        include: health,info,metrics,prometheus
  endpoint:
    health:
      show-details: when-authorized
  metrics:
    export:
      prometheus:
        enabled: true
```

---

## 5. é…ç½®æª”ç®¡ç†

### 5.1 é…ç½®æª”å±¤ç´š

```
application.yml                    â† å…±ç”¨åŸºç¤é…ç½®
â”œâ”€â”€ application-dev.yml            â† é–‹ç™¼ç’°å¢ƒè¦†è“‹
â”œâ”€â”€ application-test.yml           â† æ¸¬è©¦ç’°å¢ƒè¦†è“‹
â”œâ”€â”€ application-staging.yml        â† é ç™¼ç’°å¢ƒè¦†è“‹
â””â”€â”€ application-prod.yml           â† ç”Ÿç”¢ç’°å¢ƒè¦†è“‹
```

### 5.2 æ•æ„Ÿè³‡è¨Šç®¡ç†

**âŒ ä¸è¦åœ¨é…ç½®æª”ä¸­æ˜æ–‡å„²å­˜**:
- è³‡æ–™åº«å¯†ç¢¼
- API é‡‘é‘°
- Redis å¯†ç¢¼
- åŠ å¯†é‡‘é‘°

**âœ… ä½¿ç”¨ç’°å¢ƒè®Šæ•¸æˆ– Secrets ç®¡ç†**:

```yaml
# Kubernetes Secret ç¯„ä¾‹
apiVersion: v1
kind: Secret
metadata:
  name: stock-analysis-secrets
type: Opaque
data:
  db-password: cGFzc3dvcmQxMjM=  # Base64 ç·¨ç¢¼
  redis-password: cmVkaXNwYXNz
  rabbitmq-password: cmFiYml0bXE=
```

```yaml
# åœ¨ Deployment ä¸­æ³¨å…¥
env:
  - name: DB_PASSWORD
    valueFrom:
      secretKeyRef:
        name: stock-analysis-secrets
        key: db-password
```

---

## 6. ç’°å¢ƒè®Šæ•¸

### 6.1 å¿…è¦ç’°å¢ƒè®Šæ•¸

| è®Šæ•¸åç¨± | èªªæ˜ | ç¯„ä¾‹ | å¿…å¡« |
|---------|------|------|------|
| `SPRING_PROFILES_ACTIVE` | å•Ÿç”¨çš„ Profile | `prod` | âœ… |
| `DB_USERNAME` | è³‡æ–™åº«ä½¿ç”¨è€…åç¨± | `stock_user` | âœ… |
| `DB_PASSWORD` | è³‡æ–™åº«å¯†ç¢¼ | `***` | âœ… |
| `REDIS_PASSWORD` | Redis å¯†ç¢¼ | `***` | âœ… |
| `RABBITMQ_USER` | RabbitMQ ä½¿ç”¨è€… | `stock_mq` | âœ… |
| `RABBITMQ_PASSWORD` | RabbitMQ å¯†ç¢¼ | `***` | âœ… |
| `YAHOO_API_KEY` | Yahoo Finance API é‡‘é‘° | `***` | âŒ |
| `LOG_LEVEL` | æ—¥èªŒç´šåˆ¥ | `INFO` | âŒ |
| `CACHE_TTL` | å¿«å–éæœŸæ™‚é–“ (ç§’) | `3600` | âŒ |

### 6.2 ç’°å¢ƒè®Šæ•¸è¨­å®š

#### Linux / macOS

```bash
# .env æª”æ¡ˆ
export SPRING_PROFILES_ACTIVE=prod
export DB_USERNAME=stock_user
export DB_PASSWORD=your_secure_password
export REDIS_PASSWORD=your_redis_password

# è¼‰å…¥ç’°å¢ƒè®Šæ•¸
source .env
```

#### Docker

```dockerfile
# Dockerfile
ENV SPRING_PROFILES_ACTIVE=prod
ENV LOG_LEVEL=INFO
```

#### Kubernetes

```yaml
# ConfigMap
apiVersion: v1
kind: ConfigMap
metadata:
  name: stock-analysis-config
data:
  LOG_LEVEL: "INFO"
  CACHE_TTL: "3600"
```

---

## 7. è³‡æ–™åº«é…ç½®

### 7.1 PostgreSQL é…ç½®å»ºè­°

**é–‹ç™¼ç’°å¢ƒ**:
```ini
# postgresql.conf
max_connections = 20
shared_buffers = 256MB
effective_cache_size = 1GB
work_mem = 4MB
```

**ç”Ÿç”¢ç’°å¢ƒ**:
```ini
# postgresql.conf
max_connections = 200
shared_buffers = 4GB
effective_cache_size = 12GB
work_mem = 16MB
maintenance_work_mem = 1GB
checkpoint_completion_target = 0.9
wal_buffers = 16MB
default_statistics_target = 100
random_page_cost = 1.1
effective_io_concurrency = 200
```

### 7.2 è³‡æ–™åº«åˆå§‹åŒ–è…³æœ¬

```sql
-- init-db.sql
-- å»ºç«‹ Schema
CREATE SCHEMA IF NOT EXISTS m06_data;
CREATE SCHEMA IF NOT EXISTS m07_technical;
CREATE SCHEMA IF NOT EXISTS m08_fundamental;

-- å»ºç«‹æ“´å……
CREATE EXTENSION IF NOT EXISTS "uuid-ossp";
CREATE EXTENSION IF NOT EXISTS "pg_trgm";

-- å»ºç«‹é€šç”¨å‡½æ•¸
CREATE OR REPLACE FUNCTION update_updated_at_column()
RETURNS TRIGGER AS $$
BEGIN
    NEW.updated_at = CURRENT_TIMESTAMP;
    RETURN NEW;
END;
$$ LANGUAGE plpgsql;
```

---

## 8. å¿«å–é…ç½®

### 8.1 Redis é…ç½®

**é–‹ç™¼ç’°å¢ƒ**:
```ini
# redis.conf
maxmemory 256mb
maxmemory-policy allkeys-lru
save 900 1
save 300 10
```

**ç”Ÿç”¢ç’°å¢ƒ**:
```ini
# redis.conf
maxmemory 8gb
maxmemory-policy allkeys-lru
save 900 1
save 300 10
save 60 10000
appendonly yes
appendfsync everysec
```

### 8.2 Redis Cluster é…ç½®

```bash
# å•Ÿå‹• Redis Cluster
redis-cli --cluster create \
  redis-1:6379 redis-2:6379 redis-3:6379 \
  redis-4:6379 redis-5:6379 redis-6:6379 \
  --cluster-replicas 1
```

---

## 9. è¨Šæ¯ä½‡åˆ—é…ç½®

### 9.1 RabbitMQ é…ç½®

```ini
# rabbitmq.conf
# ç”Ÿç”¢ç’°å¢ƒé…ç½®
vm_memory_high_watermark.relative = 0.6
disk_free_limit.absolute = 50GB
cluster_partition_handling = autoheal
```

### 9.2 RabbitMQ Exchanges å’Œ Queues

```java
// RabbitMQ é…ç½®é¡åˆ¥
@Configuration
public class RabbitMQConfig {
    
    @Bean
    public Exchange dataUpdateExchange() {
        return ExchangeBuilder
            .topicExchange("stock.data.update")
            .durable(true)
            .build();
    }
    
    @Bean
    public Queue stockPriceQueue() {
        return QueueBuilder
            .durable("stock.price.queue")
            .maxLength(10000L)
            .build();
    }
}
```

---

## 10. ç›£æ§èˆ‡æ—¥èªŒ

### 10.1 Prometheus é…ç½®

```yaml
# prometheus.yml
global:
  scrape_interval: 15s

scrape_configs:
  - job_name: 'stock-analysis-api'
    kubernetes_sd_configs:
      - role: pod
    relabel_configs:
      - source_labels: [__meta_kubernetes_pod_annotation_prometheus_io_scrape]
        action: keep
        regex: true
      - source_labels: [__meta_kubernetes_pod_annotation_prometheus_io_path]
        action: replace
        target_label: __metrics_path__
        regex: (.+)
```

### 10.2 Grafana Dashboard

```json
{
  "dashboard": {
    "title": "Stock Analysis System",
    "panels": [
      {
        "title": "API Request Rate",
        "targets": [
          {
            "expr": "rate(http_server_requests_seconds_count[5m])"
          }
        ]
      },
      {
        "title": "Database Connections",
        "targets": [
          {
            "expr": "hikaricp_connections_active"
          }
        ]
      }
    ]
  }
}
```

---

## ğŸ“š ç›¸é—œæ–‡æª”

- [ç³»çµ±æ¶æ§‹åœ–](../design/00-ç³»çµ±æ¶æ§‹åœ–.md)
- [M06 Jobæ’ç¨‹é…ç½®](./M06-Jobæ’ç¨‹é…ç½®.md)
- [M07 Jobæ’ç¨‹é…ç½®](./M07-Jobæ’ç¨‹é…ç½®.md)
- [NFRéåŠŸèƒ½æ€§éœ€æ±‚](../specs/technical/00-NFRéåŠŸèƒ½æ€§éœ€æ±‚.md)

---

**æ–‡ä»¶ç¶­è­·è€…**: DevOps åœ˜éšŠ  
**æœ€å¾Œæ›´æ–°**: 2025-12-31  
**ä¸‹æ¬¡å¯©æ ¸**: 2026-01-31
