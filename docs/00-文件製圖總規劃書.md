# 文件製圖總規劃書

> **文件編號**: DOC-MASTER-PLAN
> **文件名稱**: 文件製圖總規劃書
> **版本**: v1.0
> **最後更新**: 2026-01-12
> **狀態**: Active

---

## 📑 目錄

1. [文件架構總覽](#1-文件架構總覽)
2. [模組文件產製進度表](#2-模組文件產製進度表)
3. [模組依賴與產製順序](#3-模組依賴與產製順序)
4. [文件模板定義](#4-文件模板定義)
5. [AI 協作產製指南](#5-ai-協作產製指南)
6. [品質檢核清單](#6-品質檢核清單)

---

## 1. 文件架構總覽

### 1.1 每個模組需產製的 8 份文件

| 序號 | 文件類型 | 文件名稱格式 | 存放路徑 | 說明 |
|-----|---------|-------------|---------|------|
| 1 | 功能需求 | `M{XX}-{模組名稱}功能需求.md` | `docs/specs/functional/` | 功能清單、指標定義、輸入輸出 |
| 2 | API規格 | `M{XX}-API規格.md` | `docs/specs/api/` | REST API 端點、參數、回應格式 |
| 3 | 資料庫設計 | `M{XX}-資料庫設計.md` | `docs/design/` | 資料表 DDL、索引、MyBatis Mapper |
| 4 | ERD | `M{XX}-ERD.md` | `docs/design/erd/` | Mermaid 圖、實體關聯說明 |
| 5 | 業務流程 | `M{XX}-業務流程.md` | `docs/design/` | 流程圖、演算法、引擎架構 |
| 6 | Job排程配置 | `M{XX}-Job排程配置.md` | `docs/deployment/` | Job 清單、Cron、依賴關係 |
| 7 | 效能考量 | `M{XX}-效能考量.md` | `docs/design/` | 效能目標、快取策略、容量規劃 |
| 8 | 測試準則 | `M{XX}-測試準則.md` | `docs/design/` | 單元/整合/API 測試場景 |

### 1.2 文件目錄結構

```
docs/
├── 00-README-文件導航總覽.md
├── 00-文件製圖總規劃書.md          ← 本文件
│
├── specs/
│   ├── functional/                  ← 功能需求文件
│   │   ├── 00-模組清單與依賴關係.md
│   │   ├── M06-資料管理功能需求.md
│   │   ├── M07-技術分析功能需求.md
│   │   ├── M08-基本面分析功能需求.md
│   │   ├── M09-籌碼分析功能需求.md
│   │   └── ... (M10-M18)
│   │
│   ├── api/                         ← API 規格文件
│   │   ├── M06-API規格.md
│   │   ├── M07-API規格.md
│   │   ├── M08-API規格.md
│   │   ├── M09-API規格.md
│   │   └── ... (M10-M18)
│   │
│   └── technical/                   ← 技術規格（共用）
│       ├── 00-全系統契約.md
│       ├── 00-開發準則.md
│       └── 00-文件製作指南.md
│
├── design/
│   ├── M06-資料庫設計.md
│   ├── M06-業務流程.md
│   ├── M06-效能考量.md
│   ├── M06-測試準則.md
│   ├── ... (M07-M18)
│   │
│   └── erd/                         ← ERD 文件
│       ├── M06-ERD.md
│       ├── M07-ERD.md
│       └── ... (M08-M18)
│
└── deployment/
    ├── M06-Job排程配置.md
    ├── M09-Job排程配置.md
    └── ... (其他模組)
```

---

## 2. 模組文件產製進度表

### 2.1 進度總覽

| 模組 | 模組名稱 | Layer | 功能需求 | API規格 | 資料庫設計 | ERD | 業務流程 | Job排程 | 效能考量 | 測試準則 | 狀態 |
|-----|---------|-------|:------:|:------:|:--------:|:---:|:------:|:------:|:------:|:------:|------|
| M06 | 資料管理模組 | L1 | ✅ | ✅ | ✅ | ✅ | ✅ | ✅ | ✅ | ✅ | **完成** |
| M07 | 技術分析模組 | L2 | ✅ | ✅ | ✅ | ✅ | ✅ | ✅ | ✅ | ✅ | **完成** |
| M08 | 基本面分析模組 | L2 | ✅ | ✅ | ✅ | ✅ | ✅ | ✅ | ✅ | ✅ | **完成** |
| M09 | 籌碼分析模組 | L2 | ✅ | ✅ | ✅ | ✅ | ✅ | ✅ | ✅ | ✅ | **完成** |
| M10 | 技術型態辨識模組 | L3 | ⬜ | ⬜ | ⬜ | ⬜ | ⬜ | ⬜ | ⬜ | ⬜ | 待產製 |
| M11 | 量化策略模組 | L3 | ⬜ | ⬜ | ⬜ | ⬜ | ⬜ | ⬜ | ⬜ | ⬜ | 待產製 |
| M12 | 總經與產業分析模組 | L3 | ⬜ | ⬜ | ⬜ | ⬜ | ⬜ | ⬜ | ⬜ | ⬜ | 待產製 |
| M13 | 信號判斷引擎 | L4 | ⬜ | ⬜ | ⬜ | ⬜ | ⬜ | ⬜ | ⬜ | ⬜ | 待產製 |
| M14 | 選股引擎 | L5 | ⬜ | ⬜ | ⬜ | ⬜ | ⬜ | ⬜ | ⬜ | ⬜ | 待產製 |
| M15 | 警報通知系統 | L5 | ⬜ | ⬜ | ⬜ | ⬜ | ⬜ | ⬜ | ⬜ | ⬜ | 待產製 |
| M16 | 回測系統 | L5 | ⬜ | ⬜ | ⬜ | ⬜ | ⬜ | ⬜ | ⬜ | ⬜ | 待產製 |
| M17 | 風險管理模組 | L6 | ⬜ | ⬜ | ⬜ | ⬜ | ⬜ | ⬜ | ⬜ | ⬜ | 待產製 |
| M18 | 投資組合管理 | L6 | ⬜ | ⬜ | ⬜ | ⬜ | ⬜ | ⬜ | ⬜ | ⬜ | 待產製 |

### 2.2 統計

| 指標 | 數值 |
|-----|------|
| 總模組數 | 13 |
| 已完成模組 | 4 (M06-M09) |
| 待產製模組 | 9 (M10-M18) |
| 總文件數 | 104 (13 × 8) |
| 已完成文件 | 32 (4 × 8) |
| 完成率 | 30.8% |

---

## 3. 模組依賴與產製順序

### 3.1 建議產製順序

依據模組依賴關係與系統分層，建議按以下順序產製文件：

```
Phase 1: 已完成 ✅
─────────────────────────────────────────────────────
Layer 1: M06 資料管理模組 ✅
Layer 2: M07 技術分析 ✅ → M08 基本面分析 ✅ → M09 籌碼分析 ✅

Phase 2: 進階分析層（下一批）
─────────────────────────────────────────────────────
Layer 3: M10 技術型態辨識 → M11 量化策略 → M12 總經產業
         (依賴 M06, M07)   (依賴 M06-M09) (依賴 M06, M08)

Phase 3: 信號整合層
─────────────────────────────────────────────────────
Layer 4: M13 信號判斷引擎
         (依賴 M07-M12，需等 Phase 2 完成)

Phase 4: 應用層
─────────────────────────────────────────────────────
Layer 5: M14 選股引擎 → M15 警報通知 → M16 回測系統
         (依賴 M13)     (依賴 M13)     (依賴 M11, M13)

Phase 5: 管理層
─────────────────────────────────────────────────────
Layer 6: M17 風險管理 → M18 投資組合
         (依賴 M13, M17)
```

### 3.2 依賴關係圖（產製順序）

```
                    Phase 1 (已完成)
                    ================
                    ┌─────────┐
                    │   M06   │ ← 無依賴，最先產製
                    │資料管理  │
                    └────┬────┘
           ┌─────────────┼─────────────┐
           ↓             ↓             ↓
      ┌─────────┐  ┌─────────┐  ┌─────────┐
      │   M07   │  │   M08   │  │   M09   │ ← 可平行產製
      │技術分析  │  │基本面    │  │籌碼分析  │
      └────┬────┘  └────┬────┘  └────┬────┘
           │             │             │
           └─────────────┴─────────────┘
                         │
                    Phase 2 (下一批)
                    ================
           ┌─────────────┼─────────────┐
           ↓             ↓             ↓
      ┌─────────┐  ┌─────────┐  ┌─────────┐
      │   M10   │  │   M11   │  │   M12   │
      │型態辨識  │  │量化策略  │  │總經產業  │
      └────┬────┘  └────┬────┘  └────┬────┘
           │             │             │
           └─────────────┴─────────────┘
                         │
                    Phase 3
                    =======
                         ↓
                    ┌─────────┐
                    │   M13   │ ← 整合所有分析結果
                    │信號引擎  │
                    └────┬────┘
                         │
                    Phase 4
                    =======
           ┌─────────────┼─────────────┐
           ↓             ↓             ↓
      ┌─────────┐  ┌─────────┐  ┌─────────┐
      │   M14   │  │   M15   │  │   M16   │
      │選股引擎  │  │警報通知  │  │回測系統  │
      └─────────┘  └─────────┘  └────┬────┘
                                     │
                    Phase 5
                    =======
                         ↓
                    ┌─────────┐
                    │   M17   │
                    │風險管理  │
                    └────┬────┘
                         ↓
                    ┌─────────┐
                    │   M18   │
                    │投資組合  │
                    └─────────┘
```

---

## 4. 文件模板定義

### 4.1 功能需求文件模板

```markdown
# M{XX}-{模組名稱}功能需求

> **文件編號**: FUNC-M{XX}
> **模組名稱**: {模組名稱}
> **版本**: v1.0
> **最後更新**: {日期}
> **狀態**: Draft

---

## 1. 模組概述
### 1.1 模組定位
### 1.2 核心價值
### 1.3 模組依賴

## 2. 功能清單
### 2.1 功能總覽（表格：功能編號、名稱、優先級、說明）
### 2.2 P0 核心功能詳細需求
### 2.3 P1 進階功能詳細需求

## 3. 計算引擎架構（若適用）
### 3.1 引擎設計
### 3.2 計算器分類
### 3.3 計算計劃

## 4. 非功能性需求
### 4.1 效能需求
### 4.2 資料需求
### 4.3 快取策略

## 5. 錯誤碼定義

## 📚 相關文檔
```

### 4.2 API規格文件模板

```markdown
# M{XX}-{模組名稱} API 規格

> **文件編號**: API-M{XX}
> **版本**: v1.0

---

## 📋 API 總覽
### 基礎資訊（Base URL、認證方式）
### API 清單（表格：端點、方法、說明、優先級）

## 1. API 端點詳細規格
### 1.1 端點名稱
- 路徑參數
- 查詢參數
- 請求主體（若為 POST/PUT）
- 成功回應 (200)
- 錯誤回應

## 共用錯誤回應格式

## 📚 相關文檔
```

### 4.3 資料庫設計文件模板

```markdown
# M{XX}-{模組名稱}資料庫設計

> **文件編號**: DB-M{XX}
> **版本**: v1.0

---

## 1. 資料表清單

## 2. 資料表詳細設計
### 2.1 表名（含 DDL）
- 設計說明
- JSONB 結構範例（若有）
- 索引策略

## 3. MyBatis Mapper 設計（若有複雜查詢）

## 4. 資料關聯圖

## 📚 相關文檔
```

### 4.4 其他文件模板

詳見各模組已完成的文件範例：
- ERD: `docs/design/erd/M09-ERD.md`
- 業務流程: `docs/design/M09-業務流程.md`
- Job排程: `docs/deployment/M09-Job排程配置.md`
- 效能考量: `docs/design/M09-效能考量.md`
- 測試準則: `docs/design/M09-測試準則.md`

---

## 5. AI 協作產製指南

### 5.1 產製流程

```
┌─────────────────────────────────────────────────────────────────┐
│                    AI 協作文件產製流程                            │
└─────────────────────────────────────────────────────────────────┘

Step 1: 準備階段
───────────────────────────────────────────────────────────────────
  ↓ 提供 Claude 以下資訊：
  │
  │ ① 模組清單文件：docs/specs/functional/00-模組清單與依賴關係.md
  │ ② 已完成的參考模組（建議使用最近完成的模組）
  │ ③ 相關原始碼（若已有實作）
  │ ④ M07/M08 引擎程式碼（若為分析類模組）
  │
  ↓

Step 2: 啟動產製
───────────────────────────────────────────────────────────────────
  ↓ Prompt 範例：
  │
  │ "到我的 docs 研究共用文件及 M09 文件，
  │  我現在需要產生 M10 模組的文件。
  │  沒有原始文件，參考 M07/M08 模式設計。"
  │
  ↓

Step 3: AI 研究階段
───────────────────────────────────────────────────────────────────
  ↓ Claude 會：
  │
  │ ① 讀取模組清單，了解 M10 的定位與依賴
  │ ② 讀取參考模組文件（M09），了解文件結構
  │ ③ 讀取引擎程式碼，了解設計模式
  │ ④ 詢問確認問題（若有）
  │
  ↓

Step 4: 產製 8 份文件
───────────────────────────────────────────────────────────────────
  ↓ 依序產製：
  │
  │ 1. 功能需求 → 2. API規格 → 3. 資料庫設計 → 4. ERD
  │ 5. 業務流程 → 6. Job排程 → 7. 效能考量 → 8. 測試準則
  │
  ↓

Step 5: 審核與修正
───────────────────────────────────────────────────────────────────
  ↓ 人工審核：
  │
  │ ① 檢查功能是否符合需求
  │ ② 檢查 API 設計是否合理
  │ ③ 檢查資料表設計是否完整
  │ ④ 請 Claude 修正問題
  │
  ↓

Step 6: 更新進度表
───────────────────────────────────────────────────────────────────
  更新本文件的「模組文件產製進度表」
```

### 5.2 Prompt 範例

#### 產製新模組文件

```
到我的 docs 研究共用文件及 M{上一個模組} 文件，
我現在需要產生 M{目標模組} 模組的文件。
沒有原始文件，參考 M07/M08 模式設計，引擎我沒有寫進文件。
```

#### 補充特定文件

```
請幫我補充 M{XX} 的 {文件類型} 文件，
參考 M09 的 {文件類型} 格式。
```

#### 修正文件內容

```
M{XX} 的 {文件名稱} 有以下問題需要修正：
1. ...
2. ...
請幫我更新。
```

### 5.3 最佳實踐

| 實踐項目 | 說明 |
|---------|------|
| 依序產製 | 按依賴順序產製，確保參考資料完整 |
| 一次一模組 | 每次對話專注一個模組，避免混淆 |
| 即時審核 | 每份文件產製後立即審核，及早發現問題 |
| 保持一致 | 參考最近完成的模組，確保風格一致 |
| 善用中斷 | 若需補充資訊，隨時告知 Claude |

### 5.4 預估產製時間

| 模組複雜度 | 單模組 8 份文件 | 說明 |
|-----------|---------------|------|
| 簡單（如 M15 警報） | 30-45 分鐘 | 功能單純，少量 API |
| 中等（如 M10 型態） | 45-60 分鐘 | 有計算引擎，中等 API |
| 複雜（如 M13 信號） | 60-90 分鐘 | 依賴多模組，複雜整合 |

---

## 6. 品質檢核清單

### 6.1 文件完整性檢核

| 檢核項目 | 功能需求 | API規格 | 資料庫 | ERD | 業務流程 | Job排程 | 效能 | 測試 |
|---------|:------:|:------:|:-----:|:---:|:------:|:------:|:----:|:----:|
| 文件標頭完整 | ✓ | ✓ | ✓ | ✓ | ✓ | ✓ | ✓ | ✓ |
| 版本號正確 | ✓ | ✓ | ✓ | ✓ | ✓ | ✓ | ✓ | ✓ |
| 目錄結構清晰 | ✓ | ✓ | ✓ | - | ✓ | ✓ | ✓ | ✓ |
| 相關文檔連結 | ✓ | ✓ | ✓ | ✓ | ✓ | ✓ | ✓ | ✓ |

### 6.2 內容品質檢核

#### 功能需求文件
- [ ] 功能清單完整（含優先級 P0/P1/P2）
- [ ] 每個功能有輸入/輸出定義
- [ ] 指標計算公式明確
- [ ] 錯誤碼定義完整
- [ ] 依賴模組標示清楚

#### API規格文件
- [ ] 所有端點都有定義
- [ ] 參數說明完整（類型、必填、預設值）
- [ ] 成功回應範例正確
- [ ] 錯誤回應範例完整
- [ ] 符合系統 API 格式規範

#### 資料庫設計文件
- [ ] DDL 語法正確（PostgreSQL）
- [ ] 索引設計合理
- [ ] JSONB 結構有範例
- [ ] 唯一約束定義完整
- [ ] MyBatis Mapper 涵蓋複雜查詢

#### ERD文件
- [ ] Mermaid 圖可正確渲染
- [ ] 所有實體關聯正確
- [ ] 欄位說明完整

#### 業務流程文件
- [ ] 核心流程圖完整
- [ ] 引擎架構清晰（若有）
- [ ] 演算法說明詳細
- [ ] 快取策略定義

#### Job排程文件
- [ ] Job 清單完整
- [ ] Cron 表達式正確
- [ ] 依賴關係圖正確
- [ ] 失敗處理機制定義

#### 效能考量文件
- [ ] 效能目標明確（P95/P99）
- [ ] 快取策略完整
- [ ] 容量規劃合理
- [ ] 監控指標定義

#### 測試準則文件
- [ ] 單元測試場景完整
- [ ] 整合測試場景完整
- [ ] API 測試場景完整
- [ ] 測試覆蓋率目標明確

### 6.3 審核簽核

| 審核階段 | 審核人 | 審核日期 | 狀態 |
|---------|-------|---------|------|
| 初稿完成 | | | ⬜ |
| 技術審核 | | | ⬜ |
| 最終核准 | | | ⬜ |

---

## 📚 附錄

### A. 模組資訊速查表

| 模組 | 層級 | 持久層 | 主要依賴 | 引擎模式 |
|-----|------|-------|---------|---------|
| M06 | L1 | JPA + MyBatis | 無 | 無 |
| M07 | L2 | JPA + MyBatis | M06 | IndicatorEngine |
| M08 | L2 | MyBatis | M06 | FundamentalEngine |
| M09 | L2 | MyBatis | M06 | ChipEngine |
| M10 | L3 | JPA + MyBatis | M06, M07 | PatternEngine |
| M11 | L3 | MyBatis | M06-M09 | StrategyEngine |
| M12 | L3 | JPA | M06, M08 | 無 |
| M13 | L4 | JPA + MyBatis | M07-M12 | SignalEngine |
| M14 | L5 | MyBatis | M06-M09, M13 | 無 |
| M15 | L5 | JPA | M13 | 無 |
| M16 | L5 | MyBatis | M06, M07, M11, M13 | BacktestEngine |
| M17 | L6 | JPA + MyBatis | M06, M07, M13 | 無 |
| M18 | L6 | JPA + MyBatis | M06, M13, M17 | 無 |

### B. 文件版本歷史

| 版本 | 日期 | 修改內容 | 修改人 |
|-----|------|---------|-------|
| v1.0 | 2026-01-12 | 初版建立 | Claude |

---

**文件維護者**: 專案經理 / AI 協作
**最後更新**: 2026-01-12
**下次審核**: 每完成一個模組後更新進度表
