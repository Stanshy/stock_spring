# M07-技術分析模組測試準則

> **文件編號**: TEST-M07  
> **模組名稱**: 技術分析模組  
> **版本**: v2.0  
> **最後更新**: 2025-12-31  
> **狀態**: Draft

---

## 10. 測試準則

### 10.1 單元測試

**測試場景**:

**IndicatorCalculationService 測試**:
```
測試: 計算 MA 指標
Given: 台積電 250 個交易日股價資料
When: 呼叫 calculateMA(stockId="2330", periods=[5, 20, 60])
Then: 
  - 返回 MA5, MA20, MA60 值
  - MA5 值等於最近 5 日收盤價平均
  - 誤差 < 0.01%

測試: 資料不足處理
Given: 台積電只有 10 個交易日股價資料
When: 呼叫 calculateMA(stockId="2330", periods=[5, 20, 60])
Then:
  - MA5 有值（資料充足）
  - MA20 為 NaN（資料不足）
  - 不拋出異常
```

**SignalDetectionService 測試**:
```
測試: 黃金交叉偵測
Given: 
  - 昨日 MA5=98, MA20=100
  - 今日 MA5=101, MA20=100
When: 呼叫 detectCrossSignals(stockId="2330", date="2024-12-24")
Then:
  - 產生 BUY 信號
  - signal_name = 'MA_GOLDEN_CROSS'
  - confidence_score = 70
```

---

### 10.2 整合測試

**完整指標計算流程測試**:
```
測試: 端到端指標計算
Given: 
  - stock_prices 表有台積電最新 250 天股價資料
  - indicator_definitions 表有基礎指標定義
When: 
  - 觸發 JOB-M07-001（基礎指標計算）
Then:
  - Job 狀態變為 RUNNING
  - technical_indicators 表新增台積電指標記錄
  - Redis 快取被更新
  - Job 狀態變為 SUCCESS
```

---

### 10.3 效能測試

**負載測試**:
```
測試: API 並發查詢
場景: 100 個並發請求查詢不同股票的最新指標
預期:
  - P95 回應時間 < 150ms
  - 錯誤率 < 0.1%
  - 快取命中率 > 85%
```

---

### 10.4 測試覆蓋率目標

| 層級 | 覆蓋率目標 | 測試工具 |
|-----|----------|---------|
| Repository (JPA) | > 90% | JUnit 5, Spring Boot Test |
| Mapper (MyBatis) | > 85% | MyBatis Test |
| Service | > 80% | JUnit 5, Mockito |
| Controller | > 70% | MockMvc, RestAssured |
| 整體專案 | > 75% | JaCoCo |

---



---

## 📚 相關文檔

- [M07 功能需求](../specs/functional/M07-技術分析功能需求.md)
- [M07 API規格](../specs/technical/api/M07-API規格.md)
- [M07 業務流程](./M07-業務流程.md)
- [開發準則](../specs/technical/00-開發準則.md)

---

**文件維護者**: 測試工程師  
**最後更新**: 2025-12-31  
**下次審核**: 2026-02-28
