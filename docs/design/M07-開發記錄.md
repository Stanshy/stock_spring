# M07-技術分析模組開發記錄

> **文件編號**: DEV-M07
> **模組名稱**: 技術分析模組
> **版本**: v1.0
> **最後更新**: 2026-01-15
> **狀態**: Active

---

## 開發進度總覽

| 優先級 | 計畫數量 | 已完成 | 進度 |
|-------|---------|-------|------|
| P0 基礎組 | 5 | 5 | ✅ 100% |
| P1 進階組 | 18 | 18 | ✅ 100% |
| P2 專業組 | ~40 | 0 | ⏳ 0% |

---

## P0 基礎組（已完成）

### 完成日期
首次提交

### 計算器清單

| 類別 | 指標 | 檔案路徑 | 狀態 |
|------|------|----------|------|
| TREND | MA（簡單移動平均） | `calculator/trend/MACalculator.java` | ✅ |
| TREND | EMA（指數移動平均） | `calculator/trend/EMACalculator.java` | ✅ |
| TREND | MACD（平滑異同移動平均） | `calculator/trend/MACDCalculator.java` | ✅ |
| MOMENTUM | RSI（相對強弱指標） | `calculator/momentum/RSICalculator.java` | ✅ |
| VOLATILITY | BBands（布林通道） | `calculator/volatility/BBandsCalculator.java` | ✅ |

### 測試覆蓋

| 測試類別 | 檔案路徑 |
|---------|----------|
| MACalculatorTest | `test/.../trend/MACalculatorTest.java` |
| EMACalculatorTest | `test/.../trend/EMACalculatorTest.java` |
| MACDCalculatorTest | `test/.../trend/MACDCalculatorTest.java` |
| RSICalculatorTest | `test/.../momentum/RSICalculatorTest.java` |
| BBandsCalculatorTest | `test/.../volatility/BBandsCalculatorTest.java` |

---

## P1 進階組（已完成）

### 完成日期
2026-01-15

### 計算器清單

#### 趨勢類（5 個）

| 指標 | 中文名稱 | 檔案路徑 | 狀態 | 備註 |
|------|---------|----------|------|------|
| WMA | 加權移動平均 | `calculator/trend/WMACalculator.java` | ✅ | |
| HMA | Hull 移動平均 | `calculator/trend/HMACalculator.java` | ⚠️ | TODO: sqrt(n) 取整方式待確認 |
| AROON | 阿隆指標 | `calculator/trend/AroonCalculator.java` | ✅ | |
| SAR | 拋物線停損轉向 | `calculator/trend/ParabolicSARCalculator.java` | ⚠️ | TODO: 初始化方式待確認 |
| SUPERTREND | 超級趨勢 | `calculator/trend/SupertrendCalculator.java` | ⚠️ | TODO: ATR 參數組合待確認 |

#### 動能類（6 個）

| 指標 | 中文名稱 | 檔案路徑 | 狀態 | 備註 |
|------|---------|----------|------|------|
| ROC | 變動率 | `calculator/momentum/ROCCalculator.java` | ✅ | |
| MOM | 動量指標 | `calculator/momentum/MomentumCalculator.java` | ✅ | |
| WILLR | 威廉指標 | `calculator/momentum/WilliamsRCalculator.java` | ✅ | |
| CCI | 順勢指標 | `calculator/momentum/CCICalculator.java` | ✅ | |
| MFI | 資金流量指標 | `calculator/momentum/MFICalculator.java` | ⚠️ | TODO: TP 相等時處理方式 |
| STOCHRSI | 隨機相對強弱 | `calculator/momentum/StochRSICalculator.java` | ⚠️ | TODO: 參數組合待確認 |

#### 波動類（2 個）

| 指標 | 中文名稱 | 檔案路徑 | 狀態 | 備註 |
|------|---------|----------|------|------|
| DONCHIAN | 唐奇安通道 | `calculator/volatility/DonchianChannelCalculator.java` | ✅ | |
| KELTNER | 肯特納通道 | `calculator/volatility/KeltnerChannelCalculator.java` | ⚠️ | TODO: EMA+ATR vs SMA 版本 |

#### 成交量類（2 個）

| 指標 | 中文名稱 | 檔案路徑 | 狀態 | 備註 |
|------|---------|----------|------|------|
| AD | 累積/派發線 | `calculator/volume/ADLineCalculator.java` | ✅ | |
| CMF | 蔡金資金流量 | `calculator/volume/CMFCalculator.java` | ✅ | |

#### 支撐壓力類（2 個）

| 指標 | 中文名稱 | 檔案路徑 | 狀態 | 備註 |
|------|---------|----------|------|------|
| PIVOT | 樞軸點 | `calculator/support/PivotPointsCalculator.java` | ✅ | 支援 Standard/Fibonacci/Woodie/Camarilla |
| FIBRETRACEMENT | 斐波那契回調 | `calculator/support/FibonacciRetracementCalculator.java` | ⚠️ | TODO: 波段偵測方式 |

#### 統計類（1 個）

| 指標 | 中文名稱 | 檔案路徑 | 狀態 | 備註 |
|------|---------|----------|------|------|
| LINREG | 線性回歸 | `calculator/statistics/LinearRegressionCalculator.java` | ✅ | 包含 Slope, R² |

### 測試覆蓋

| 測試類別 | 檔案路徑 | 測試項目數 |
|---------|----------|-----------|
| WMACalculatorTest | `test/.../trend/WMACalculatorTest.java` | 2 |
| AroonCalculatorTest | `test/.../trend/AroonCalculatorTest.java` | 2 |
| ROCCalculatorTest | `test/.../momentum/ROCCalculatorTest.java` | 3 |
| WilliamsRCalculatorTest | `test/.../momentum/WilliamsRCalculatorTest.java` | 3 |
| CCICalculatorTest | `test/.../momentum/CCICalculatorTest.java` | 3 |
| DonchianChannelCalculatorTest | `test/.../volatility/DonchianChannelCalculatorTest.java` | 3 |
| CMFCalculatorTest | `test/.../volume/CMFCalculatorTest.java` | 3 |
| PivotPointsCalculatorTest | `test/.../support/PivotPointsCalculatorTest.java` | 3 |
| LinearRegressionCalculatorTest | `test/.../statistics/LinearRegressionCalculatorTest.java` | 4 |

### 新增目錄結構

```
src/main/java/com/chris/fin_shark/m07/engine/calculator/
├── trend/
│   ├── MACalculator.java          (P0)
│   ├── EMACalculator.java         (P0)
│   ├── MACDCalculator.java        (P0)
│   ├── WMACalculator.java         (P1) ✨ NEW
│   ├── HMACalculator.java         (P1) ✨ NEW
│   ├── AroonCalculator.java       (P1) ✨ NEW
│   ├── ParabolicSARCalculator.java (P1) ✨ NEW
│   └── SupertrendCalculator.java  (P1) ✨ NEW
├── momentum/
│   ├── RSICalculator.java         (P0)
│   ├── ROCCalculator.java         (P1) ✨ NEW
│   ├── MomentumCalculator.java    (P1) ✨ NEW
│   ├── WilliamsRCalculator.java   (P1) ✨ NEW
│   ├── CCICalculator.java         (P1) ✨ NEW
│   ├── MFICalculator.java         (P1) ✨ NEW
│   └── StochRSICalculator.java    (P1) ✨ NEW
├── volatility/
│   ├── BBandsCalculator.java      (P0)
│   ├── DonchianChannelCalculator.java (P1) ✨ NEW
│   └── KeltnerChannelCalculator.java  (P1) ✨ NEW
├── volume/                         ✨ NEW DIRECTORY
│   ├── ADLineCalculator.java      (P1) ✨ NEW
│   └── CMFCalculator.java         (P1) ✨ NEW
├── support/                        ✨ NEW DIRECTORY
│   ├── PivotPointsCalculator.java (P1) ✨ NEW
│   └── FibonacciRetracementCalculator.java (P1) ✨ NEW
└── statistics/                     ✨ NEW DIRECTORY
    └── LinearRegressionCalculator.java (P1) ✨ NEW
```

---

## 待確認項目（TODO）

以下指標的實作有待確認的細節，已在程式碼中標註 TODO 註解：

| 指標 | 待確認事項 | 優先級 |
|------|-----------|-------|
| HMA | `sqrt(n)` 取整方式、rawHMA 計算範圍 | 中 |
| Parabolic SAR | 初始化方式、SAR 不超過前兩天價格的規則 | 中 |
| Supertrend | ATR 週期/乘數組合（10,3 或 7,3 或 14,2） | 低 |
| MFI | TP 相等時的處理方式（忽略或歸入上一方向） | 低 |
| Stochastic RSI | 參數組合 (14,14,3,3)、輸出格式 0-1 或 0-100 | 低 |
| Keltner Channel | 使用 EMA+ATR（現代版）或 SMA+典型價格範圍（原始版） | 低 |
| Fibonacci Retracement | 自動偵測波段 vs 固定期間 | 中 |

---

## P2 專業組（待開發）

根據 `M07-技術分析功能需求.md`，P2 專業組約 40 個指標，包括：

- DEMA, TEMA, VWMA, ZLEMA
- Ultimate Oscillator, CMO, TSI, KST
- Standard Deviation, Historical Volatility, Mass Index, Chaikin Volatility
- EMV, Force Index, NVI, PVI, PVT
- Fibonacci Extension, Support/Resistance Levels, Price Channels
- Hurst Exponent, DPO, Schaff Trend Cycle
- Correlation Coefficient, Z-Score
- Elder Ray, Coppock Curve, Qstick, Vortex, Balance of Power
- Ichimoku Cloud, TRIX

**計畫**：按需開發

---

## 變更歷史

| 日期 | 版本 | 變更內容 | 作者 |
|------|------|---------|------|
| 2026-01-15 | v1.0 | 初版：P0 + P1 開發記錄 | backend-architect |

---

## 相關文檔

- [M07 功能需求](../specs/functional/M07-技術分析功能需求.md)
- [M07 API 規格](../specs/api/M07-API規格.md)
- [M07 測試準則](./M07-測試準則.md)
- [M07 資料庫設計](./M07-資料庫設計.md)
