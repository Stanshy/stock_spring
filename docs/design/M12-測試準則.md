# M12-ç¸½ç¶“èˆ‡ç”¢æ¥­åˆ†ææ¨¡çµ„æ¸¬è©¦æº–å‰‡

> **æ–‡ä»¶ç·¨è™Ÿ**: TEST-M12
> **æ¨¡çµ„åç¨±**: ç¸½ç¶“èˆ‡ç”¢æ¥­åˆ†ææ¨¡çµ„
> **ç‰ˆæœ¬**: v1.0
> **æœ€å¾Œæ›´æ–°**: 2026-01-14
> **ç‹€æ…‹**: Draft

---

## 1. æ¸¬è©¦ç¸½è¦½

æœ¬æ–‡ä»¶å®šç¾©ç¸½ç¶“èˆ‡ç”¢æ¥­åˆ†ææ¨¡çµ„çš„æ¸¬è©¦ç­–ç•¥ã€æ¸¬è©¦å ´æ™¯èˆ‡æ¸¬è©¦æº–å‰‡ã€‚

**æ¸¬è©¦é‡é»**:
- ç”¢æ¥­ç¸¾æ•ˆè¨ˆç®—æ­£ç¢ºæ€§
- ç”¢æ¥­ä¼°å€¼è¨ˆç®—æ­£ç¢ºæ€§
- ç¶“æ¿Ÿé€±æœŸåˆ¤æ–·é‚è¼¯
- ç”¢æ¥­è¼ªå‹•åˆ†æé‚è¼¯
- M13 ä¿¡è™Ÿæ•´åˆ

---

## 2. å–®å…ƒæ¸¬è©¦

### 2.1 ç”¢æ¥­ç¸¾æ•ˆè¨ˆç®—å™¨æ¸¬è©¦

**æ¸¬è©¦ç›®æ¨™**: é©—è­‰ç”¢æ¥­ç¸¾æ•ˆè¨ˆç®—é‚è¼¯æ­£ç¢ºæ€§

**æ¸¬è©¦å ´æ™¯**:

#### å ±é…¬ç‡è¨ˆç®—æ¸¬è©¦

```
æ¸¬è©¦: PerformanceCalculator.calculateReturn1d() - å¸‚å€¼åŠ æ¬Šå ±é…¬
Given:
  - ç”¢æ¥­æˆåˆ†è‚¡:
    - è‚¡ç¥¨ A: å¸‚å€¼ 1000 å„„, æ—¥å ±é…¬ 2%
    - è‚¡ç¥¨ B: å¸‚å€¼ 500 å„„, æ—¥å ±é…¬ -1%
    - è‚¡ç¥¨ C: å¸‚å€¼ 300 å„„, æ—¥å ±é…¬ 3%
When: åŸ·è¡Œ calculateReturn1d()
Then:
  - åŠ æ¬Šå ±é…¬ = (2% Ã— 1000 + -1% Ã— 500 + 3% Ã— 300) / 1800
  - = (20 - 5 + 9) / 1800 = 1.33%
  - ç²¾ç¢ºåˆ°å°æ•¸é»å¾Œ 4 ä½

æ¸¬è©¦: PerformanceCalculator.calculateReturn5d() - ç´¯ç©å ±é…¬
Given: éå» 5 å€‹äº¤æ˜“æ—¥æ¯æ—¥å ±é…¬ [1%, 0.5%, -0.3%, 0.8%, 0.2%]
When: åŸ·è¡Œ calculateReturn5d()
Then:
  - ç´¯ç©å ±é…¬ = (1+0.01)(1+0.005)(1-0.003)(1+0.008)(1+0.002) - 1
  - â‰ˆ 2.21%

æ¸¬è©¦: PerformanceCalculator.calculateReturnYtd() - å¹´åˆè‡³ä»Š
Given:
  - å¹´åˆæŒ‡æ•¸å€¼: 100
  - ç•¶å‰æŒ‡æ•¸å€¼: 115
When: åŸ·è¡Œ calculateReturnYtd()
Then:
  - YTD å ±é…¬ = (115 - 100) / 100 = 15%
```

#### å‹•èƒ½æŒ‡æ¨™æ¸¬è©¦

```
æ¸¬è©¦: PerformanceCalculator.calculateMomentum20d()
Given:
  - 20 æ—¥å ±é…¬ç‡: 8%
  - 20 æ—¥æ³¢å‹•ç‡ (å¹´åŒ–): 20%
When: åŸ·è¡Œ calculateMomentum20d()
Then:
  - å‹•èƒ½ = 8% / (20% Ã— âˆš(20/252))
  - â‰ˆ 1.42

æ¸¬è©¦: PerformanceCalculator.calculateRelativeStrength()
Given:
  - ç”¢æ¥­ 20 æ—¥å ±é…¬: 12%
  - å¤§ç›¤ 20 æ—¥å ±é…¬: 8%
When: åŸ·è¡Œ calculateRelativeStrength()
Then:
  - ç›¸å°å¼·åº¦ = 12% - 8% = 4%
```

#### å¸‚å ´å»£åº¦æ¸¬è©¦

```
æ¸¬è©¦: PerformanceCalculator.calculateBreadth()
Given:
  - ç”¢æ¥­æˆåˆ†è‚¡ 50 æª”
  - ä¸Šæ¼² 35 æª”, ä¸‹è·Œ 12 æª”, å¹³ç›¤ 3 æª”
When: åŸ·è¡Œ calculateBreadth()
Then:
  - å»£åº¦ = 35 / 50 Ã— 100 = 70%

æ¸¬è©¦: PerformanceCalculator.calculateBreadth() - å…¨ä¸‹è·Œ
Given:
  - ç”¢æ¥­æˆåˆ†è‚¡ 30 æª”
  - ä¸Šæ¼² 0 æª”, ä¸‹è·Œ 30 æª”
When: åŸ·è¡Œ calculateBreadth()
Then:
  - å»£åº¦ = 0%
```

---

### 2.2 ç”¢æ¥­ä¼°å€¼è¨ˆç®—å™¨æ¸¬è©¦

**æ¸¬è©¦ç›®æ¨™**: é©—è­‰ç”¢æ¥­ä¼°å€¼è¨ˆç®—é‚è¼¯æ­£ç¢ºæ€§

```
æ¸¬è©¦: ValuationCalculator.calculateSectorPE() - å¸‚å€¼åŠ æ¬Š PE
Given:
  - è‚¡ç¥¨ A: å¸‚å€¼ 1000 å„„, PE 25
  - è‚¡ç¥¨ B: å¸‚å€¼ 500 å„„, PE 15
  - è‚¡ç¥¨ C: å¸‚å€¼ 300 å„„, PE 20 (è™§æè‚¡ç¥¨æ’é™¤)
  - è‚¡ç¥¨ D: å¸‚å€¼ 200 å„„, PE NULL (è™§æ)
When: åŸ·è¡Œ calculateSectorPE()
Then:
  - åŠ æ¬Š PE = (25Ã—1000 + 15Ã—500 + 20Ã—300) / (1000+500+300)
  - = (25000 + 7500 + 6000) / 1800 = 21.39
  - è™§æè‚¡ç¥¨ä¸ç´å…¥è¨ˆç®—

æ¸¬è©¦: ValuationCalculator.calculatePEPercentile()
Given:
  - ç•¶å‰ PE: 20
  - éå» 5 å¹´ PE æ­·å²: [15, 18, 22, 25, 30, 16, 19, 21, 24, 28, ...]
  - å…± 60 å€‹æœˆè³‡æ–™
When: åŸ·è¡Œ calculatePEPercentile()
Then:
  - ç™¾åˆ†ä½ = PE=20 åœ¨æ­·å²ä¸­çš„æ’åä½ç½®
  - è‹¥æœ‰ 24 ç­† < 20, å‰‡ç™¾åˆ†ä½ = 24/60 Ã— 100 = 40%

æ¸¬è©¦: ValuationCalculator.determineValuationSignal()
Given: PE ç™¾åˆ†ä½ = 15%
When: åŸ·è¡Œ determineValuationSignal()
Then:
  - è¿”å› "UNDERVALUED" (< 20% é–€æª»)

Given: PE ç™¾åˆ†ä½ = 85%
When: åŸ·è¡Œ determineValuationSignal()
Then:
  - è¿”å› "OVERVALUED" (> 80% é–€æª»)

Given: PE ç™¾åˆ†ä½ = 50%
When: åŸ·è¡Œ determineValuationSignal()
Then:
  - è¿”å› "FAIR"
```

---

### 2.3 ç¶“æ¿Ÿé€±æœŸåˆ¤æ–·æ¸¬è©¦

**æ¸¬è©¦ç›®æ¨™**: é©—è­‰ç¶“æ¿Ÿé€±æœŸåˆ¤æ–·é‚è¼¯æ­£ç¢ºæ€§

```
æ¸¬è©¦: CycleDeterminator.determineCycleStage() - å¾©ç”¦æœŸ
Given:
  - é ˜å…ˆæŒ‡æ¨™è¶¨å‹¢: UP (é€£çºŒ 3 å€‹æœˆä¸Šå‡)
  - åŒæ™‚æŒ‡æ¨™ä½ç½®: LOW (æ­·å² 20% åˆ†ä½)
When: åŸ·è¡Œ determineCycleStage()
Then:
  - è¿”å› RECOVERY
  - ä¿¡å¿ƒåº¦ > 0.7

æ¸¬è©¦: CycleDeterminator.determineCycleStage() - æ“´å¼µæœŸ
Given:
  - é ˜å…ˆæŒ‡æ¨™è¶¨å‹¢: UP
  - åŒæ™‚æŒ‡æ¨™ä½ç½®: MID (æ­·å² 50% åˆ†ä½)
When: åŸ·è¡Œ determineCycleStage()
Then:
  - è¿”å› EXPANSION

æ¸¬è©¦: CycleDeterminator.determineCycleStage() - éç†±æœŸ
Given:
  - é ˜å…ˆæŒ‡æ¨™è¶¨å‹¢: DOWN (é€£çºŒ 2 å€‹æœˆä¸‹é™)
  - åŒæ™‚æŒ‡æ¨™ä½ç½®: HIGH (æ­·å² 85% åˆ†ä½)
When: åŸ·è¡Œ determineCycleStage()
Then:
  - è¿”å› OVERHEATING

æ¸¬è©¦: CycleDeterminator.determineCycleStage() - è¡°é€€æœŸ
Given:
  - é ˜å…ˆæŒ‡æ¨™è¶¨å‹¢: DOWN
  - åŒæ™‚æŒ‡æ¨™ä½ç½®: MID
When: åŸ·è¡Œ determineCycleStage()
Then:
  - è¿”å› RECESSION

æ¸¬è©¦: CycleDeterminator.determineCycleStage() - ä¸ç¢ºå®š
Given:
  - é ˜å…ˆæŒ‡æ¨™è¶¨å‹¢: FLAT (è®Šå‹• < 1%)
  - åŒæ™‚æŒ‡æ¨™ä½ç½®: MID
When: åŸ·è¡Œ determineCycleStage()
Then:
  - è¿”å› UNCERTAIN
  - ä¿¡å¿ƒåº¦ < 0.6
```

---

### 2.4 ç”¢æ¥­è¼ªå‹•åˆ†ææ¸¬è©¦

**æ¸¬è©¦ç›®æ¨™**: é©—è­‰ç”¢æ¥­è¼ªå‹•åˆ†æé‚è¼¯æ­£ç¢ºæ€§

```
æ¸¬è©¦: RotationAnalyzer.analyzeRotation() - è­˜åˆ¥é ˜æ¼²ç”¢æ¥­
Given:
  - éå» 12 é€±æ’å:
    - åŠå°é«”: [2, 1, 2, 3, 2, 1, 2, 2, 3, 2, 1, 2]
    - é‡‘è: [15, 14, 16, 15, 13, 14, 15, 16, 14, 15, 13, 14]
  - å…± 30 å€‹ç”¢æ¥­
When: åŸ·è¡Œ analyzeRotation()
Then:
  - åŠå°é«” status = LEADING (å¹³å‡æ’å < 6)
  - åŠå°é«” weeksInTop = 12 (å…¨éƒ¨åœ¨å‰ 1/3)

æ¸¬è©¦: RotationAnalyzer.analyzeRotation() - è­˜åˆ¥è½‰å¼·ç”¢æ¥­
Given:
  - éå» 12 é€±æ’å:
    - èˆªé‹: [5, 7, 9, 12, 15, 18, 20, 22, 23, 24, 25, 26]
    - (æ’åå¾ 26 ä¸Šå‡åˆ° 5)
When: åŸ·è¡Œ analyzeRotation()
Then:
  - èˆªé‹ status = IMPROVING
  - èˆªé‹ rankChange = 21 (æ­£å€¼è¡¨ç¤ºæ’åå¤§å¹…ä¸Šå‡)
  - ç”¢ç”Ÿ IND_SIG_001 ä¿¡è™Ÿ

æ¸¬è©¦: RotationAnalyzer.analyzeRotation() - è­˜åˆ¥è½‰å¼±ç”¢æ¥­
Given:
  - éå» 12 é€±æ’å:
    - æ°´æ³¥: [20, 18, 15, 12, 10, 8, 6, 5, 4, 3, 2, 1]
    - (æ’åå¾ 1 ä¸‹é™åˆ° 20)
When: åŸ·è¡Œ analyzeRotation()
Then:
  - æ°´æ³¥ status = WEAKENING
  - ç”¢ç”Ÿ IND_SIG_002 ä¿¡è™Ÿ

æ¸¬è©¦: RotationAnalyzer.generateRotationSignals() - æ–°èˆˆé ˜æ¼²
Given:
  - ç”¢æ¥­é€£çºŒ 3 é€±æ’åä¸Šå‡
  - ç•¶å‰æ’åé€²å…¥å‰ 20%
When: åŸ·è¡Œ generateRotationSignals()
Then:
  - ç”¢ç”Ÿ IND_SIG_003 ä¿¡è™Ÿ (æ–°èˆˆé ˜æ¼²ç”¢æ¥­)
  - ä¿¡è™Ÿ confidence_score > 0.75
```

---

### 2.5 Service å±¤æ¸¬è©¦

**æ¸¬è©¦ç›®æ¨™**: é©—è­‰æ¥­å‹™é‚è¼¯æ­£ç¢ºæ€§

```
æ¸¬è©¦: SectorPerformanceService.getAllPerformance() - å¿«å–å‘½ä¸­
Given: Redis å¿«å–ä¸­æœ‰ç•¶æ—¥æ‰€æœ‰ç”¢æ¥­ç¸¾æ•ˆè³‡æ–™
When: å‘¼å« getAllPerformance(tradeDate)
Then:
  - ç›´æ¥è¿”å›å¿«å–çµæœ
  - ä¸æŸ¥è©¢è³‡æ–™åº«

æ¸¬è©¦: SectorPerformanceService.getAllPerformance() - å¿«å–æœªå‘½ä¸­
Given: Redis å¿«å–ä¸­ç„¡è³‡æ–™ï¼Œè³‡æ–™åº«æœ‰è³‡æ–™
When: å‘¼å« getAllPerformance(tradeDate)
Then:
  - å¾è³‡æ–™åº«å–å¾—çµæœ
  - çµæœå¯«å…¥ Redis å¿«å–
  - è¿”å›æ­£ç¢ºè³‡æ–™

æ¸¬è©¦: IndustrySignalService.getUnconsumedSignals()
Given: industry_signals è¡¨æœ‰ 10 ç­† is_consumed = false
When: å‘¼å« getUnconsumedSignals(tradeDate)
Then:
  - è¿”å› 10 ç­†ä¿¡è™Ÿ
  - ä¾› M13 æ¶ˆè²»

æ¸¬è©¦: IndustrySignalService.markAsConsumed()
Given: M13 æ¶ˆè²» 5 ç­†ä¿¡è™Ÿ
When: å‘¼å« markAsConsumed(signalIds)
Then:
  - 5 ç­†ä¿¡è™Ÿ is_consumed = true
  - consumed_at å·²æ›´æ–°
  - consumed_by = "M13"
```

**Mock ç­–ç•¥**:
- Mock M06 StockPriceRepositoryï¼ˆå–®å…ƒæ¸¬è©¦ï¼‰
- Mock M08 FundamentalRepositoryï¼ˆå–®å…ƒæ¸¬è©¦ï¼‰
- ä½¿ç”¨çœŸå¯¦ PostgreSQL/Redisï¼ˆæ•´åˆæ¸¬è©¦ï¼ŒTestcontainersï¼‰

---

## 3. æ•´åˆæ¸¬è©¦

### 3.1 è³‡æ–™åº«æ•´åˆæ¸¬è©¦

**æ¸¬è©¦ç’°å¢ƒ**: ä½¿ç”¨ Testcontainers å•Ÿå‹• PostgreSQL å®¹å™¨

```
æ¸¬è©¦: SectorPerformanceRepository.saveAll()
Given: æº–å‚™ 30 ç­†ç”¢æ¥­ç¸¾æ•ˆè³‡æ–™
When: åŸ·è¡Œæ‰¹æ¬¡å„²å­˜
Then:
  - åŸ·è¡Œæ™‚é–“ < 500ms
  - æ‰€æœ‰è³‡æ–™æ­£ç¢ºå„²å­˜
  - (sector_code, trade_date) å”¯ä¸€ç´„æŸç”Ÿæ•ˆ

æ¸¬è©¦: SectorPerformanceRepository.findByTradeDateOrderByReturnRank()
Given: sector_performance è¡¨æœ‰ç•¶æ—¥ 30 ç­†è³‡æ–™
When: æŸ¥è©¢æ’è¡Œæ¦œï¼ˆå‰ 10 åï¼‰
Then:
  - æŸ¥è©¢æ™‚é–“ < 50ms
  - çµæœæ­£ç¢ºæ’åº
  - è¿”å› 10 ç­†

æ¸¬è©¦: MacroIndicatorValueRepository.findHistoryByIndicatorCode()
Given: macro_indicator_values æœ‰ 5 å¹´æ­·å²è³‡æ–™
When: æŸ¥è©¢ TW_LEADING_INDEX æœ€è¿‘ 6 å€‹æœˆ
Then:
  - æŸ¥è©¢æ™‚é–“ < 30ms
  - çµæœæŒ‰æ—¥æœŸé™åº
```

---

### 3.2 å¿«å–æ•´åˆæ¸¬è©¦

**æ¸¬è©¦ç’°å¢ƒ**: ä½¿ç”¨ Testcontainers å•Ÿå‹• Redis å®¹å™¨

```
æ¸¬è©¦: ç”¢æ¥­ç¸¾æ•ˆå¿«å–å¯«å…¥èˆ‡è®€å–
Given: è¨ˆç®—å®Œæˆçš„ 30 ç­†ç”¢æ¥­ç¸¾æ•ˆ
When: å¯«å…¥ Redis å¿«å–å¾Œè®€å–
Then:
  - è³‡æ–™æ­£ç¢ºåºåˆ—åŒ–/ååºåˆ—åŒ–
  - TTL è¨­å®šæ­£ç¢ºï¼ˆ6 å°æ™‚ï¼‰

æ¸¬è©¦: æ’è¡Œæ¦œå¿«å–å¤±æ•ˆ
Given: æ–°çš„æ¯æ—¥è¨ˆç®—å®Œæˆ
When: è§¸ç™¼å¿«å–åˆ·æ–°
Then:
  - èˆŠå¿«å–è¢«æ¸…é™¤
  - æ–°è³‡æ–™è¢«å¿«å–

æ¸¬è©¦: å¿«å–ç©¿é€é˜²è­·
Given: æŸ¥è©¢ä¸å­˜åœ¨çš„ç”¢æ¥­ä»£ç¢¼ "XX"
When: é€£çºŒæŸ¥è©¢ 10 æ¬¡
Then:
  - ç¬¬ä¸€æ¬¡æŸ¥è©¢è³‡æ–™åº«
  - å¾ŒçºŒæŸ¥è©¢å‘½ä¸­ç©ºå€¼å¿«å–
```

---

### 3.3 M06/M08 ä¾è³´æ•´åˆæ¸¬è©¦

```
æ¸¬è©¦: å¾ M06 å–å¾—è‚¡åƒ¹è³‡æ–™
Given: stock_prices è¡¨æœ‰ç•¶æ—¥è³‡æ–™
When: å‘¼å« loadStockPrices(tradeDate)
Then:
  - æ­£ç¢ºè¼‰å…¥æ‰€æœ‰è‚¡ç¥¨ç•¶æ—¥æ”¶ç›¤åƒ¹
  - æ­£ç¢ºè¼‰å…¥å¸‚å€¼
  - æ­£ç¢ºè¼‰å…¥æ¼²è·Œå¹…

æ¸¬è©¦: å¾ M08 å–å¾—ä¼°å€¼æŒ‡æ¨™
Given: fundamental_indicators è¡¨æœ‰ PE, PB è³‡æ–™
When: å‘¼å« loadValuationMetrics(tradeDate)
Then:
  - æ­£ç¢ºè¼‰å…¥å„è‚¡ PE, PB
  - è™§æè‚¡ç¥¨ PE = NULL è™•ç†æ­£ç¢º

æ¸¬è©¦: ä¸Šæ¸¸è³‡æ–™å»¶é²è™•ç†
Given: M06 ç•¶æ—¥è³‡æ–™å°šæœªæ›´æ–°
When: åŸ·è¡Œç”¢æ¥­ç¸¾æ•ˆè¨ˆç®—
Then:
  - ç­‰å¾…ä¸¦é‡è©¦
  - è¶…é 3 æ¬¡é‡è©¦å¾Œè¨˜éŒ„éŒ¯èª¤
  - ä½¿ç”¨å‰ä¸€æ—¥è³‡æ–™ä½œç‚ºå‚™æ´
```

---

### 3.4 M13 æ•´åˆæ¸¬è©¦

```
æ¸¬è©¦: M13 æ¶ˆè²»ç”¢æ¥­ä¿¡è™Ÿ
Given: ç•¶æ—¥ industry_signals æœ‰ 5 ç­† is_consumed = false
When: M13 å‘¼å« GET /macro-industry/industry/signals/unconsumed
Then:
  - è¿”å› 5 ç­†ä¿¡è™Ÿ
  - åŒ…å«ä¿¡è™Ÿé¡å‹ã€ç›®æ¨™ã€ä¿¡å¿ƒåˆ†æ•¸

æ¸¬è©¦: M13 æ¨™è¨˜ä¿¡è™Ÿå·²æ¶ˆè²»
Given: M13 è™•ç†å®Œ 5 ç­†ä¿¡è™Ÿ
When: M13 å‘¼å« POST /macro-industry/industry/signals/consumed
Then:
  - 5 ç­†ä¿¡è™Ÿ is_consumed = true
  - è¿”å›æˆåŠŸç­†æ•¸

æ¸¬è©¦: äº‹ä»¶é€šçŸ¥ M13
Given: JOB-M12-007 åŸ·è¡Œå®Œæˆ
When: ç™¼é€ INDUSTRY_SIGNALS_READY äº‹ä»¶
Then:
  - äº‹ä»¶æ ¼å¼æ­£ç¢º
  - M13 å¯æ­£ç¢ºæ¥æ”¶ä¸¦è§¸ç™¼æ¶ˆè²»
```

---

## 4. API æ¸¬è©¦

**æ¸¬è©¦å·¥å…·**: MockMvc æˆ– RestAssured

### 4.1 æˆåŠŸå ´æ™¯

```
æ¸¬è©¦: GET /macro-industry/industry/performance
Given: ç•¶æ—¥æœ‰ç”¢æ¥­ç¸¾æ•ˆè³‡æ–™
When: GET /macro-industry/industry/performance?date=2024-12-24
Then:
  - HTTP 200
  - Response åŒ…å« 30 å€‹ç”¢æ¥­ç¸¾æ•ˆ
  - åŒ…å«å¸‚å ´æ‘˜è¦

æ¸¬è©¦: GET /macro-industry/industry/ranking
Given: ç•¶æ—¥æœ‰æ’è¡Œæ¦œè³‡æ–™
When: GET /macro-industry/industry/ranking?type=RETURN_20D&limit=10
Then:
  - HTTP 200
  - è¿”å› 10 ç­†è³‡æ–™
  - æŒ‰ return_20d é™åºæ’åˆ—

æ¸¬è©¦: GET /macro-industry/macro/cycle
Given: æœ‰ç¶“æ¿Ÿé€±æœŸåˆ¤æ–·çµæœ
When: GET /macro-industry/macro/cycle
Then:
  - HTTP 200
  - åŒ…å«ç•¶å‰é€±æœŸéšæ®µ
  - åŒ…å«é—œéµæŒ‡æ¨™æ•¸å€¼

æ¸¬è©¦: GET /macro-industry/industry/rotation
Given: æœ‰è¼ªå‹•åˆ†æçµæœ
When: GET /macro-industry/industry/rotation?weeks=12
Then:
  - HTTP 200
  - åŒ…å«é ˜æ¼²/è½‰å¼·/è½‰å¼±/è½å¾Œç”¢æ¥­
  - åŒ…å«é€±æœŸé—œè¯åˆ†æ
```

### 4.2 éŒ¯èª¤å ´æ™¯

```
æ¸¬è©¦: ç”¢æ¥­ä»£ç¢¼ä¸å­˜åœ¨
When: GET /macro-industry/industry/sectors/INVALID_CODE
Then:
  - HTTP 404
  - error_code = "M12_IND_001"

æ¸¬è©¦: ç„¡æ•ˆçš„æ’è¡Œæ¦œé¡å‹
When: GET /macro-industry/industry/ranking?type=INVALID_TYPE
Then:
  - HTTP 400
  - error_code = "M12_IND_002"
  - åŒ…å«æœ‰æ•ˆé¡å‹æ¸…å–®

æ¸¬è©¦: ç¸½ç¶“æŒ‡æ¨™ä¸å­˜åœ¨
When: GET /macro-industry/macro/indicators/INVALID_CODE
Then:
  - HTTP 404
  - error_code = "M12_MACRO_001"

æ¸¬è©¦: æ—¥æœŸæ ¼å¼éŒ¯èª¤
When: GET /macro-industry/industry/performance?date=invalid-date
Then:
  - HTTP 400
  - error_code = "M12_PARAM_001"
```

---

## 5. æ•ˆèƒ½æ¸¬è©¦

**æ¸¬è©¦å·¥å…·**: JMeter æˆ– Gatling

```
æ¸¬è©¦: ç”¢æ¥­ç¸¾æ•ˆç¸½è¦½æŸ¥è©¢æ•ˆèƒ½
Given: 100 å€‹ä½µç™¼ä½¿ç”¨è€…
When: æ¯ç§’æŸ¥è©¢ /macro-industry/industry/performance
Then:
  - P95 å›æ‡‰æ™‚é–“ < 150ms
  - å¿«å–å‘½ä¸­ç‡ > 85%

æ¸¬è©¦: æ’è¡Œæ¦œæŸ¥è©¢æ•ˆèƒ½
Given: 50 å€‹ä½µç™¼ä½¿ç”¨è€…
When: æ¯ç§’æŸ¥è©¢ /macro-industry/industry/ranking
Then:
  - P95 å›æ‡‰æ™‚é–“ < 100ms

æ¸¬è©¦: æ¯æ—¥ç¸¾æ•ˆè¨ˆç®— Job æ•ˆèƒ½
Given: 30 å€‹ç”¢æ¥­ï¼Œ2000 æª”è‚¡ç¥¨
When: åŸ·è¡Œ CALC_SECTOR_PERFORMANCE Job
Then:
  - åŸ·è¡Œæ™‚é–“ < 5 åˆ†é˜
  - æˆåŠŸç‡ 100%

æ¸¬è©¦: é€±è¼ªå‹•åˆ†ææ•ˆèƒ½
Given: 12 é€±æ­·å²è³‡æ–™
When: åŸ·è¡Œ ANALYZE_ROTATION Job
Then:
  - åŸ·è¡Œæ™‚é–“ < 3 åˆ†é˜
  - ä¿¡è™Ÿç”¢ç”Ÿæ­£ç¢º
```

---

## 6. è¨ˆç®—æ­£ç¢ºæ€§æ¸¬è©¦

**æ¸¬è©¦ç›®æ¨™**: é©—è­‰è¨ˆç®—çµæœçš„æ­£ç¢ºæ€§

```
æ¸¬è©¦: ç”¢æ¥­å ±é…¬ç‡è¨ˆç®—é©—è­‰
Given:
  - ä½¿ç”¨çœŸå¯¦æ­·å²è³‡æ–™
  - é¸å– 2024-12-24 åŠå°é«”ç”¢æ¥­
When: è¨ˆç®—ç”¢æ¥­å ±é…¬ç‡
Then:
  - èˆ‡åˆ¸å•†/è²¡ç¶“ç¶²ç«™å…¬å¸ƒæ•¸æ“šæ¯”å°
  - èª¤å·® < 0.1%

æ¸¬è©¦: ç¶“æ¿Ÿé€±æœŸåˆ¤æ–·é©—è­‰
Given:
  - ä½¿ç”¨ 2020-2024 æ­·å²ç¸½ç¶“è³‡æ–™
  - å·²çŸ¥çš„æ­·å²é€±æœŸè½‰æŠ˜é»
When: åŸ·è¡Œå›æ¸¬åˆ¤æ–·
Then:
  - é€±æœŸè½‰æŠ˜åˆ¤æ–·æº–ç¢ºç‡ > 80%
  - ç„¡åš´é‡èª¤åˆ¤ï¼ˆå¾©ç”¦åˆ¤ç‚ºè¡°é€€ç­‰ï¼‰

æ¸¬è©¦: è¼ªå‹•ä¿¡è™Ÿæº–ç¢ºæ€§
Given:
  - ä½¿ç”¨ 2024 å¹´æ­·å²è³‡æ–™
  - è¿½è¹¤ä¿¡è™Ÿç™¼å‡ºå¾Œç”¢æ¥­è¡¨ç¾
When: åˆ†æä¿¡è™Ÿæº–ç¢ºç‡
Then:
  - è½‰å¼·ä¿¡è™Ÿå¾Œ 1 å€‹æœˆæ­£å ±é…¬ç‡ > 60%
  - é ˜æ¼²ä¿¡è™ŸæŒçºŒæ€§ > 70%
```

---

## 7. æ¸¬è©¦è¦†è“‹ç‡ç›®æ¨™

| å±¤ç´š | è¦†è“‹ç‡ç›®æ¨™ | èªªæ˜ |
|-----|----------|------|
| PerformanceCalculator | > 95% | ç¸¾æ•ˆè¨ˆç®—é‚è¼¯å¿…é ˆå®Œæ•´æ¸¬è©¦ |
| ValuationCalculator | > 95% | ä¼°å€¼è¨ˆç®—é‚è¼¯å¿…é ˆå®Œæ•´æ¸¬è©¦ |
| CycleDeterminator | > 90% | é€±æœŸåˆ¤æ–·é‚è¼¯å¿…é ˆæ¸¬è©¦ |
| RotationAnalyzer | > 90% | è¼ªå‹•åˆ†æé‚è¼¯å¿…é ˆæ¸¬è©¦ |
| Service å±¤ | > 80% | æ ¸å¿ƒæ¥­å‹™é‚è¼¯å¿…é ˆæ¸¬è©¦ |
| Controller å±¤ | > 70% | ä¸»è¦ API ç«¯é»å¿…é ˆæ¸¬è©¦ |
| æ•´é«” | > 80% | æ•´é«”ç¨‹å¼ç¢¼è¦†è“‹ç‡ |

**æ¸¬è©¦å„ªå…ˆç´š**:
1. P0 åŠŸèƒ½ï¼š100% æ¸¬è©¦è¦†è“‹ï¼ˆç¸¾æ•ˆè¨ˆç®—ã€æ’åã€è¼ªå‹•ä¿¡è™Ÿï¼‰
2. P1 åŠŸèƒ½ï¼š> 80% æ¸¬è©¦è¦†è“‹ï¼ˆä¼°å€¼ã€é€±æœŸåˆ¤æ–·ï¼‰
3. P2 åŠŸèƒ½ï¼š> 60% æ¸¬è©¦è¦†è“‹ï¼ˆä¸»é¡Œåˆ†é¡ã€è³‡æ–™æ¸…ç†ï¼‰

---

## 8. æ¸¬è©¦è³‡æ–™æº–å‚™

### 8.1 æ¸¬è©¦è³‡æ–™é›†

```java
@TestConfiguration
public class IndustryTestDataConfig {

    // ç”¢æ¥­ç¸¾æ•ˆæ¸¬è©¦è³‡æ–™
    public static List<SectorPerformance> createTestPerformance(LocalDate tradeDate) {
        return List.of(
            createSectorPerf("24", "åŠå°é«”æ¥­", tradeDate, 1.85, 4.25, 12.50),
            createSectorPerf("17", "é‡‘èä¿éšªæ¥­", tradeDate, 0.65, 1.20, 3.80),
            createSectorPerf("31", "èˆªé‹æ¥­", tradeDate, 2.50, 8.00, 15.20)
        );
    }

    // ç¸½ç¶“æŒ‡æ¨™æ¸¬è©¦è³‡æ–™
    public static List<MacroIndicatorValue> createTestMacroData() {
        return List.of(
            createMacroValue("TW_LEADING_INDEX", LocalDate.now(), new BigDecimal("102.5")),
            createMacroValue("TW_COINCIDENT_INDEX", LocalDate.now(), new BigDecimal("98.3")),
            createMacroValue("TW_MONITOR_SCORE", LocalDate.now(), new BigDecimal("28"))
        );
    }

    // è¼ªå‹•æ¸¬è©¦è³‡æ–™
    public static Map<String, List<Integer>> createRotationTestData() {
        return Map.of(
            "24", List.of(2, 1, 2, 3, 2, 1, 2, 2, 3, 2, 1, 2),  // é ˜æ¼²
            "17", List.of(15, 14, 16, 15, 13, 14, 15, 16, 14, 15, 13, 14),  // ä¸­é–“
            "31", List.of(5, 7, 9, 12, 15, 18, 20, 22, 23, 24, 25, 26)  // è½‰å¼·
        );
    }
}
```

### 8.2 æ¸¬è©¦ç”¢æ¥­æ¸…å–®

| ç”¢æ¥­ä»£ç¢¼ | ç”¢æ¥­åç¨± | æ¸¬è©¦ç›®çš„ |
|---------|---------|---------|
| 24 | åŠå°é«”æ¥­ | å¤§å‹æ¬Šå€¼ç”¢æ¥­ |
| 17 | é‡‘èä¿éšªæ¥­ | å‚³çµ±ç”¢æ¥­ |
| 31 | èˆªé‹æ¥­ | é€±æœŸæ€§ç”¢æ¥­ |
| 01 | æ°´æ³¥å·¥æ¥­ | å°å‹å‚³ç”¢ |
| 26 | å…‰é›»æ¥­ | é«˜æ³¢å‹•ç”¢æ¥­ |

---

## ğŸ“š ç›¸é—œæ–‡æª”

- [M12 åŠŸèƒ½éœ€æ±‚](../specs/functional/M12-ç¸½ç¶“ç”¢æ¥­åˆ†æåŠŸèƒ½éœ€æ±‚.md)
- [M12 APIè¦æ ¼](../specs/api/M12-APIè¦æ ¼.md)
- [M12 è³‡æ–™åº«è¨­è¨ˆ](./M12-è³‡æ–™åº«è¨­è¨ˆ.md)
- [é–‹ç™¼æº–å‰‡](../specs/technical/00-é–‹ç™¼æº–å‰‡.md)

---

**æ–‡ä»¶ç¶­è­·è€…**: æ¸¬è©¦å·¥ç¨‹å¸«
**æœ€å¾Œæ›´æ–°**: 2026-01-14
**ä¸‹æ¬¡å¯©æ ¸**: 2026-04-14
